import{aM as M,b1 as nt,b$ as dt,v3 as pt,v4 as q,di as x,rQ as _t,v5 as gt,a3 as R,$ as p,a0 as g,a2 as L,fp as at,fn as vt,v6 as wt,cU as ft,v7 as H,bq as Q,dZ as ct,v8 as X,mX as bt,kF as yt,cG as Mt,v9 as xt,va as Tt,iL as it,vb as $t,mN as St,vc as Ct,fb as F,vd as zt,ve as st,vf as Et,vg as Rt,ae as V,vh as rt,vi as Lt}from"./chunk-gZYsZ36N.js";import{t as At}from"./chunk-1_thnT0U.js";import{t as Zt}from"./chunk-jUZKQwH1.js";const Gt={shaders:{vertexShader:M("bitBlit/bitBlit.vert"),fragmentShader:M("bitBlit/bitBlit.frag")},attributes:new Map([["a_pos",0],["a_tex",1]])},Xt={shaders:{vertexShader:M("stencil/stencil.vert"),fragmentShader:M("stencil/stencil.frag")},attributes:new Map([["a_pos",0]])},Yt={shaders:{vertexShader:M("highlight/textured.vert"),fragmentShader:M("highlight/highlight.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])},Ht={shaders:{vertexShader:M("highlight/textured.vert"),fragmentShader:M("highlight/blur.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])},f=nt("esri-2d-profiler");let Qt=class{constructor(t,e){if(this._events=new dt,this._entries=new Map,this._timings=new At(10),this._currentContainer=null,this._currentPass=null,this._currentBrush=null,this._currentSummary=null,!f)return;this._ext=pt(t.gl,{}),this._debugOutput=e;const i=t.gl;if(!this.enableCommandLogging)return;let n;for(n in i)if(typeof i[n]=="function"){const o=i[n],r=n.includes("draw");i[n]=(...a)=>(this._events.emit("command",{container:this._currentContainer,pass:this._currentPass,brush:this._currentBrush,method:n,args:a,isDrawCommand:r}),this._currentSummary&&(this._currentSummary.commands++,r&&this._currentSummary.drawCommands++),o.apply(i,a))}}get enableCommandLogging(){return!(typeof f=="object"&&f.disableCommands)}recordContainerStart(t){f&&(this._currentContainer=t)}recordContainerEnd(){f&&(this._currentContainer=null)}recordPassStart(t){f&&(this._currentPass=t,this._initSummary())}recordPassEnd(){f&&(this._currentPass=null,this._emitSummary())}recordBrushStart(t){f&&(this._currentBrush=t)}recordBrushEnd(){f&&(this._currentBrush=null)}recordStart(t){if(f&&this._ext!=null){if(this._entries.has(t)){const i=this._entries.get(t),n=this._ext.resultAvailable(i.query),o=this._ext.disjoint();if(n&&!o){const r=this._ext.getResult(i.query)/1e6;let a=0;if(this._timings.enqueue(r)!=null){const l=this._timings.entries,_=l.length;let c=0;for(const u of l)c+=u;a=c/_}const h=r.toFixed(2),m=a?a.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed(`Frame report for ${t}, ${h} ms (${m} last 10 avg)
${i.commandsLen} Commands (${i.drawCommands} draw)`),console.log("RenderPass breakdown: "),console.table(i.summaries),console.log("Commands: ",i.commands),console.groupEnd()):console.log(`Frame report for ${t}, ${h} ms (${m} last 10 avg)`),this._debugOutput.innerHTML=`${h} (${m})`}for(const r of i.handles)r.remove();this._ext.deleteQuery(i.query),this._entries.delete(t)}const e={name:t,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(e.handles.push(this._events.on("command",i=>{e.commandsLen++,e.commands.push(i),i.isDrawCommand&&e.drawCommands++})),e.handles.push(this._events.on("summary",i=>{e.summaries.push(i)}))),this._ext.beginTimeElapsed(e.query),this._entries.set(t,e)}}recordEnd(t){f&&this._ext!=null&&this._entries.has(t)&&this._ext.endTimeElapsed()}_initSummary(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})}_emitSummary(){this.enableCommandLogging&&this._currentSummary&&this._events.emit("summary",this._currentSummary)}};const b=1,Y=0,B=1,D=2;let kt=class{constructor(t,e,i){this._debugMap=new Map,this._width=t*i,this._height=e*i,this._pixelRatio=i;const n=Math.ceil(this._width/b),o=Math.ceil(this._height/b);this._cols=n,this._rows=o,this._cells=Zt.create(n*o)}insertMetrics(t){this._markMetrics(t)}hasCollision(t){let e=0;for(const{computedX:i,computedY:n,width:o,height:r}of t.bounds){const a=(o+q)*this._pixelRatio,h=(r+q)*this._pixelRatio;switch(this._collide(i,n,a,h)){case D:return D;case B:e++}}return e===t.bounds.length?B:Y}getCellId(t,e){return t+e*this._cols}has(t){return this._cells.has(t)}hasRange(t,e){return this._cells.hasRange(t,e)}set(t){this._cells.set(t)}setRange(t,e){this._cells.setRange(t,e)}_collide(t,e,i,n){const o=t-i/2,r=e-n/2,a=o+i,h=r+n;if(a<0||h<0||o>this._width||r>this._height)return B;const m=x(Math.floor(o/b),0,this._cols),l=x(Math.floor(r/b),0,this._rows),_=x(Math.ceil(a/b),0,this._cols),c=x(Math.ceil(h/b),0,this._rows);for(let u=l;u<=c;u++)for(let d=m;d<=_;d++){const v=this.getCellId(d,u);if(this.has(v))return D}return Y}_mark(t,e,i,n,o){const r=t-i/2,a=e-n/2,h=r+i,m=a+n,l=x(Math.floor(r/b),0,this._cols),_=x(Math.floor(a/b),0,this._rows),c=x(Math.ceil(h/b),0,this._cols),u=x(Math.ceil(m/b),0,this._rows);for(let d=_;d<=u;d++)for(let v=l;v<=c;v++){const A=this.getCellId(v,d);this._debugMap.set(A,o),this.set(A)}return!1}_markMetrics(t){for(const{computedX:e,computedY:i,width:n,height:o}of t.bounds){const r=(n+q)*this._pixelRatio,a=(o+q)*this._pixelRatio;this._mark(e,i,r,a,t.entityTexel)}}};const Z=254,O=255,k=0;function S(s,t){const e=s.children.slice();e.sort((i,n)=>i.tileAge-n.tileAge),e.forEach(i=>{i.labelMetrics!=null&&i.isReady&&t(i,i.labelMetrics)})}function ht(s,t){return(!s.minScale||s.minScale>=t)&&(!s.maxScale||s.maxScale<=t)}let It=class{run(t,e,i,n){const o=[];for(let r=t.length-1;r>=0;r--){const a=t[r];a.labelingCollisionInfos?.length&&o.push(...a.labelingCollisionInfos)}nt("esri-2d-update-debug")&&o.length&&console.debug("CollisionEngine.run"),this._transformMetrics(o),this._runCollision(o,e,i,n);for(const r of o)r.container.requestRender()}_runCollision(t,e,i,n){const[o,r]=e.state.size,a=new kt(o,r,e.pixelRatio);for(const{container:h,deconflictionEnabled:m,visible:l}of t){const _=h.attributeView;m?l?(this._prepare(h),this._collideVisible(a,h,i,n),this._collideInvisible(a,h)):S(h,(c,u)=>{for(const d of u)_.setLabelMinZoom(d.entityTexel,O)}):S(h,(c,u)=>{for(const d of u)ht(d,i)?(_.setLabelMinZoom(d.entityTexel,k),l&&a.insertMetrics(d)):_.setLabelMinZoom(d.entityTexel,Z)})}}_isFiltered(t,e,i){const n=e.getFilterFlags(t),o=!i.hasFilter||!!(n&_t),r=i.featureEffect==null||i.featureEffect.excludedLabelsVisible||!!(n&gt);return!(o&&r)}_prepare(t){const e=t.attributeView,i=new Set;S(t,(n,o)=>{for(const r of o){const a=r.entityTexel;if(!i.has(a)){if(i.add(a),this._isFiltered(a,e,t.layerView)){e.setLabelMinZoom(a,Z);continue}e.getLabelMinZoom(a)!==k?e.setLabelMinZoom(a,O):e.setLabelMinZoom(a,k)}}})}_collideVisible(t,e,i,n){const o=e.attributeView,r=new Set;S(e,(a,h)=>{for(let m=0;m<h.length;m++){const l=h[m].entityTexel;if(r.has(l))continue;if(a.key.level!==n){o.setLabelMinZoom(l,Z),r.add(l);continue}if(!ht(h[m],i)){o.setLabelMinZoom(l,Z),r.add(l);continue}if(o.getLabelMinZoom(l)!==0){r.add(l);continue}let _=!1,c=!0;const u=m;let d=m;for(;d<h.length;d++){const v=h[d];if(v.entityTexel!==l)break;if(!_)switch(t.hasCollision(v)){case B:break;case D:_=!0,c=!1;break;case Y:c=!1}}if(!_)for(let v=u;v<d;v++)t.insertMetrics(h[v]);m=d-1,c||(r.add(l),o.setLabelMinZoom(l,_?Z:k))}})}_collideInvisible(t,e){const i=e.attributeView,n=new Set;S(e,(o,r)=>{for(let a=0;a<r.length;a++){const h=r[a].entityTexel;if(n.has(h))continue;if(i.getLabelMinZoom(h)!==O){n.add(h);continue}let m=!1,l=!0;const _=a;let c=a;for(;c<r.length;c++){const u=r[c];if(u.entityTexel!==h)break;if(!m)switch(t.hasCollision(u)){case B:break;case D:m=!0,l=!1;break;case Y:l=!1}}if(!m)for(let u=_;u<c;u++)t.insertMetrics(r[u]);a=c-1,l||(n.add(h),i.setLabelMinZoom(h,m?O:k))}})}_transformMetrics(t){for(const{container:e,geometryType:i,vvEvaluators:n}of t)S(e,(o,r)=>{const a=e.attributeView,h=o.transforms.labelMat2d;h[4]=Math.round(h[4]),h[5]=Math.round(h[5]);const m=i==="polyline";for(const l of r){const{entityTexel:_,anchorX:c,anchorY:u}=l;let d=l.referenceBounds?.size??0;const v=n[0];if(v!=null){const w=v(a.getVVSize(_));d=isNaN(w)||w==null||w===1/0?d:w}const A=l.directionX*(d/2),ot=l.directionY*(d/2);for(const w of l.bounds){let j=c,J=u;if(m){let T=j+w.x+A,$=J+w.y+ot;T=h[0]*T+h[2]*$+h[4],$=h[1]*T+h[3]*$+h[5],w.computedX=Math.floor(T),w.computedY=Math.floor($)}else{j=h[0]*c+h[2]*u+h[4],J=h[1]*c+h[3]*u+h[5];const T=j+w.x+A,$=J+w.y+ot;w.computedX=T,w.computedY=$}}}})}};const Nt=32;let I=class extends R{constructor(t){super(t),this._lastUpdate=0,this.collisionEngine=new It,this.lastUpdateId=-1,this.updateRequested=!1,this.view=null}get updating(){return nt("esri-2d-log-updating")&&console.log(`Updating LabelManager ${this.updateRequested}:
-> updateRequested: ${this.updateRequested}`),this.updateRequested}update(t){const e=performance.now();e-this._lastUpdate>=Nt?(this._lastUpdate=e,this.doUpdate(t)):this.requestUpdate()}viewChange(){this.requestUpdate()}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view?.requestUpdate())}processUpdate(t){this.updateRequested&&(this.updateRequested=!1,this.update(t))}doUpdate(t){const e=this.view;if(e)try{const i=t.state.scale,n=e.featuresTilingScheme.getClosestInfoForScale(i).level;this.collisionEngine.run(e.allLayerViews.items,t,i,n)}catch{}}};p([g()],I.prototype,"updateRequested",void 0),p([g()],I.prototype,"updating",null),p([g()],I.prototype,"view",void 0),I=p([L("esri.views.2d.LabelManager")],I);const U="esri-zoom-box",G={container:`${U}__container`,overlay:`${U}__overlay`,background:`${U}__overlay-background`,box:`${U}__outline`},K={zoom:"Shift",counter:"Ctrl"};let N=class extends R{constructor(s){super(s),this._container=null,this._overlay=null,this._backgroundShape=null,this._boxShape=null,this._box={x:0,y:0,width:0,height:0},this._rafId=null,this._redraw=this._redraw.bind(this)}destroy(){this.view=null}set view(s){this.removeAllHandles(),this._destroyOverlay(),this._set("view",s),s&&this.addHandles([s.on("drag",[K.zoom],t=>this._handleDrag(t,1),at.INTERNAL),s.on("drag",[K.zoom,K.counter],t=>this._handleDrag(t,-1),at.INTERNAL)])}_start(){this._createContainer(),this._createOverlay(),this.navigation.begin()}_update(s,t,e,i){this._box.x=s,this._box.y=t,this._box.width=e,this._box.height=i,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}_end(s,t,e,i,n){const o=this.view,r=o.toMap(vt(s+.5*e,t+.5*i));let a=Math.max(e/o.width,i/o.height);n===-1&&(a=1/a),this._destroyOverlay(),this.navigation.end(),o.goTo({center:r,scale:o.scale*a})}_updateBox(s,t,e,i){const n=this._boxShape;n.setAttributeNS(null,"x",""+s),n.setAttributeNS(null,"y",""+t),n.setAttributeNS(null,"width",""+e),n.setAttributeNS(null,"height",""+i),n.setAttributeNS(null,"class",G.box)}_updateBackground(s,t,e,i){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(s,t,e,i,this.view.width,this.view.height))}_createContainer(){const s=document.createElement("div");s.className=G.container,this.view.root.appendChild(s),this._container=s}_createOverlay(){const s=this.view.width,t=this.view.height,e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttributeNS(null,"d","M 0 0 L "+s+" 0 L "+s+" "+t+" L 0 "+t+" Z"),e.setAttributeNS(null,"class",G.background);const i=document.createElementNS("http://www.w3.org/2000/svg","rect"),n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),n.setAttributeNS(null,"class",G.overlay),n.appendChild(e),n.appendChild(i),this._container.appendChild(n),this._backgroundShape=e,this._boxShape=i,this._overlay=n}_destroyOverlay(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null}_toSVGPath(s,t,e,i,n,o){const r=s+e,a=t+i;return"M 0 0 L "+n+" 0 L "+n+" "+o+" L 0 "+o+" ZM "+s+" "+t+" L "+s+" "+a+" L "+r+" "+a+" L "+r+" "+t+" Z"}_handleDrag(s,t){const e=s.x,i=s.y,n=s.origin.x,o=s.origin.y;let r,a,h,m;switch(e>n?(r=n,h=e-n):(r=e,h=n-e),i>o?(a=o,m=i-o):(a=i,m=o-i),s.action){case"start":this._start();break;case"update":this._update(r,a,h,m);break;case"end":this._end(r,a,h,m,t)}s.stopPropagation()}_redraw(){if(!this._rafId||(this._rafId=null,!this._overlay))return;const{x:s,y:t,width:e,height:i}=this._box;this._updateBox(s,t,e,i),this._updateBackground(s,t,e,i),this._rafId=requestAnimationFrame(this._redraw)}};p([g()],N.prototype,"navigation",void 0),p([g()],N.prototype,"view",null),N=p([L("esri.views.2d.navigation.ZoomBox")],N);const Pt=N;let z=class extends R{constructor(t){super(t),this.animationTime=0,this.momentumEstimator=new wt(500,6,.92),this.momentum=null,this.tmpMomentum=ft(),this.momentumFinished=!1,this.viewpoint=new H({targetGeometry:new Q,scale:0,rotation:0}),this._previousDrag=null,ct(()=>this.momentumFinished,()=>this.navigation.stop())}begin(t,e){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(e),this._previousDrag=e}update(t,e){this.addToEstimator(e);let i=e.center.x,n=e.center.y;const o=this._previousDrag;i=o?o.center.x-i:-i,n=o?n-o.center.y:n,t.viewpoint=X(this.viewpoint,t.viewpoint,[i||0,n||0]),this._previousDrag=e}end(t,e){this.addToEstimator(e);const i=t.navigation.momentumEnabled;this.momentum=i?this.momentumEstimator.evaluateMomentum():null,this.animationTime=0,this.momentum&&this.onAnimationUpdate(t),this._previousDrag=null,this.navigation.end()}addToEstimator(t){const e=t.center.x,i=t.center.y,n=yt(-e,i),o=Mt(-e,i,0);this.momentumEstimator.add(n,o,.001*t.timestamp)}onAnimationUpdate(t){this.navigation.animationManager?.animateContinous(t.viewpoint,(e,i)=>{const{momentum:n,animationTime:o,tmpMomentum:r}=this,a=.001*i;if(!(this.momentumFinished=!n||n.isFinished(o))){const h=n.valueDelta(o,a);bt(r,n.direction,h),X(e,e,r),t.constraints.constrainByGeometry(e)}this.animationTime+=a})}stopMomentumNavigation(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())}};p([g()],z.prototype,"momentumFinished",void 0),p([g()],z.prototype,"viewpoint",void 0),p([g()],z.prototype,"navigation",void 0),z=p([L("esri.views.2d.navigation.actions.Pan")],z);const Bt=z;let E=class extends R{constructor(t){super(t),this._animationTime=0,this._momentumFinished=!1,this._previousAngle=0,this._previousRadius=0,this._previousCenter=null,this._rotationMomentumEstimator=new xt(.6,.15,.95),this._rotationDirection=1,this._startAngle=0,this._startRadius=0,this._updateTimestamp=null,this._zoomDirection=1,this._zoomMomentumEstimator=new Tt,this._zoomOnly=null,this.zoomMomentum=null,this.rotateMomentum=null,this.viewpoint=new H({targetGeometry:new Q,scale:0,rotation:0}),this.addHandles(ct(()=>this._momentumFinished,()=>this.navigation.stop()))}begin(t,e){this.navigation.begin(),this._rotationMomentumEstimator.reset(),this._zoomMomentumEstimator.reset(),this._zoomOnly=null,this._previousAngle=this._startAngle=e.angle,this._previousRadius=this._startRadius=e.radius,this._previousCenter=e.center,this._updateTimestamp=null,t.constraints.rotationEnabled&&this.addToRotateEstimator(0,e.timestamp),this.addToZoomEstimator(e,1)}update(t,e){this._updateTimestamp===null&&(this._updateTimestamp=e.timestamp);const i=e.angle,n=e.radius,o=e.center,r=Math.abs(180*(i-this._startAngle)/Math.PI),a=Math.abs(n-this._startRadius),h=this._startRadius/n;if(this._previousRadius&&this._previousCenter){const m=n/this._previousRadius;let l=180*(i-this._previousAngle)/Math.PI;this._rotationDirection=l>=0?1:-1,this._zoomDirection=m>=1?1:-1,t.constraints.rotationEnabled?(this._zoomOnly===null&&e.timestamp-this._updateTimestamp>200&&(this._zoomOnly=a-r>0),this._zoomOnly===null||this._zoomOnly?l=0:this.addToRotateEstimator(i-this._startAngle,e.timestamp)):l=0,this.addToZoomEstimator(e,h),this.navigation.setViewpoint([o.x,o.y],1/m,l,[this._previousCenter.x-o.x,o.y-this._previousCenter.y])}this._previousAngle=i,this._previousRadius=n,this._previousCenter=o}end(t){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=0,(this.rotateMomentum||this.zoomMomentum)&&this.onAnimationUpdate(t),this.navigation.end()}addToRotateEstimator(t,e){this._rotationMomentumEstimator.add(t,.001*e)}addToZoomEstimator(t,e){this._zoomMomentumEstimator.add(e,.001*t.timestamp)}canZoomIn(t){const e=t.scale,i=t.constraints.effectiveMaxScale;return i===0||e>i}canZoomOut(t){const e=t.scale,i=t.constraints.effectiveMinScale;return i===0||e<i}onAnimationUpdate(t){this.navigation.animationManager?.animateContinous(t.viewpoint,(e,i)=>{const n=!this.canZoomIn(t)&&this._zoomDirection>1||!this.canZoomOut(t)&&this._zoomDirection<1,o=!this.rotateMomentum||this.rotateMomentum.isFinished(this._animationTime),r=n||!this.zoomMomentum||this.zoomMomentum.isFinished(this._animationTime),a=.001*i;if(this._momentumFinished=o&&r,!this._momentumFinished){const h=this.rotateMomentum?Math.abs(this.rotateMomentum.valueDelta(this._animationTime,a))*this._rotationDirection*180/Math.PI:0;let m=this.zoomMomentum?Math.abs(this.zoomMomentum.valueDelta(this._animationTime,a)):1;const l=F(),_=F();if(this._previousCenter){it(l,this._previousCenter.x,this._previousCenter.y),$t(_,t.size,t.padding),St(l,l,_);const{constraints:c,scale:u}=t,d=u*m;m<1&&!c.canZoomInTo(d)?(m=u/c.effectiveMaxScale,this.zoomMomentum=null,this.rotateMomentum=null):m>1&&!c.canZoomOutTo(d)&&(m=u/c.effectiveMinScale,this.zoomMomentum=null,this.rotateMomentum=null),Ct(e,t.viewpoint,m,h,l,t.size),t.constraints.constrainByGeometry(e)}}this._animationTime+=a})}stopMomentumNavigation(){(this.rotateMomentum||this.zoomMomentum)&&(this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop())}};p([g()],E.prototype,"_momentumFinished",void 0),p([g()],E.prototype,"viewpoint",void 0),p([g()],E.prototype,"navigation",void 0),E=p([L("esri.views.2d.navigation.actions.Pinch")],E);const Dt=E,W=F(),lt=F();let P=class extends R{constructor(s){super(s),this._previousCenter=F(),this.viewpoint=new H({targetGeometry:new Q,scale:0,rotation:0})}begin(s,t){this.navigation.begin(),it(this._previousCenter,t.center.x,t.center.y)}update(s,t){const{state:{size:e,padding:i}}=s;it(W,t.center.x,t.center.y),zt(lt,e,i),s.viewpoint=st(this.viewpoint,s.state.paddedViewState.viewpoint,Et(lt,this._previousCenter,W)),Rt(this._previousCenter,W)}end(){this.navigation.end()}};p([g()],P.prototype,"viewpoint",void 0),p([g()],P.prototype,"navigation",void 0),P=p([L("esri.views.2d.actions.Rotate")],P);const Ft=P,C=10,mt=1,tt=new H({targetGeometry:new Q}),et=[0,0],ut=250;let y=class extends R{constructor(s){super(s),this._endTimer=null,this._lastEventTimestamp=null,this.animationManager=null,this.interacting=!1}initialize(){this.pan=new Bt({navigation:this}),this.rotate=new Ft({navigation:this}),this.pinch=new Dt({navigation:this}),this.zoomBox=new Pt({view:this.view,navigation:this})}destroy(){this.pan=V(this.pan),this.rotate=V(this.rotate),this.pinch=V(this.pinch),this.zoomBox=V(this.zoomBox),this.animationManager=null}begin(){this.stop(),this._set("interacting",!0)}end(){this._lastEventTimestamp=performance.now(),this._startTimer(ut)}async zoom(s,t=this._getDefaultAnchor()){if(this.begin(),this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs)return s<1?this.zoomIn(t):this.zoomOut(t);this.setViewpoint(t,s,0,[0,0])}async zoomIn(s){const t=this.view,e=t.constraints.snapToNextScale(t.scale);return this._zoomToScale(e,s)}async zoomOut(s){const t=this.view,e=t.constraints.snapToPreviousScale(t.scale);return this._zoomToScale(e,s)}setViewpoint(s,t,e,i){this.begin(),this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,s,t,e,i),this.end()}setViewpointImmediate(s,t=0,e=[0,0],i=this._getDefaultAnchor()){this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,i,s,t,e)}continousRotateClockwise(){const s=this.view.viewpoint;this.animationManager?.animateContinous(s,t=>{st(t,t,-mt)})}continousRotateCounterclockwise(){const s=this.view.viewpoint;this.animationManager?.animateContinous(s,t=>{st(t,t,mt)})}resetRotation(){this.view.constraints.rotationEnabled&&(this.view.rotation=0)}continousPanLeft(){this._continuousPan([-C,0])}continousPanRight(){this._continuousPan([C,0])}continousPanUp(){this._continuousPan([0,C])}continousPanDown(){this._continuousPan([0,-C])}continuousPanVector({x:s,y:t}){this._continuousPan([s*C,t*C])}stop(){this.pan.stopMomentumNavigation(),this.animationManager?.stop(),this.end(),this._endTimer!==null&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))}_continuousPan(s){const t=this.view.viewpoint;this.animationManager?.animateContinous(t,e=>{X(e,e,s),this.view.constraints.constrainByGeometry(e)})}_startTimer(s){return this._endTimer!==null||(this._endTimer=setTimeout(()=>{this._endTimer=null;const t=performance.now()-(this._lastEventTimestamp??0);t<ut?this._endTimer=this._startTimer(t):this._set("interacting",!1)},s)),this._endTimer}_getDefaultAnchor(){const{size:s,padding:{left:t,right:e,top:i,bottom:n}}=this.view;return et[0]=.5*(s[0]-e+t),et[1]=.5*(s[1]-n+i),et}async _zoomToScale(s,t=this._getDefaultAnchor()){const{view:e}=this,{constraints:i,scale:n,viewpoint:o,size:r,padding:a}=e,h=i.canZoomInTo(s),m=i.canZoomOutTo(s);if(!(s<n&&!h||s>n&&!m))return rt(tt,o,s/n,0,t,r,a),i.constrainByGeometry(tt),e.goTo(tt,{animate:!0,pickClosestTarget:!1})}_scaleRotateTranslateViewpoint(s,t,e,i,n){const{view:o}=this,{size:r,padding:a,constraints:h,scale:m,viewpoint:l}=o,_=m*e,c=h.canZoomInTo(_),u=h.canZoomOutTo(_);return(e<1&&!c||e>1&&!u)&&(e=1),X(l,l,n),rt(s,l,e,i,t,r,a),h.constrainByGeometry(s)}};p([g()],y.prototype,"animationManager",void 0),p([g({type:Boolean,readOnly:!0})],y.prototype,"interacting",void 0),p([g()],y.prototype,"pan",void 0),p([g()],y.prototype,"pinch",void 0),p([g()],y.prototype,"rotate",void 0),p([g()],y.prototype,"view",void 0),p([g()],y.prototype,"zoomBox",void 0),y=p([L("esri.views.2d.navigation.MapViewNavigation")],y);const ie=y,qt={shaders:{vertexShader:M("magnifier/magnifier.vert"),fragmentShader:M("magnifier/magnifier.frag")},attributes:new Map([["a_pos",0]])};function se(s){return Lt(s,qt)}export{Ht as a,se as b,qt as c,I as d,Gt as e,ie as f,Qt as n,Xt as r,Yt as t};
