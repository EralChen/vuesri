import{bU as un,z as q,gO as d,bH as S,cA as N,bv as R,a1 as x,cB as E,bw as B,x as H,ky as cn,hJ as fn}from"./chunk-ERvgPDZ8.js";import{Z as o,n as h,Q as W,K as V,X as K,d as T,a as s,r as u,q as I,b as F,i as j,H as D,A as w,a9 as Q,aa as U,ab as Z,c as b,B as ln,ac as on,ad as dn,E as X,N as J,y as L,ae as wn,af as C}from"./chunk-GyVrLUWZ.js";import{c as P,r as O,a as p}from"./chunk-7SKfZzmU.js";import{l as G}from"./chunk-_pXwj3Zk.js";import{disjoint as hn,intersects as mn,touches as yn,crosses as pn,within as gn,contains as vn,overlaps as Pn,equals as An,relate as In,intersect as Fn,union as bn,difference as Nn,symmetricDifference as xn,clip as Rn,cut as Sn,planarArea as Y,geodesicArea as _,planarLength as M,geodesicLength as k,distance as On,densify as $,geodesicDensify as nn,generalize as jn,buffer as Dn,geodesicBuffer as Jn,offset as Ln,rotate as en,simplify as rn,isSimple as Cn,convexHull as Mn,nearestCoordinate as zn,nearestVertex as Tn}from"./chunk-8e0mHqLG.js";import"./chunk-cDR98evz.js";import"./chunk-2jtF4PrC.js";import"./chunk-SS5GKVPY.js";async function tn(t,e,r){if(!un?.findCredential(t.restUrl))return null;if(t.loadStatus==="loaded"&&e===""&&t.user?.sourceJSON&&r===!1)return t.user.sourceJSON;const f={responseType:"json",query:{f:"json"}};if(r&&(f.query.returnUserLicenseTypeExtensions=!0),e===""){const a=await q(t.restUrl+"/community/self",f);if(a.data){const i=a.data;if(i?.username)return i}return null}const n=await q(t.restUrl+"/community/users/"+e,f);if(n.data){const a=n.data;return a.error?null:a}return null}function an(t){return cn.indexOf("4.")===0?x.fromExtent(t):new x({spatialReference:t.spatialReference,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]})}function A(t,e,r){if(h(t,2,2,e,r),!(t[0]instanceof d&&t[1]instanceof d)){if(!(t[0]instanceof d&&t[1]===null)){if(!(t[1]instanceof d&&t[0]===null)){if(t[0]!==null||t[1]!==null)throw new s(e,u.InvalidParameter,r)}}}}async function sn(t,e){if(t.type!=="polygon"&&t.type!=="polyline"&&t.type!=="extent")return 0;let r=1;(t.spatialReference.vcsWkid||t.spatialReference.latestVcsWkid)&&(r=wn(t.spatialReference)/fn(t.spatialReference));let c=0;if(t.type==="polyline")for(const n of t.paths)for(let a=1;a<n.length;a++)c+=C(n[a],n[a-1],r);else if(t.type==="polygon")for(const n of t.rings){for(let a=1;a<n.length;a++)c+=C(n[a],n[a-1],r);(n[0][0]!==n[n.length-1][0]||n[0][1]!==n[n.length-1][1]||n[0][2]!==void 0&&n[0][2]!==n[n.length-1][2])&&(c+=C(n[0],n[n.length-1],r))}else t.type==="extent"&&(c+=2*C([t.xmin,t.ymin,0],[t.xmax,t.ymin,0],r),c+=2*C([t.xmin,t.ymin,0],[t.xmin,t.ymax,0],r),c*=2,c+=4*Math.abs(w(t.zmax,0)*r-w(t.zmin,0)*r));const f=new N({hasZ:!1,hasM:!1,spatialReference:t.spatialReference,paths:[[0,0],[0,c]]});return M(f,e)}function Vn(t){t.mode==="async"&&(t.functions.disjoint=function(e,r){return t.standardFunctionAsync(e,r,(c,f,n)=>(A(n=o(n),e,r),n[0]===null||n[1]===null||hn(n[0],n[1])))},t.functions.intersects=function(e,r){return t.standardFunctionAsync(e,r,(c,f,n)=>(A(n=o(n),e,r),n[0]!==null&&n[1]!==null&&mn(n[0],n[1])))},t.functions.touches=function(e,r){return t.standardFunctionAsync(e,r,(c,f,n)=>(A(n=o(n),e,r),n[0]!==null&&n[1]!==null&&yn(n[0],n[1])))},t.functions.crosses=function(e,r){return t.standardFunctionAsync(e,r,(c,f,n)=>(A(n=o(n),e,r),n[0]!==null&&n[1]!==null&&pn(n[0],n[1])))},t.functions.within=function(e,r){return t.standardFunctionAsync(e,r,(c,f,n)=>(A(n=o(n),e,r),n[0]!==null&&n[1]!==null&&gn(n[0],n[1])))},t.functions.contains=function(e,r){return t.standardFunctionAsync(e,r,(c,f,n)=>(A(n=o(n),e,r),n[0]!==null&&n[1]!==null&&vn(n[0],n[1])))},t.functions.overlaps=function(e,r){return t.standardFunctionAsync(e,r,(c,f,n)=>(A(n=o(n),e,r),n[0]!==null&&n[1]!==null&&Pn(n[0],n[1])))},t.functions.equals=function(e,r){return t.standardFunctionAsync(e,r,(c,f,n)=>(h(n,2,2,e,r),n[0]===n[1]||(n[0]instanceof d&&n[1]instanceof d?An(n[0],n[1]):(W(n[0])&&W(n[1])||!!(V(n[0])&&V(n[1])||K(n[0])&&K(n[1])))&&n[0].equals(n[1]))))},t.functions.relate=function(e,r){return t.standardFunctionAsync(e,r,(c,f,n)=>{if(n=o(n),h(n,3,3,e,r),n[0]instanceof d&&n[1]instanceof d)return In(n[0],n[1],T(n[2]));if(n[0]instanceof d&&n[1]===null||n[1]instanceof d&&n[0]===null||n[0]===null&&n[1]===null)return!1;throw new s(e,u.InvalidParameter,r)})},t.functions.intersection=function(e,r){return t.standardFunctionAsync(e,r,(c,f,n)=>(A(n=o(n),e,r),n[0]===null||n[1]===null?null:Fn(n[0],n[1])))},t.functions.union=function(e,r){return t.standardFunctionAsync(e,r,(c,f,n)=>{const a=[];if((n=o(n)).length===0)throw new s(e,u.WrongNumberOfParameters,r);if(n.length===1)if(I(n[0])){const i=o(n[0]);for(let l=0;l<i.length;l++)if(i[l]!==null){if(!(i[l]instanceof d))throw new s(e,u.InvalidParameter,r);a.push(i[l])}}else{if(!F(n[0])){if(n[0]instanceof d)return j(P(n[0]),e.spatialReference);if(n[0]===null)return null;throw new s(e,u.InvalidParameter,r)}{const i=o(n[0].toArray());for(let l=0;l<i.length;l++)if(i[l]!==null){if(!(i[l]instanceof d))throw new s(e,u.InvalidParameter,r);a.push(i[l])}}}else for(let i=0;i<n.length;i++)if(n[i]!==null){if(!(n[i]instanceof d))throw new s(e,u.InvalidParameter,r);a.push(n[i])}return a.length===0?null:bn(a)})},t.functions.difference=function(e,r){return t.standardFunctionAsync(e,r,(c,f,n)=>(A(n=o(n),e,r),n[0]!==null&&n[1]===null?P(n[0]):n[0]===null?null:Nn(n[0],n[1])))},t.functions.symmetricdifference=function(e,r){return t.standardFunctionAsync(e,r,(c,f,n)=>(A(n=o(n),e,r),n[0]===null&&n[1]===null?null:n[0]===null?P(n[1]):n[1]===null?P(n[0]):xn(n[0],n[1])))},t.functions.clip=function(e,r){return t.standardFunctionAsync(e,r,(c,f,n)=>{if(n=o(n),h(n,2,2,e,r),!(n[1]instanceof S)&&n[1]!==null)throw new s(e,u.InvalidParameter,r);if(n[0]===null)return null;if(!(n[0]instanceof d))throw new s(e,u.InvalidParameter,r);return n[1]===null?null:Rn(n[0],n[1])})},t.functions.cut=function(e,r){return t.standardFunctionAsync(e,r,(c,f,n)=>{if(n=o(n),h(n,2,2,e,r),!(n[1]instanceof N)&&n[1]!==null)throw new s(e,u.InvalidParameter,r);if(n[0]===null)return[];if(!(n[0]instanceof d))throw new s(e,u.InvalidParameter,r);return n[1]===null?[P(n[0])]:Sn(n[0],n[1])})},t.functions.area=function(e,r){return t.standardFunctionAsync(e,r,async(c,f,n)=>{if(h(n,1,2,e,r),(n=o(n))[0]===null)return 0;if(D(n[0])){const a=await n[0].sumArea(O(w(n[1],-1)),!1,e.abortSignal);if(e.abortSignal.aborted)throw new s(e,u.Cancelled,r);return a}if(I(n[0])||F(n[0])){const a=Q(n[0],e.spatialReference);return a===null?0:Y(a,O(w(n[1],-1)))}if(!(n[0]instanceof d))throw new s(e,u.InvalidParameter,r);return Y(n[0],O(w(n[1],-1)))})},t.functions.areageodetic=function(e,r){return t.standardFunctionAsync(e,r,async(c,f,n)=>{if(h(n,1,2,e,r),(n=o(n))[0]===null)return 0;if(D(n[0])){const a=await n[0].sumArea(O(w(n[1],-1)),!0,e.abortSignal);if(e.abortSignal.aborted)throw new s(e,u.Cancelled,r);return a}if(I(n[0])||F(n[0])){const a=Q(n[0],e.spatialReference);return a===null?0:_(a,O(w(n[1],-1)))}if(!(n[0]instanceof d))throw new s(e,u.InvalidParameter,r);return _(n[0],O(w(n[1],-1)))})},t.functions.length=function(e,r){return t.standardFunctionAsync(e,r,async(c,f,n)=>{if(h(n,1,2,e,r),(n=o(n))[0]===null)return 0;if(D(n[0])){const a=await n[0].sumLength(p(w(n[1],-1)),!1,e.abortSignal);if(e.abortSignal.aborted)throw new s(e,u.Cancelled,r);return a}if(I(n[0])||F(n[0])){const a=U(n[0],e.spatialReference);return a===null?0:M(a,p(w(n[1],-1)))}if(!(n[0]instanceof d))throw new s(e,u.InvalidParameter,r);return M(n[0],p(w(n[1],-1)))})},t.functions.length3d=function(e,r){return t.standardFunctionAsync(e,r,(c,f,n)=>{if(h(n,1,2,e,r),(n=o(n))[0]===null)return 0;if(I(n[0])||F(n[0])){const a=U(n[0],e.spatialReference);return a===null?0:a.hasZ===!0?sn(a,p(w(n[1],-1))):M(a,p(w(n[1],-1)))}if(!(n[0]instanceof d))throw new s(e,u.InvalidParameter,r);return n[0].hasZ===!0?sn(n[0],p(w(n[1],-1))):M(n[0],p(w(n[1],-1)))})},t.functions.lengthgeodetic=function(e,r){return t.standardFunctionAsync(e,r,async(c,f,n)=>{if(h(n,1,2,e,r),(n=o(n))[0]===null)return 0;if(D(n[0])){const a=await n[0].sumLength(p(w(n[1],-1)),!0,e.abortSignal);if(e.abortSignal.aborted)throw new s(e,u.Cancelled,r);return a}if(I(n[0])||F(n[0])){const a=U(n[0],e.spatialReference);return a===null?0:k(a,p(w(n[1],-1)))}if(!(n[0]instanceof d))throw new s(e,u.InvalidParameter,r);return k(n[0],p(w(n[1],-1)))})},t.functions.distance=function(e,r){return t.standardFunctionAsync(e,r,(c,f,n)=>{n=o(n),h(n,2,3,e,r);let a=n[0];(I(n[0])||F(n[0]))&&(a=Z(n[0],e.spatialReference));let i=n[1];if((I(n[1])||F(n[1]))&&(i=Z(n[1],e.spatialReference)),!(a instanceof d))throw new s(e,u.InvalidParameter,r);if(!(i instanceof d))throw new s(e,u.InvalidParameter,r);return On(a,i,p(w(n[2],-1)))})},t.functions.distancegeodetic=function(e,r){return t.standardFunctionAsync(e,r,(c,f,n)=>{n=o(n),h(n,2,3,e,r);const a=n[0],i=n[1];if(!(a instanceof R))throw new s(e,u.InvalidParameter,r);if(!(i instanceof R))throw new s(e,u.InvalidParameter,r);const l=new N({paths:[],spatialReference:a.spatialReference});return l.addPath([a,i]),k(l,p(w(n[2],-1)))})},t.functions.densify=function(e,r){return t.standardFunctionAsync(e,r,(c,f,n)=>{if(n=o(n),h(n,2,3,e,r),n[0]===null)return null;if(!(n[0]instanceof d))throw new s(e,u.InvalidParameter,r);const a=b(n[1]);if(isNaN(a))throw new s(e,u.InvalidParameter,r);if(a<=0)throw new s(e,u.InvalidParameter,r);return n[0]instanceof x||n[0]instanceof N?$(n[0],a,p(w(n[2],-1))):n[0]instanceof S?$(an(n[0]),a,p(w(n[2],-1))):n[0]})},t.functions.densifygeodetic=function(e,r){return t.standardFunctionAsync(e,r,(c,f,n)=>{if(n=o(n),h(n,2,3,e,r),n[0]===null)return null;if(!(n[0]instanceof d))throw new s(e,u.InvalidParameter,r);const a=b(n[1]);if(isNaN(a))throw new s(e,u.InvalidParameter,r);if(a<=0)throw new s(e,u.InvalidParameter,r);return n[0]instanceof x||n[0]instanceof N?nn(n[0],a,p(w(n[2],-1))):n[0]instanceof S?nn(an(n[0]),a,p(w(n[2],-1))):n[0]})},t.functions.generalize=function(e,r){return t.standardFunctionAsync(e,r,(c,f,n)=>{if(n=o(n),h(n,2,4,e,r),n[0]===null)return null;if(!(n[0]instanceof d))throw new s(e,u.InvalidParameter,r);const a=b(n[1]);if(isNaN(a))throw new s(e,u.InvalidParameter,r);return jn(n[0],a,ln(w(n[2],!0)),p(w(n[3],-1)))})},t.functions.buffer=function(e,r){return t.standardFunctionAsync(e,r,(c,f,n)=>{if(n=o(n),h(n,2,3,e,r),n[0]===null)return null;if(!(n[0]instanceof d))throw new s(e,u.InvalidParameter,r);const a=b(n[1]);if(isNaN(a))throw new s(e,u.InvalidParameter,r);return a===0?P(n[0]):Dn(n[0],a,p(w(n[2],-1)))})},t.functions.buffergeodetic=function(e,r){return t.standardFunctionAsync(e,r,(c,f,n)=>{if(n=o(n),h(n,2,3,e,r),n[0]===null)return null;if(!(n[0]instanceof d))throw new s(e,u.InvalidParameter,r);const a=b(n[1]);if(isNaN(a))throw new s(e,u.InvalidParameter,r);return a===0?P(n[0]):Jn(n[0],a,p(w(n[2],-1)))})},t.functions.offset=function(e,r){return t.standardFunctionAsync(e,r,(c,f,n)=>{if(n=o(n),h(n,2,6,e,r),n[0]===null)return null;if(!(n[0]instanceof x||n[0]instanceof N))throw new s(e,u.InvalidParameter,r);const a=b(n[1]);if(isNaN(a))throw new s(e,u.InvalidParameter,r);const i=b(w(n[4],10));if(isNaN(i))throw new s(e,u.InvalidParameter,r);const l=b(w(n[5],0));if(isNaN(l))throw new s(e,u.InvalidParameter,r);return Ln(n[0],a,p(w(n[2],-1)),T(w(n[3],"round")).toLowerCase(),i,l)})},t.functions.rotate=function(e,r){return t.standardFunctionAsync(e,r,(c,f,n)=>{n=o(n),h(n,2,3,e,r);let a=n[0];if(a===null)return null;if(!(a instanceof d))throw new s(e,u.InvalidParameter,r);a instanceof S&&(a=x.fromExtent(a));const i=b(n[1]);if(isNaN(i))throw new s(e,u.InvalidParameter,r);const l=w(n[2],null);if(l===null)return en(a,i);if(l instanceof R)return en(a,i,l);throw new s(e,u.InvalidParameter,r)})},t.functions.centroid=function(e,r){return t.standardFunctionAsync(e,r,(c,f,n)=>{if(n=o(n),h(n,1,1,e,r),n[0]===null)return null;let a=n[0];if((I(n[0])||F(n[0]))&&(a=Z(n[0],e.spatialReference)),a===null)return null;if(!(a instanceof d))throw new s(e,u.InvalidParameter,r);return a instanceof R?j(P(n[0]),e.spatialReference):a instanceof x?a.centroid:a instanceof N?on(a):a instanceof E?dn(a):a instanceof S?a.center:null})},t.functions.multiparttosinglepart=function(e,r){return t.standardFunctionAsync(e,r,async(c,f,n)=>{n=o(n),h(n,1,1,e,r);const a=[];if(n[0]===null)return null;if(!(n[0]instanceof d))throw new s(e,u.InvalidParameter,r);if(n[0]instanceof R)return[j(P(n[0]),e.spatialReference)];if(n[0]instanceof S)return[j(P(n[0]),e.spatialReference)];const i=await rn(n[0]);if(i instanceof x){const l=[],y=[];for(let m=0;m<i.rings.length;m++)if(i.isClockwise(i.rings[m])){const g=B({rings:[i.rings[m]],hasZ:i.hasZ===!0,hazM:i.hasM===!0,spatialReference:i.spatialReference.toJSON()});l.push(g)}else y.push({ring:i.rings[m],pt:i.getPoint(m,0)});for(let m=0;m<y.length;m++)for(let g=0;g<l.length;g++)if(l[g].contains(y[m].pt)){l[g].addRing(y[m].ring);break}return l}if(i instanceof N){const l=[];for(let y=0;y<i.paths.length;y++){const m=B({paths:[i.paths[y]],hasZ:i.hasZ===!0,hazM:i.hasM===!0,spatialReference:i.spatialReference.toJSON()});l.push(m)}return l}if(n[0]instanceof E){const l=j(P(n[0]),e.spatialReference);for(let y=0;y<l.points.length;y++)a.push(l.getPoint(y));return a}return null})},t.functions.issimple=function(e,r){return t.standardFunctionAsync(e,r,(c,f,n)=>{if(n=o(n),h(n,1,1,e,r),n[0]===null)return!0;if(!(n[0]instanceof d))throw new s(e,u.InvalidParameter,r);return Cn(n[0])})},t.functions.simplify=function(e,r){return t.standardFunctionAsync(e,r,(c,f,n)=>{if(n=o(n),h(n,1,1,e,r),n[0]===null)return null;if(!(n[0]instanceof d))throw new s(e,u.InvalidParameter,r);return rn(n[0])})},t.functions.convexhull=function(e,r){return t.standardFunctionAsync(e,r,(c,f,n)=>{if(n=o(n),h(n,1,1,e,r),n[0]===null)return null;if(!(n[0]instanceof d))throw new s(e,u.InvalidParameter,r);return Mn(n[0])})},t.functions.getuser=function(e,r){return t.standardFunctionAsync(e,r,async(c,f,n)=>{h(n,0,2,e,r);let a=w(n[1],""),i=a===!0;if(a=a===!0||a===!1?"":T(a),n.length===0||n[0]instanceof X){let y=null;y=e.services?.portal?e.services.portal:H.getDefault(),n.length>0&&(y=G(n[0],y));const m=await tn(y,a,i);if(m){const g=JSON.parse(JSON.stringify(m));for(const v of["lastLogin","created","modified"])g[v]!==void 0&&g[v]!==null&&(g[v]=new Date(g[v]));return J.convertObjectToArcadeDictionary(g,L(e))}return null}let l=null;if(D(n[0])&&(l=n[0]),l){if(i=!1,a)return null;await l.load();const y=await l.getOwningSystemUrl();if(!y){if(!a){const v=await l.getIdentityUser();return v?J.convertObjectToArcadeDictionary({username:v},L(e)):null}return null}let m=null;m=e.services?.portal?e.services.portal:H.getDefault(),m=G(new X(y),m);const g=await tn(m,a,i);if(g){const v=JSON.parse(JSON.stringify(g));for(const z of["lastLogin","created","modified"])v[z]!==void 0&&v[z]!==null&&(v[z]=new Date(v[z]));return J.convertObjectToArcadeDictionary(v,L(e))}return null}throw new s(e,u.InvalidParameter,r)})}),t.functions.nearestcoordinate=function(e,r){return t.standardFunctionAsync(e,r,async(c,f,n)=>{if(n=o(n),h(n,2,2,e,r),!(n[0]instanceof d||n[0]===null))throw new s(e,u.InvalidParameter,r);if(!(n[1]instanceof R||n[1]===null))throw new s(e,u.InvalidParameter,r);if(n[0]===null||n[1]===null)return null;const a=await zn(n[0],n[1]);return a===null?null:J.convertObjectToArcadeDictionary({coordinate:a.coordinate,distance:a.distance},L(e),!1,!0)})},t.functions.nearestvertex=function(e,r){return t.standardFunctionAsync(e,r,async(c,f,n)=>{if(n=o(n),h(n,2,2,e,r),!(n[0]instanceof d||n[0]===null))throw new s(e,u.InvalidParameter,r);if(!(n[1]instanceof R||n[1]===null))throw new s(e,u.InvalidParameter,r);if(n[0]===null||n[1]===null)return null;const a=await Tn(n[0],n[1]);return a===null?null:J.convertObjectToArcadeDictionary({coordinate:a.coordinate,distance:a.distance},L(e),!1,!0)})}}export{Vn as registerFunctions};
