import{bv as A,v0 as bt,v1 as he,v2 as ue,dT as w,fB as Mt,v3 as Y,m9 as gt,o_ as de,m7 as jt,dR as Qt,dQ as ge,v4 as ye,v5 as ve,fA as St,m as ot,cB as me,cA as fe,v6 as Bt,J as Yt,A as _e,a1 as xe,kg as we,b2 as Jt,m6 as Te,v7 as Oe,hJ as $e,v8 as be,dS as yt,eq as Me,v9 as It,va as Se,vb as Ie,vc as Ve,vd as Ce,jw as X,dO as vt,b$ as Vt,ve as Pe,vf as Re,ek as Ct,vg as K,vh as ke,vi as De,e8 as Ge,el as Ee,vj as ze,vk as He,ej as Fe,vl as Ue,$ as s,a0 as a,a2 as b,a3 as Xt,sB as Ze,i3 as We,c3 as _t,vm as rt,eA as st,ci as Le,ak as W,vn as Ae,ae as R,vo as Ne,P as qe,at as Pt,tW as xt,mt as je,as as tt,Z as Qe,vp as Be,eD as Ye,vq as Je,pc as Xe,eG as Ke,k8 as Rt,lE as ti,ai as ei,kf as kt,jT as Kt,k7 as te,mc as ii,oA as ni,kK as oi,vr as at,vs as Dt,ng as Gt,vt as Et,po as ri,iA as F,oS as q,vu as zt,vv as si,vw as ai,es as li,l_ as pt,l$ as Ht}from"./chunk-ERvgPDZ8.js";import{t as j}from"./chunk-uBdPJ80n.js";import{o as et,b as mt,s as ee,h as O,i as it,f as wt,c as ie,e as L,l as pi}from"./chunk-WlB6dZg0.js";import{simplify as ci,distance as hi}from"./chunk-bv7cXW6z.js";import{l as ui,d as ct,C as di}from"./chunk-ucWCRfrt.js";import{i as ne}from"./chunk-VCiPqOSn.js";import{s as N,p as gi,d as yi,a as ht,u as vi}from"./chunk-WxjI5FYO.js";import{o as Ft}from"./chunk-QH844HO2.js";import{r as Ut}from"./chunk-9aoAXE74.js";import{w as mi,V as fi,p as _i,l as xi,t as wi,a as Ti,s as Oi,c as $i}from"./chunk-XGADDlqd.js";import{e as Zt}from"./chunk-k0PlJ90R.js";import{p as bi,f as Mi}from"./chunk-wKf945Vl.js";function nt(e,t,i=null){return i!=null?[e,t,i]:[e,t]}function m(e,t,i=null){return i!=null?{x:e,y:t,z:i}:{x:e,y:t}}let oe=class{constructor(t){this.spatialReference=t}mapToLocalMultiple(t){return t.map(i=>this.mapToLocal(i)).filter(ot)}get doUnnormalization(){return!1}},Si=class extends oe{constructor(t,i,n=null){super(i),this._defaultZ=n,this.transform=bt(),this.transformInv=bt(),this.transform=he(t),ue(this.transformInv,this.transform)}makeMapPoint(t,i){return nt(t,i,this._defaultZ)}mapToLocal(t){return m(this.transform[0]*t[0]+this.transform[2]*t[1]+this.transform[4],this.transform[1]*t[0]+this.transform[3]*t[1]+this.transform[5])}localToMap(t){return nt(this.transformInv[0]*t.x+this.transformInv[2]*t.y+this.transformInv[4],this.transformInv[1]*t.x+this.transformInv[3]*t.y+this.transformInv[5],this._defaultZ)}},Ii=class extends oe{constructor(t,i){super(t.spatialReference),this.view=t,this.defaultZ=null,this.pWS=w(),this.tangentFrameUpWS=w(),this.tangentFrameRightWS=w(),this.tangentFrameForwardWS=w(),this.localFrameRightWS=w(),this.localFrameUpWS=w(),this.worldToLocalTransform=Mt(),this.localToWorldTransform=Mt(),this.scale=1,this.scale=t.resolution,this.referenceMapPoint=i,this.defaultZ=i.hasZ?i.z:null;const n=t.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Y.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Y.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Y.Z,this.tangentFrameForwardWS);const o=w();gt(o,this.tangentFrameForwardWS,de(n,this.tangentFrameForwardWS)),jt(this.localFrameRightWS,n,o),Qt(this.localFrameRightWS,this.localFrameRightWS),ge(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),ye(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),ve(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return this.view.viewingMode==="global"}makeMapPoint(t,i){return nt(t,i,this.defaultZ)}mapToLocal(t){const i=w();this.view.renderCoordsHelper.toRenderCoords(new A({x:t[0],y:t[1],spatialReference:this.spatialReference}),i),St(i,i,this.worldToLocalTransform);const n=this.view.renderCoordsHelper.fromRenderCoords(i,this.view.spatialReference);return n!=null?m(n.x/this.scale,n.y/this.scale):null}localToMap(t){const i=w();this.view.renderCoordsHelper.toRenderCoords(new A({x:t.x*this.scale,y:t.y*this.scale,spatialReference:this.spatialReference}),i),St(i,i,this.localToWorldTransform);const n=this.view.renderCoordsHelper.fromRenderCoords(i,this.view.spatialReference);return n!=null?nt(n.x,n.y,this.defaultZ):null}};function Wt(e,t){if(e.type==="2d")return new Si(e.state.transform,e.spatialReference,t.length>2?t[2]:null);if(e.type==="3d"){const i=t.length>2?new A({x:t[0],y:t[1],z:t[2],spatialReference:e.spatialReference}):new A({x:t[0],y:t[1],spatialReference:e.spatialReference});return new Ii(e,i)}return null}function G(e,t){const i=new A({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(i.z=e[2]),i}function Vi(e,t){return new me({points:e,spatialReference:t})}function Lt(e,t,i){const n=new fe({paths:e,spatialReference:t});return i&&Bt(n),n}function E(e,t,i,n=!0){const o=Yt(e);o.forEach(l=>{const h=l[0],p=l[l.length-1];_e(h,p)&&l.length!==1||l.push(l[0])});let r=new xe({rings:o,spatialReference:t});return r.rings.forEach(l=>{we(l)||l.reverse()}),i&&Bt(r),n&&r.isSelfIntersecting&&Jt(t)&&(r=ci(r)),r}function At(e,t,i){const n=t.mapToLocalMultiple(e),o=[],r={x:n[0].x,y:n[0].y},l={x:n[1].x,y:n[1].y},h=Math.round(l.x-r.x),p=Math.round(l.y-r.y),c=Math.max(Math.abs(h),Math.abs(p));if(i){const d={x:r.x+c,y:r.y+c},v={x:r.x-c,y:r.y-c};o.push(m(d.x,v.y),m(v.x,v.y),m(v.x,d.y),m(d.x,d.y))}else{const d={x:h>0?r.x+c:r.x-c,y:p>0?r.y+c:r.y-c};o.push(m(r.x,r.y),m(d.x,r.y),m(d.x,d.y),m(r.x,d.y))}return re(E([o.map(d=>t.localToMap(d)).filter(ot)],t.spatialReference,t.doUnnormalization,!0),o,t)}function Ci(e,t,i){let n=t.mapToLocalMultiple(e);if(n.length===1){const p=n[0];n=[m(p.x-48,p.y+48),m(p.x+48,p.y-48),m(p.x+48,p.y-48),m(p.x-48,p.y+48)]}const o=[],r={x:n[0].x,y:n[0].y},l={x:n[1].x,y:n[1].y};if(i){const h=Math.round(l.x-r.x),p=Math.round(l.y-r.y);o.push(m(r.x-h,r.y-p),m(l.x,r.y-p),m(l.x,l.y),m(r.x-h,l.y))}else o.push(m(r.x,r.y),m(l.x,r.y),m(l.x,l.y),m(r.x,l.y));return re(E([o.map(h=>t.localToMap(h)).filter(ot)],t.spatialReference,t.doUnnormalization,!0),o,t)}function re(e,t,i){const n=Q(t[3],t[2],i),o=Q(t[1],t[2],i),r=Q(t[0],t[1],i),l=Q(t[0],t[3],i);return{geometry:e,midpoints:n!=null&&o!=null&&r!=null&&l!=null?{top:n,right:o,bottom:r,left:l}:null}}function Q(e,t,i){U[0]=e.x,U[1]=e.y,U[2]=0,Z[0]=t.x,Z[1]=t.y,Z[2]=0,Te(U,U,Z,.5),B.x=U[0],B.y=Z[1],B.z=Z[2];const n=i.localToMap(B);return n!=null?G(n,i.spatialReference):null}const B=m(0,0,0),U=w(),Z=w();function Nt(e,t,i,n){const o=t.mapToLocalMultiple(e);let r=null,l=null;if(i)r=o[0],l=o[1];else{const f=o[0],T=o[1],z=Math.round(T.x-f.x),H=Math.round(T.y-f.y),M=Math.max(Math.abs(z),Math.abs(H));r=m(z>0?f.x+M/2:f.x-M/2,H>0?f.y+M/2:f.y-M/2),l=m(Math.abs(z)>Math.abs(H)?r.x-M/2:r.x,Math.abs(z)>Math.abs(H)?r.y:r.y-M/2)}const h=t.localToMap(r),p=t.localToMap(l);if(h==null||p==null)return null;t.doUnnormalization&&Oe([[h,p]],t.spatialReference);const c=G(h,t.spatialReference),d=G(p,t.spatialReference),v=$e(t.spatialReference);let u=0;if(Jt(t.spatialReference))u=v*hi(c,d,null);else{const f=r.x-l.x,T=r.y-l.y;u=v*Math.sqrt(f*f+T*T)*(n||1)}const x=new be({center:c,radius:u,radiusUnit:"meters",spatialReference:t.spatialReference});return{geometry:E(x.rings,x.spatialReference,!1),center:c,edge:d}}function Pi(e,t,i){const n=t.mapToLocalMultiple(e),o=n[0],r=n[1],l=Math.round(r.x-o.x),h=Math.round(r.y-o.y),p=m(i?o.x:o.x+l/2,i?o.y:o.y+h/2),c=i?l:l/2,d=i?h:h/2,v=60,u=[],x=2*Math.PI/v;function f(C){const pe=Math.cos(C),ce=Math.sin(C);return m(c*pe+p.x,d*ce+p.y)}for(let C=0;C<v;C++)u.push(f(C*x));u.push(u[0]);const{spatialReference:T,doUnnormalization:z}=t,H=E([u.map(C=>t.localToMap(C)).filter(ot)],T,z,!1),M=t.localToMap(f(Math.PI/2)),Tt=t.localToMap(f(0)),Ot=t.localToMap(f(-Math.PI/2)),$t=t.localToMap(f(Math.PI));return{geometry:H,midpoints:M!=null&&Tt!=null&&Ot!=null&&$t!=null?{top:G(M,T),right:G(Tt,T),bottom:G(Ot,T),left:G($t,T)}:null}}function ut(e,t){switch(e){case"point":case"multipoint":return Ri();case"polyline":return ki(t);case"polygon":return Di(t);default:return}}function Ri(e){return"point"}function ki(e){return(e!=null&&e.type==="polyline"&&e.paths.length?e.paths[0].length:0)<2?"polylineZeroVertices":"polylineOneVertex"}function Di(e){const t=e!=null&&e.type==="polygon"&&e.rings.length?e.rings[0].length:0;return t<3?"polylineZeroVertices":t<4?"polygonOneVertex":"polygonTwoVertices"}const Gi=(()=>{const e=w(),t=w(),i=w();return(n,o)=>{if(yt(t,n.x,n.y,n.z??0),yt(i,o.x,o.y,o.z??0),Me(t,i))return null;if(!It(t,n.spatialReference,t)||!It(i,o.spatialReference,i)){jt(e,i,t),e[2]=0,Qt(e,e);let l=Se(Ie,e);return e[0]<0&&(l=2*Math.PI-l),et(l,"radians","geographic")}const{azimuth:r}=Ve(zi,t,i);return r!=null?et(r,"degrees","geographic"):void 0}})(),Ei=(()=>{const e=w(),t=w();return({x:i,y:n,z:o,spatialReference:r},l,h)=>{const p=o??0;yt(e,i,n,p);const c=mt(X(h.value,h.unit,"degrees"),h.rotationType,"geographic");if(!vt(e,r,e,Vt.WGS84)){const d=mt(c,"geographic","arithmetic"),v=X(d,"degrees","radians");return new A({x:i+l*Math.cos(v),y:n+l*Math.sin(v),z:p,spatialReference:r})}return Pe(t,e,c,l),t[2]=p,Re(t,Vt.WGS84,r)}})(),zi=new Ce;function Hi(e,t,i,n){if(!t)return;const{spatialReference:o}=e;if(!Ct(o))return;const r=ne(o),l=Ct(r);if(!l)return;const h=K(e,i,n),p=Wi;if(!vt(h,o,p,r))return;const c=ee(t,l);if(i?.type==="3d"&&i.viewingMode==="local")p[0]+=c;else{const v=ke(r),u=De(v,p,Y.X,Li);Ge(p,p,u,c)}if(!vt(p,r,p,o))return;const d=Ee(h,p);return new ze(h,d)}function Fi(e,t,i,n){if(!t)return;const o=K(e,i,n),r=Ei(e,1,t);if(!r)return;const l=K(r,i,n);return new He(o,l)}function Ui(e,t,i,n){if(e==null)return;const o=ne(t),r=Fe(o);return r?new Ue(ee(e,r)):void 0}function Zi(e){let t;for(const i of e)i&&(t=t?.intersect(i)??i);return t}const Wi=w(),Li=w();let _=class extends Xt{constructor(t){super(t),this.committed=null,this.disabled=!1,this.hidden=!1,this.id=Ze(),this.inputValue=null,this.readOnly=!1}get dirty(){return this.inputValue!=null}get locked(){return this.committed!=null}lock(t){this.inputValue=null,this.committed=t??this.actual}unlock(){this.committed=null,this.inputValue=null}};s([a()],_.prototype,"actual",void 0),s([a()],_.prototype,"committed",void 0),s([a()],_.prototype,"createQuantity",void 0),s([a()],_.prototype,"disabled",void 0),s([a()],_.prototype,"hidden",void 0),s([a()],_.prototype,"format",void 0),s([a()],_.prototype,"id",void 0),s([a()],_.prototype,"inputValue",void 0),s([a()],_.prototype,"readOnly",void 0),s([a()],_.prototype,"suffix",void 0),s([a()],_.prototype,"title",void 0),s([a()],_.prototype,"toInputUnits",void 0),s([a()],_.prototype,"dirty",null),s([a()],_.prototype,"locked",null),_=s([b("esri.views.interactive.tooltip.fields.TooltipField")],_);let J=class extends _{constructor(t){super(t),this.mode="absolute-height"}normalizeCtorArgs(t){const i=n=>n.inputUnitInfos.verticalLength.unit;return{actual:O,createQuantity:(n,o)=>it(n,i(o)),toInputUnits:(n,o)=>wt(n,i(o)),format:(n,o)=>o.formatters.verticalLength(n),suffix:n=>n.inputUnitInfos.verticalLength.abbreviation,title:n=>n.messages.sketch.elevation,...t}}};s([a()],J.prototype,"mode",void 0),J=s([b("esri.views.interactive.tooltip.fields.TooltipFieldElevation")],J);const se=e=>{const t=i=>i.inputUnitInfos.orientation.unit;return new _({actual:ie,createQuantity:(i,n)=>et(i,t(n),"geographic"),toInputUnits:({value:i,unit:n,rotationType:o},r)=>{const p=mt(X(i,n,"degrees"),o,"geographic"),c=We.normalize(p,0,!0),d=t(r),v=X(c,"degrees",d);return et(v,d,"geographic")},format:(i,n)=>n.formatters.angle(i),suffix:i=>i.inputUnitInfos.orientation.abbreviation,title:i=>i.messages.sketch.orientation,...e})},ft=e=>{const t=i=>i.inputUnitInfos.length.unit;return new _({actual:O,createQuantity:(i,n)=>it(i,t(n)),toInputUnits:(i,n)=>wt(i,t(n)),format:(i,n)=>n.formatters.length(i),suffix:i=>i.inputUnitInfos.length.abbreviation,title:i=>i.messages.sketch.distance,...e})},lt=e=>new J(e),Ai=e=>{const t=i=>i.inputUnitInfos.area.unit;return new _({actual:L,createQuantity:(i,n)=>pi(i,t(n)),toInputUnits:(i,n)=>wt(i,t(n)),format:(i,n)=>n.formatters.area(i),suffix:i=>i.inputUnitInfos.area.abbreviation,title:i=>i.messages.sketch.area,...e})};let k=class extends N{constructor(t){super(t),this.type="draw-point",this.elevation=lt()}get allFields(){return[this.elevation]}};s([a()],k.prototype,"type",void 0),s([a()],k.prototype,"elevation",void 0),s([a()],k.prototype,"allFields",null),s([a()],k.prototype,"helpMessage",void 0),k=s([b("esri.views.interactive.tooltip.DrawPointTooltipInfo")],k);let $=class extends N{constructor(e){super(e),this.type="draw-polyline",this.orientation=se(),this.distance=ft({title:t=>t.messages.sketch.distance}),this.elevation=lt(),this.totalLength=ft({format:(t,i)=>i.formatters.totalLength(t),title:t=>t.messages.sketch.totalLength,readOnly:!0})}get allFields(){return[this.orientation,this.distance,this.elevation,this.totalLength]}};s([a()],$.prototype,"type",void 0),s([a()],$.prototype,"orientation",void 0),s([a()],$.prototype,"distance",void 0),s([a()],$.prototype,"elevation",void 0),s([a()],$.prototype,"totalLength",void 0),s([a()],$.prototype,"allFields",null),s([a()],$.prototype,"helpMessage",void 0),$=s([b("esri.views.interactive.tooltip.DrawPolylineTooltipInfo")],$);let I=class extends N{constructor(t){super(t),this.type="draw-polygon",this.orientation=se(),this.distance=ft({title:i=>i.messages.sketch.distance}),this.elevation=lt(),this.area=Ai({readOnly:!0})}get allFields(){return[this.orientation,this.distance,this.elevation,this.area]}};s([a()],I.prototype,"type",void 0),s([a()],I.prototype,"distance",void 0),s([a()],I.prototype,"elevation",void 0),s([a()],I.prototype,"area",void 0),s([a()],I.prototype,"allFields",null),s([a()],I.prototype,"helpMessage",void 0),I=s([b("esri.views.interactive.tooltip.DrawPolygonTooltipInfo")],I);let D=class extends N{constructor(t){super(t),this.type="draw-mesh",this.elevation=lt()}get allFields(){return[this.elevation]}};s([a()],D.prototype,"type",void 0),s([a()],D.prototype,"elevation",void 0),s([a()],D.prototype,"allFields",null),s([a()],D.prototype,"helpMessage",void 0),D=s([b("esri.views.interactive.tooltip.DrawMeshTooltipInfo")],D);let P=class extends N{constructor(t){super(t),this.type="draw-rectangle",this.xSize=O,this.ySize=O,this.area=L}get allFields(){return[]}};s([a()],P.prototype,"type",void 0),s([a()],P.prototype,"xSize",void 0),s([a()],P.prototype,"ySize",void 0),s([a()],P.prototype,"area",void 0),s([a()],P.prototype,"allFields",null),P=s([b("esri.views.interactive.tooltip.DrawRectangleTooltipInfo")],P);let V=class extends N{constructor(e){super(e),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=L}get allFields(){return[]}};s([a()],V.prototype,"type",void 0),s([a()],V.prototype,"radius",void 0),s([a()],V.prototype,"xSize",void 0),s([a()],V.prototype,"ySize",void 0),s([a()],V.prototype,"area",void 0),s([a()],V.prototype,"allFields",null),V=s([b("esri.views.interactive.tooltip.DrawCircleTooltipInfo")],V);class Ni{constructor(){this.regularVertices=null,this.activeVertex=null,this.full=null,this.outline=null,this.circle=null,this.rectangle=null}}let g=class extends _t.EventedMixin(ui){constructor(e){super(e),this._graphic=null,this._createOperationGeometry=null,this.defaultZ=0,this.geometryType=null,this.hasZ=!0,this.labelOptions=new rt,this.geometryToPlace=null,this.mode=null,this.snappingManager=null,this.snapToScene=!1,this.tooltip=null,this.tooltipOptions=new st,this._getPointConstraint=j(t=>t),this._getPolylineOrPolygonConstraint=j((t,i,n)=>Zi([t,i,n])),this._getDistanceConstraint=j(Hi),this._getOrientationConstraint=j(Fi),this._getElevationConstraint=j(Ui)}initialize(){this.internalGraphicsLayer=new Le({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer),this.drawOperation=this.makeDrawOperation();const e=this.tooltipOptions,t=this.view.type;this.tooltipInfos={point:new k({tooltipOptions:e,viewType:t}),polyline:new $({tooltipOptions:e,viewType:t}),polygon:new I({tooltipOptions:e,viewType:t}),mesh:new D({tooltipOptions:e,viewType:t}),rectangle:new P({tooltipOptions:e}),circle:new V({tooltipOptions:e})},this.addHandles([this.drawOperation.on("vertex-add",i=>this.onVertexAdd(i)),this.drawOperation.on("vertex-remove",i=>this.onVertexRemove(i)),this.drawOperation.on("vertex-update",i=>this.onVertexUpdate(i)),this.drawOperation.on("cursor-update",i=>this.onCursorUpdate(i)),this.drawOperation.on("complete",i=>this.onComplete(i)),W(()=>this.cursor,i=>{this.drawOperation.cursor=i},tt),W(()=>this.tooltipOptions.enabled,i=>{this.tooltip=i?new vi({view:this.view,info:this._tooltipInfo}):R(this.tooltip)},tt),Ae(()=>this._updateTooltipInfo())]),this.finishToolCreation()}destroy(){this.drawOperation=R(this.drawOperation),this.tooltip=R(this.tooltip),this._destroyAllVisualisations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=R(this.internalGraphicsLayer),this._set("view",null)}get _defaultElevation(){return it(this.defaultZ,"meters")}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(e){this._set("centered",e),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(e){this._set("cursor",e)}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(e){this._set("graphicSymbol",e),this._graphic!=null&&(this._graphic.symbol=e)}get updating(){return this.drawOperation?.updating??!1}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){const t=this._tooltipInfo;if(e.type==="key-down"&&e.key===Ne.enterInputMode&&t!=null&&t.editableFields.length>0&&this.tooltipOptions.inputEnabled)return t.enterInputMode(),void e.stopPropagation();this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo()}_destroyAllVisualisations(){this.removeHandles(S.outline),this.removeHandles(S.regularVertices),this.removeHandles(S.activeVertex),this.removeHandles(dt)}_createOrUpdateGraphic(e){if(this._graphic!=null)return this.updateGraphicGeometry(this._graphic,e),this._graphic;const t=this._graphic=new qe({...this.graphicProperties,symbol:this.graphicSymbol});return this.updateGraphicGeometry(t,e),this.internalGraphicsLayer.add(t),this.addHandles(this.initializeGraphic(t)),this.notifyChange("graphic"),this.addHandles(Pt(()=>{this.internalGraphicsLayer.remove(t),R(t),this._graphic===t&&(this._graphic=null)}),dt),t}updateGraphicGeometry(e,t){e.geometry=t}_getCreateOperationGeometry(e={operationComplete:!1}){const{drawOperation:t}=this;if(t==null||t.numVertices===0)return null;const{coordinateHelper:i,view:n}=t,o=t.stagedVertex,r=t.committedVertices,l=r.slice(),h=o!=null;h&&l.push(i.pointToArray(o));const p=h?i.pointToArray(o):r.splice(-1)[0],c=l.length,d=n.spatialReference,v=n.type==="3d"&&n.viewingMode==="global",u=new Ni;switch(this.geometryType){case"point":case"mesh":u.regularVertices=r,u.activeVertex=p,u.full=i.arrayToPoint(l[0]);break;case"multipoint":u.regularVertices=r,u.activeVertex=p,c>0&&(u.full=Vi(l,d));break;case"polyline":u.regularVertices=r,u.activeVertex=p,c>0&&(u.full=Lt([l],d,v));break;case"polygon":u.regularVertices=r,u.activeVertex=p,c>0&&(u.full=E([l],d,v,!0));break;case"circle":if(c>0){const x=Wt(n,l[0]);if(c===1&&e.operationComplete){const f=l[0],T=x.makeMapPoint(f[0]+qt*n.resolution,f[1]);u.circle=Nt([f,T],x,!0),u.full=u.circle!=null?u.circle.geometry:null}else c===2&&(this.forceUniformSize?(u.circle=Nt(l,x,this.centered),u.full=u.circle!=null?u.circle.geometry:null):(u.rectangle=Pi(l,x,this.centered),u.full=u.rectangle.geometry))}break;case"rectangle":if(c>0){const x=Wt(n,l[0]);if(c===1&&e.operationComplete){const f=l[0],T=x.makeMapPoint(f[0]+qt*n.resolution,f[1]);u.rectangle=At([f,T],x,!0),u.full=u.rectangle.geometry}else c===2&&(u.rectangle=this.forceUniformSize?At(l,x,this.centered):Ci(l,x,this.centered),u.full=u.rectangle.geometry)}break;default:return null}switch(this.geometryType){case"point":case"multipoint":break;case"polyline":u.outline=c>1?Lt([l],d,v):null;break;case"polygon":u.outline=c>1?E([l],d,v):null;break;case"circle":case"rectangle":u.outline=u.full?.type==="polygon"?E(u.full.rings,d,v):null}return u}initializeGraphic(e){return Pt()}onComplete(e){this._updateGraphic();let t=null;if(this.drawOperation.isCompleted){const i=this._getCreateOperationGeometry({operationComplete:!0});i!=null&&(t=this._createOrUpdateGraphic(i.full).clone())}this._createOperationGeometry=null,this.emit("complete",{graphic:t,...e})}onCursorUpdate(e){this._updateGraphic(),this.emit("cursor-update",e)}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}onVertexAdd(e){this._updateGraphic(),this._clearConstraints(),this.emit("vertex-add",e)}onVertexRemove(e){this._updateGraphic(),this._clearConstraints(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateGraphic(),this.emit("vertex-update",e)}_updateGraphic(){const e=this._getCreateOperationGeometry();this._createOperationGeometry=e,e!=null?(e.outline!=null?this.addHandles(this.onOutlineChanged(e.outline),S.outline):this.removeHandles(S.outline),e.regularVertices!=null?this.addHandles(this.onRegularVerticesChanged(e.regularVertices),S.regularVertices):this.removeHandles(S.regularVertices),e.activeVertex!=null?this.addHandles(this.onActiveVertexChanged(e.activeVertex),S.activeVertex):this.removeHandles(S.activeVertex),e.full!=null?this._createOrUpdateGraphic(e.full):this.removeHandles(dt)):this._destroyAllVisualisations()}get _tooltipInfo(){const{drawOperation:e,graphic:t,view:i}=this;if(!e)return null;const n=this.tooltipInfos,o=t?.geometry?.type;switch(this.geometryType){case"point":return i.type==="2d"&&this.defaultZ===0?null:o==="point"?n.point:null;case"polyline":return o==="polyline"?n.polyline:null;case"polygon":return o==="polygon"?n.polygon:null;case"rectangle":return o==="polygon"?n.rectangle:null;case"circle":return o==="polygon"?n.circle:null;case"mesh":return o==="mesh"?n.mesh:null;default:return null}}_updateTooltipInfo(){const{_tooltipInfo:e,tooltip:t}=this;if(e&&t){switch(e.type){case"draw-point":this._updateDrawPointTooltipInfo(e);break;case"draw-polyline":this._updateDrawPolylineTooltipInfo(e);break;case"draw-polygon":this._updateDrawPolygonTooltipInfo(e);break;case"draw-rectangle":this._updateDrawRectangleTooltipInfo(e);break;case"draw-circle":this._updateDrawCircleTooltipInfo(e);break;case"draw-mesh":this.updateDrawMeshTooltipInfo(e)}t.info=e}}_updateDrawPointTooltipInfo(e){const{drawOperation:t,graphic:i,view:n,tooltipOptions:o}=this,{elevationInfo:r,stagedVertex:l}=t;if(e.tooltipOptions=o,e.viewType=n.type,e.helpMessage=ut("point",i?.geometry),this.updateElevation(e.elevation),!l)return void(t.constraint=void 0);const h=t.coordinateHelper.spatialReference;t.constraint=this._getPointConstraint(this._getElevationConstraint(e.elevation.committed,h,n,r))}_updateDrawPolylineTooltipInfo(e){const t=this._createOperationGeometry,i=t!=null?t.full:null;if(i?.type!=="polyline")return;const{drawOperation:n,tooltipOptions:o,view:r}=this,{lastVertex:l,stagedVertex:h}=n;this._updatePolylineOrPolygonCommon(e,h);const p=gi(i,this._elevationMode);e.totalLength.actual=p??O,e.totalLength.hidden=length==null||!l,e.tooltipOptions=o,e.viewType=r.type,e.helpMessage=ut("polyline",i),this.updateElevation(e.elevation)}_updateDrawPolygonTooltipInfo(e){const t=this._createOperationGeometry,i=t!=null?t.full:null;if(i?.type!=="polygon")return;const{drawOperation:n,tooltipOptions:o,view:r}=this,{lastVertex:l}=n;let h=n.stagedVertex;i?.type==="polygon"&&l&&!h&&(h=i.getPoint(0,i.rings[0].length-1)),this._updatePolylineOrPolygonCommon(e,h);const p=Ft(i,this._elevationMode);e.area.actual=p??L,e.area.hidden=p==null&&!l,e.tooltipOptions=o,e.viewType=r.type,e.helpMessage=ut("polygon",i),this.updateElevation(e.elevation)}_updatePolylineOrPolygonCommon(e,t){const{view:i,drawOperation:n}=this,{elevationInfo:o,lastVertex:r}=n;if(!r||!t)return e.distance.hidden=!0,e.orientation.hidden=!0,void(n.constraint=void 0);const l=yi(r,t,this._elevationMode);e.distance.actual=l??O,e.distance.hidden=!1;const h=Gi(r,t);e.orientation.actual=h??ie,e.orientation.hidden=!1;const p=n.coordinateHelper.spatialReference;n.constraint=this._getPolylineOrPolygonConstraint(this._getDistanceConstraint(r,e.distance.committed,i,o),this._getOrientationConstraint(r,e.orientation.committed,i,o),this._getElevationConstraint(e.elevation.committed,p,i,o))}updateDrawMeshTooltipInfo(e){}_updateDrawRectangleTooltipInfo(e){e.tooltipOptions=this.tooltipOptions,e.xSize=this._xSize??O,e.ySize=this._ySize??O,e.area=this._fullGeometryArea??L}_updateDrawCircleTooltipInfo(e){const{forceUniformSize:t}=this;e.tooltipOptions=this.tooltipOptions,e.radius=t?this._circleRadius??O:null,e.xSize=t?null:this._xSize??O,e.ySize=t?null:this._ySize??O,e.area=this._fullGeometryArea??L}get _circleRadius(){const e=this._createOperationGeometry;return e?.circle?.center!=null&&e.circle.edge!=null?ht(e.circle.center,e.circle.edge,this._elevationMode):null}get _xSize(){const e=this._createOperationGeometry?.rectangle?.midpoints;return e!=null?ht(e.left,e.right,this._elevationMode):null}get _ySize(){const e=this._createOperationGeometry?.rectangle?.midpoints;return e!=null?ht(e.top,e.bottom,this._elevationMode):null}get _fullGeometryArea(){const e=this._createOperationGeometry?.full;return e?.type!=="polygon"?null:Ft(e,this._elevationMode)}updateElevation(e){e.actual=this._vertexTooltipElevation}get _vertexTooltipElevation(){const{tooltipOptions:e,view:t,drawOperation:i}=this;if(i==null)return this._defaultElevation;const n=i.stagedVertex??i.lastVertex;if(n==null||t.type==="2d")return this._defaultElevation;const o={mode:e.elevation.mode,offset:0},r=(xt(t,n,i.elevationInfo,o)??0)*je(n.spatialReference);return it(r,"meters")}get _elevationMode(){return this.drawOperation.isDraped?"on-the-ground":"absolute-height"}_clearConstraints(){for(const[,e]of Object.entries(this.tooltipInfos))e.unlockAllFields()}};s([a()],g.prototype,"_createOperationGeometry",void 0),s([a()],g.prototype,"_defaultElevation",null),s([a({value:!0})],g.prototype,"centered",null),s([a()],g.prototype,"cursor",null),s([a({nonNullable:!0})],g.prototype,"defaultZ",void 0),s([a()],g.prototype,"drawOperation",void 0),s([a({value:!0})],g.prototype,"enabled",null),s([a({value:!0})],g.prototype,"forceUniformSize",null),s([a({constructOnly:!0})],g.prototype,"geometryType",void 0),s([a()],g.prototype,"graphic",null),s([a({constructOnly:!0})],g.prototype,"graphicProperties",void 0),s([a()],g.prototype,"graphicSymbol",null),s([a({constructOnly:!0})],g.prototype,"hasZ",void 0),s([a({constructOnly:!0,type:rt})],g.prototype,"labelOptions",void 0),s([a({constructOnly:!0})],g.prototype,"geometryToPlace",void 0),s([a({constructOnly:!0})],g.prototype,"mode",void 0),s([a()],g.prototype,"snappingManager",void 0),s([a()],g.prototype,"snapToScene",void 0),s([a()],g.prototype,"tooltip",void 0),s([a()],g.prototype,"tooltipInfos",void 0),s([a({constructOnly:!0,type:st})],g.prototype,"tooltipOptions",void 0),s([a({readOnly:!0})],g.prototype,"type",void 0),s([a({readOnly:!0})],g.prototype,"updating",null),s([a({constructOnly:!0,nonNullable:!0})],g.prototype,"view",void 0),s([a()],g.prototype,"_tooltipInfo",null),s([a()],g.prototype,"_circleRadius",null),s([a()],g.prototype,"_xSize",null),s([a()],g.prototype,"_ySize",null),s([a()],g.prototype,"_fullGeometryArea",null),s([a()],g.prototype,"_vertexTooltipElevation",null),s([a()],g.prototype,"_elevationMode",null),g=s([b("esri.views.draw.DrawGraphicTool")],g);const dt="create-operation-graphic",S={outline:"outline-visual",regularVertices:"regular-vertices-visual",activeVertex:"active-vertex-visual"};function wn(e){switch(e){case"point":case"polyline":case"polygon":case"multipoint":return e;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const qt=48,ae="click";class qi{constructor({grabbableForEvent:t}){this.events=new _t,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.consumesClicks=!0,this.grabbableForEvent=t}destroy(){}intersectionDistance(t,i){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}}const ji="crosshair",Qi="progress";let y=class extends _t.EventedMixin(Xt){constructor(t){super(t),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new Set,this._stagedScreenPoint=null,this._stagedPointerType=null,this._stagedPointerId=null,this._updatingHandles=new Qe,this.constraint=void 0,this.isDraped=!0,this.labelOptions=new rt,this.tooltipOptions=new st,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.lastVertex=null,t.elevationInfo==null&&(this.elevationInfo=Be(!!t.hasZ))}initialize(){const{geometryType:t,view:i}=this,n=i.spatialReference,o="viewingMode"in i.state?i.state.viewingMode:Ye.Local,r=t==="segment"||t==="multipoint"?"polyline":t;this.coordinateHelper=mi(this.hasZ,this.hasM,n),this._editGeometryOperations=new fi(new _i(r,this.coordinateHelper)),this._snappingOperation=new bi({view:i,constrainResult:p=>p?this._getEffectiveDrawSurface()?.constrainZ(p):void 0}),this.addHandles([W(()=>this.stagedVertex,p=>{p!=null&&this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(p)}],operation:"apply",type:"vertex-update"})},{sync:!0,equals:(p,c)=>ti(p,c,Ut)}),W(()=>this.view.viewpoint,(p,c)=>{p&&c&&ei(p,c)&&this._onViewpointChange()})]),this._activeComponent=new xi(n,o),this._editGeometryOperations.data.components.push(this._activeComponent);const l=this.segmentLabels;l!=null&&(l.context={view:i,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.addHandles([W(()=>this.labelOptions.enabled,p=>{l.visible=p},tt),this.on("cursor-update",()=>{const p=this.stagedVertex;l.stagedVertex=p!=null?this.coordinateHelper.pointToVector(p):null})])),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],p=>{const c=p.vertices.map(x=>({componentIndex:0,vertexIndex:x.index,coordinates:this.coordinateHelper.vectorToArray(x.pos)})),d=c.map(x=>x.coordinates);switch(p.type){case"vertex-add":this.emit(p.type,{...p,added:d,vertices:c});break;case"vertex-update":this.emit(p.type,{...p,updated:d,vertices:c});break;case"vertex-remove":this.emit(p.type,{...p,removed:d,vertices:c})}const v=this._activeComponent.getLastVertex(),u=v!=null?this.coordinateHelper.vectorToDehydratedPoint(v.pos):null;u!=null&&this.lastVertex!=null&&Ut(this.lastVertex,u)||(this.lastVertex=u)}));const h=this._manipulator=new qi({grabbableForEvent:p=>this.drawingMode!=="click"||p.pointerType==="touch"&&this._snappingEnabled&&this._pointerDownStates.size===1});this.manipulators.add(h),h.grabbable=t!=="point",this.addHandles([this._createManipulatorDragPipeline(h),h.events.on("immediate-click",p=>this._onImmediateClick(p)),h.events.on("immediate-double-click",p=>this._onImmediateDoubleClick(p)),W(()=>({effectiveCursor:this.effectiveCursor}),({effectiveCursor:p})=>{h.cursor=p},tt)]),Je(this,()=>{const p=this.view.inputManager.latestPointerType??"mouse",c=this._getSnappingContext(p);this.snappingManager!=null&&this._updatingHandles.addPromise(Rt(this._snappingOperation.resnap(this.snappingManager,c)))})}destroy(){R(this.segmentLabels),R(this._snappingOperation),this._editGeometryOperations=R(this._editGeometryOperations),this._updatingHandles.destroy()}get _snappingEnabled(){return this.snappingManager!=null&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const t=this._getEffectiveDrawSurface();return this.view.type==="3d"&&this.drawSurface!==t}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map(t=>this.coordinateHelper.vectorToArray(t.pos))}set drawingMode(t){this._set("drawingMode",t??ae)}get effectiveCursor(){return this.loading?Qi:this._hideDefaultCursor?null:this.cursor||ji}get interactive(){return this._manipulator.interactive}set interactive(t){this._manipulator.interactive=t}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get numVertices(){return this.stagedVertex!=null?this._activeComponent.vertices.length+1:this._activeComponent.vertices.length}get snappingOptions(){return this.snappingManager!=null?this.snappingManager.options:null}get stagedVertex(){const t=this._snappingOperation.stagedPoint,{constraint:i,elevationInfo:n,view:o}=this;if(!t||!i)return t;const r=K(t,o,n),l=r?i.closestTo(r):void 0;return l?Xe(l,t.spatialReference):t}set stagedVertex(t){this._snappingOperation.stagedPoint=Yt(t)}get updating(){return this._updatingHandles.updating}get vertices(){const t=this.committedVertices;return this.stagedVertex!=null&&t.push(this.coordinateHelper.pointToArray(this.stagedVertex)),t}cancel(){this.complete({aborted:!0})}commitStagedVertex(){if(this._snappingOperation.abort(),this.stagedVertex!=null){const{stagedVertex:t}=this;this.stagedVertex=null,this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(t))}}complete(t){const i=t&&t.aborted||!1;this._snappingOperation.abort(),this.snappingManager!=null&&this.snappingManager.doneSnapping(),this.geometryType==="segment"||this.geometryType==="point"?this.commitStagedVertex():this.stagedVertex=null;const n=this.geometryType==="multipoint"&&this.numVertices===0||this.geometryType==="polyline"&&this.numVertices<2||this.geometryType==="polygon"&&this.numVertices<3;this._createOperationCompleted=!n,(this.isCompleted||i)&&this.emit("complete",{vertices:this.vertices.map((o,r)=>({componentIndex:0,vertexIndex:r,coordinates:o})),aborted:i,type:"complete"})}onInputEvent(t){switch(t.type){case"pointer-down":this._pointerDownStates.add(t.pointerId);break;case"pointer-up":this._pointerDownStates.delete(t.pointerId)}switch(t.type){case"pointer-move":return this._onPointerMove(t);case"hold":return this._onHold(t)}}redo(){this._editGeometryOperations.redo()}undo(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_closeOnClickVertexIndex(t){const i=this._activeComponent;if(this.geometryType==="polygon"&&i.vertices.length>2){if(this._vertexWithinPointerDistance(i.vertices[0].pos,t))return 0;if(this._vertexWithinPointerDistance(i.vertices[i.vertices.length-1].pos,t))return i.vertices.length-1}return null}_createManipulatorDragPipeline(t){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(t);case"freehand":return this._createManipulatorDragPipelineFreehand(t);case"hybrid":return this._createManipulatorDragPipelineHybrid(t)}}_createManipulatorDragPipelineClick(t){return ct(t,(i,n,o,r)=>{const l=r==="touch"&&this._snappingEnabled;if(this.isCompleted||!l)return;const{snappingStep:h,cancelSnapping:p}=Mi({predicate:()=>l,snappingManager:this.snappingManager,snappingContext:new Zt({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:r,visualizer:this.snappingVisualizer}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});o=o.next(c=>(l&&this.snappingManager!=null&&this.snappingManager.doneSnapping(),c)).next(p),n.next(this._screenToMapDragEventStep()).next(c=>(c.action==="start"&&(this.stagedVertex=c.mapStart,(this.geometryType==="segment"||l&&this.numVertices===0)&&this.commitStagedVertex()),c)).next(di(this.view,this.elevationInfo)).next(...h).next(c=>(l&&(this.stagedVertex=c.mapEnd,c.action==="end"&&this.commitStagedVertex()),c)).next(c=>(c.action==="end"&&(this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()),c))})}_createManipulatorDragPipelineFreehand(t){return ct(t,(i,n)=>{this.isCompleted||n.next(this._screenToMapDragEventStep()).next(o=>(o.action==="start"&&(this.stagedVertex==null&&(this.stagedVertex=o.mapStart),this.geometryType==="segment"&&this.commitStagedVertex()),o)).next(o=>{switch(o.action){case"start":case"update":this.stagedVertex=o.mapEnd,this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this.complete()}return o})})}_createManipulatorDragPipelineHybrid(t){return ct(t,(i,n)=>{this.isCompleted||n.next(this._screenToMapDragEventStep()).next(o=>(o.action==="start"&&(this.stagedVertex==null&&(this.stagedVertex=o.mapStart),this.commitStagedVertex()),o)).next(o=>{switch(o.action){case"start":case"update":this.stagedVertex=o.mapEnd,this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()}return o})})}get _drawAtFixedElevation(){return(this.geometryType==="segment"||this.geometryType==="polygon")&&this.numCommittedVertices>0}_getEffectiveDrawSurface(){if(this.elevationDrawSurface==null)return this.drawSurface;if(!this.coordinateHelper.hasZ())return this.elevationDrawSurface.defaultZ=null,this.elevationDrawSurface;let t=this.defaultZ,i=!1;return this.elevationInfo!=null&&this.elevationInfo.mode==="absolute-height"&&(i=!0),this.snapToSceneEnabled!=null&&(i=this.snapToSceneEnabled),this.elevationInfo!=null&&this.elevationInfo.mode==="on-the-ground"&&(i=!1),this._drawAtFixedElevation&&(t=this.coordinateHelper.getZ(this._activeComponent.vertices[0].pos),i=!1),i?this.drawSurface:(this.elevationDrawSurface.defaultZ=t,this.elevationDrawSurface)}_mapToScreen(t){return this._getEffectiveDrawSurface()?.mapToScreen(t)}_onHold(t){this._snappingOperation.abort(),this.drawingMode==="click"&&t.pointerType==="touch"&&this._snappingEnabled&&(this.stagedVertex=t.mapPoint),t.stopPropagation()}_onImmediateClick(t){if(t.pointerType==="mouse"&&t.button===2||this._manipulator.dragging)return;const i=this._activeComponent;if(this._closeOnClickVertexIndex(t.screenPoint)!=null)return t.stopPropagation(),void this.complete();const n=this._screenToMap(t.screenPoint);if(n!=null)switch(this.drawingMode){case"freehand":this.geometryType==="point"&&(this.stagedVertex!=null?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(n)),this.complete());break;case"click":case"hybrid":this._snappingOperation.abort(),this.stagedVertex!=null?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(n)),(this.geometryType==="point"||this.geometryType==="segment"&&i.vertices.length===2||this.geometryType==="segment"&&this.drawingMode==="hybrid"&&i.vertices.length===1)&&this.complete()}t.stopPropagation()}_onImmediateDoubleClick(t){this._manipulator.dragging||this.geometryType==="point"||(this.complete(),t.stopPropagation())}_onPointerMove(t){const i=Ke(t.x,t.y);this._stagedScreenPoint=i,this._stagedPointerType=t.pointerType,this._stagedPointerId=t.pointerId;const n=this._snappingOperation,o=this._manipulator;this._pointerDownStates.has(t.pointerId)||o.grabbing||!o.interactive?n.abort():(t.stopPropagation(),this._updateStagedVertexOnPointerMove(i,t.pointerType))}_onViewpointChange(){const t=this._manipulator;this._stagedPointerType==="mouse"&&this._stagedScreenPoint&&this._stagedPointerId!=null&&!this._pointerDownStates.has(this._stagedPointerId)&&!t.grabbing&&t.interactive?this._updateStagedVertexOnPointerMove(this._stagedScreenPoint,this._stagedPointerType??"mouse"):this._snappingOperation.abort()}_updateStagedVertexOnPointerMove(t,i){const n=this._snappingOperation,o=this._closeOnClickVertexIndex(t);if(o!=null)return this._closeOnVertex(o),void n.abort();const r=this._screenToMap(t),l=this._requiresScenePoint?this.drawSurface?.screenToMap(t):null;if(r==null)return this._hideDefaultCursor=!0,void n.abort();this._hideDefaultCursor=!1;const h=this.snappingManager;if(h==null)return this.stagedVertex=r,void n.abort();const p=this._getSnappingContext(i);this._updatingHandles.addPromise(Rt(n.snap({point:r,scenePoint:l},h,p)))}_closeOnVertex(t){this.stagedVertex=null;const i={componentIndex:0,vertexIndex:t,coordinates:this.coordinateHelper.vectorToArray(this._activeComponent.vertices[t].pos)};this.emit("cursor-update",{updated:null,vertices:[i],operation:"apply",type:"vertex-update"})}_screenToMap(t){return this._getEffectiveDrawSurface()?.screenToMap(t)}_screenToMapDragEventStep(){let t=null;return i=>{if(i.action==="start"&&(t=this._screenToMap(i.screenStart)),t==null)return null;const n=this._screenToMap(i.screenEnd);return n!=null?{...i,mapStart:t,mapEnd:n}:null}}_vertexWithinPointerDistance(t,i){const o=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(t));return o!=null&&Bi(o,i,25)}_getSnappingContext(t){const i=this._drawAtFixedElevation?this.elevationDrawSurface?.defaultZ:null;return new Zt({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:t,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:i!=null?{value:i,elevationInfo:this.elevationInfo}:null})}};function Bi(e,t,i){const n=e.x-t.x,o=e.y-t.y;return n*n+o*o<=i}s([a()],y.prototype,"_hideDefaultCursor",void 0),s([a()],y.prototype,"_snappingOperation",void 0),s([a()],y.prototype,"_snappingEnabled",null),s([a({constructOnly:!0})],y.prototype,"graphic",void 0),s([a()],y.prototype,"constraint",void 0),s([a()],y.prototype,"defaultZ",void 0),s([a()],y.prototype,"isDraped",void 0),s([a({value:ae})],y.prototype,"drawingMode",null),s([a({constructOnly:!0})],y.prototype,"elevationDrawSurface",void 0),s([a({constructOnly:!0})],y.prototype,"elevationInfo",void 0),s([a({constructOnly:!0,type:rt})],y.prototype,"labelOptions",void 0),s([a({constructOnly:!0,type:st})],y.prototype,"tooltipOptions",void 0),s([a({constructOnly:!0})],y.prototype,"geometryType",void 0),s([a({constructOnly:!0})],y.prototype,"hasM",void 0),s([a({constructOnly:!0})],y.prototype,"hasZ",void 0),s([a()],y.prototype,"cursor",void 0),s([a()],y.prototype,"effectiveCursor",null),s([a()],y.prototype,"loading",void 0),s([a({constructOnly:!0})],y.prototype,"manipulators",void 0),s([a({constructOnly:!0})],y.prototype,"drawSurface",void 0),s([a({constructOnly:!0})],y.prototype,"segmentLabels",void 0),s([a({constructOnly:!0})],y.prototype,"snappingManager",void 0),s([a({constructOnly:!0})],y.prototype,"snappingVisualizer",void 0),s([a()],y.prototype,"snapToSceneEnabled",void 0),s([a()],y.prototype,"stagedVertex",null),s([a()],y.prototype,"lastVertex",void 0),s([a()],y.prototype,"updating",null),s([a({constructOnly:!0})],y.prototype,"view",void 0),y=s([b("esri.views.draw.DrawOperation")],y);class On{constructor(t,i,n,o=null){this._elevationInfo=t,this.defaultZ=i,this._view=n,this._excludeGraphics=o}screenToMap(t){if(this.defaultZ!=null)return this._view.sceneIntersectionHelper.intersectElevationFromScreen(kt(t.x,t.y),this._elevationInfo,this.defaultZ,this._excludeGraphics);const i=this._view.sceneIntersectionHelper.intersectElevationFromScreen(kt(t.x,t.y),this._elevationInfo,0,this._excludeGraphics);return i!=null&&(i.z=void 0),i}mapToScreen(t){const i=Kt(t.x,t.y,xt(this._view,t,this._elevationInfo),t.spatialReference);return this._view.toScreen(i)}constrainZ(t){const{defaultZ:i}=this;return i!=null&&t.z!==i&&((t=te(t)).z=i),t}}class $n{constructor(t,i,n=[]){this.view=t,this.elevationInfo=i,this.exclude=n}screenToMap(t){const i=this.view.toMap(t,{exclude:this.exclude});return i!=null&&(i.z=ii(i,this.view,this.elevationInfo)),i}mapToScreen(t){let i=t;return this.elevationInfo!=null&&(i=Kt(t.x,t.y,xt(this.view,t,this.elevationInfo),t.spatialReference)),this.view.toScreen(i)}constrainZ(t){return t}}class bn{constructor(t,i=!1,n=0){this.view=t,this.hasZ=i,this.defaultZ=n,this.mapToScreen=o=>t.toScreen(o),this.screenToMap=i?o=>{const r=t.toMap(o);return r.z=n,r}:o=>t.toMap(o)}constrainZ(t){const{defaultZ:i}=this;return this.hasZ&&t.z!==i&&((t=te(t)).z=i),t}}function Mn(e,t){return le(e,t,!1)}function Sn(e,t){return le(e,t,!0)}function le(e,t,i){if(e instanceof wi){if(e.operation instanceof Ti)return Yi(e.operation,t,i),!0;if(e.operation instanceof Oi)return Ji(e.operation,t,i),!0;if(e.operation instanceof $i)return Xi(e.operation,t,i),!0}return!1}function Yi(e,t,i=!1){const n=i?-1:1,o=ni(n*e.dx,n*e.dy,n*e.dz);oi(t.origin,t.origin,o),at(t)}function Ji(e,t,i=!1){const n=i?-e.angle:e.angle;Dt(t.basis1,t.basis1,Gt,n),Dt(t.basis2,t.basis2,Gt,n),at(t)}function Xi(e,t,i=!1){const n=i?1/e.factor1:e.factor1,o=i?1/e.factor2:e.factor2;gt(t.basis1,t.basis1,n),gt(t.basis2,t.basis2,o),Et(t.origin,t.origin,e.origin,e.axis1,n),Et(t.origin,t.origin,e.origin,e.axis2,o),at(t)}function In(e,t,i,n){n||(n=ri());const o=F(q.get(),e[1],-e[0]),r=F(q.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),l=F(q.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),h=q.get();t.components.forEach(d=>d.vertices.forEach(v=>{const u=v.pos;F(h,zt(e,u),zt(o,u)),si(r,r,h),ai(l,l,h)}));const p=1e-6,c=F(q.get(),l[0]-r[0]<p?i/2:0,l[1]-r[1]<p?i/2:0);return li(r,r,c),pt(l,l,c),Ht(n.basis1,e,(l[0]-r[0])/2),Ht(n.basis2,o,(l[1]-r[1])/2),F(n.origin,r[0]*e[0]+r[1]*o[0],r[0]*e[1]+r[1]*o[1]),pt(n.origin,n.origin,n.basis1),pt(n.origin,n.origin,n.basis2),at(n),n}export{g as K,Mn as V,wn as X,bn as c,lt as g,y as k,In as l,$n as o,On as r,Sn as x};
