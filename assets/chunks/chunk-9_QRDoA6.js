import{V as P}from"./chunk-mdho3h-Q.js";import{V as U}from"./chunk-jHUwkOTJ.js";import{V as W}from"./chunk-eL7rTImP.js";import{R as A}from"./chunk-KpbMssn-.js";import{V as J}from"./chunk-JsrD4NBF.js";import{s as b,qe as l,qf as j,qg as x,qh as k,qi as F,qj as M,qk as Q,ql as z,qm as H,qn as f,a5 as q,qo as K,qp as X,qq as Y,qr as O,qs as Z,qt as ee,h2 as ae,he as D,hf as te,h5 as re,h6 as ne,h9 as h,hh as se,ha as y,hb as I,h7 as w,D as ie,bq as oe}from"./chunk-gZYsZ36N.js";import"./chunk-xmLgv4Xk.js";import"./chunk-jDrT5IC_.js";import"./chunk-B3AFDltd.js";import"./chunk-u9gmVhyK.js";import"./chunk-5yhB8Y-n.js";import"./chunk-WXBpuwbD.js";import"./chunk-_piOf1Cc.js";import"./chunk-pR8IN3Kg.js";import"./chunk-AKBpUdIm.js";import"./chunk-8dd3L-WV.js";import"./chunk-GWlnAQeV.js";import"./chunk-80lo0Aq7.js";import"./chunk-2bs7e3B8.js";import"./chunk-MEWVNnB1.js";import"./chunk-t4TbIqUg.js";const le=z;async function me(a){if(!a?.layer||!a.view)throw new b("heatmap-statistics:missing-parameters","'layer' and 'view' parameters are required");const e=[l.CSVLayer,l.FeatureLayer,l.GeoJSONLayer,l.OGCFeatureLayer,l.OrientedImageryLayer,l.WFSLayer],{layer:r,...s}=a,n=j(r,e);if(!n)throw new b("heatmap-statistics:invalid-parameters","'layer' must be one of these types: "+x(e).join(", "));const t={layerAdapter:n,...s};t.radius=t.radius==null?t.blurRadius==null?18:k(t.blurRadius):t.radius;const u=t.signal!=null?{signal:t.signal}:null;await n.load(u);const p=t.field,o=p?n.getField(p):null,i=await F({field:p}),m=M(n,i,"heatmap-statistics:invalid-parameters");if(m)throw m;if(o){const c=Q(n,o,"heatmap-statistics:invalid-parameters",le);if(c)throw c}return t}async function ce(a){const{layerAdapter:e,...r}=await me(a);return e.heatmapStatistics(r)}const _=.01;async function ue(a){if(!a?.layer||!a.view)throw new b("heatmap-renderer:missing-parameters","'layer' and 'view' parameters are required");const e={...a,layer:a.layer,view:a.view};e.radius??=e.blurRadius==null?18:k(e.blurRadius),e.minRatio??=.01,e.maxRatio??=1,e.fadeRatio??=.2,e.fadeToTransparent??=!0;const r=[l.CSVLayer,l.FeatureLayer,l.GeoJSONLayer,l.OGCFeatureLayer,l.OrientedImageryLayer,l.StreamLayer,l.WFSLayer],s=j(e.layer,r);if(!s)throw new b("heatmap-renderer:invalid-parameters","'layer' must be one of these types: "+x(r).join(", "));e.layer=s;const n=e.signal!=null?{signal:e.signal}:null;await s.load(n);const t=await F({field:e.field}),u=H(s,t,"heatmap-renderer:invalid-parameters");if(u)throw u;return e}async function pe(a){let e=a.scheme,r=null,s=null;const n=await Z(a.basemap,a.view);if(r=n.basemapId!=null?n.basemapId:null,s=n.basemapTheme!=null?n.basemapTheme:null,e)return{scheme:O(e),basemapId:r,basemapTheme:s};const t=ee({basemapTheme:s});return t&&(e=t.primaryScheme,r=t.basemapId,s=t.basemapTheme),{scheme:e,basemapId:r,basemapTheme:s}}async function de(a,e){const{field:r,basemap:s,radius:n,fadeToTransparent:t,heatmapScheme:u,view:p}=e,{scheme:o,basemapId:i,basemapTheme:m}=await pe({basemap:s,scheme:u,view:p}),c=o.colors,T=c.length,R=a.min==null,L=R?[0,.04]:[a.min,a.max];let V;const C=e.fadeRatio??0,$=e.maxRatio??0,g=e.minRatio??0,E=($-g)/(T-1),d=c[0],S=t?g:_,v=[new f({ratio:0,color:new q([d.r,d.g,d.b,0])}),new f({ratio:_,color:new q([d.r,d.g,d.b,0])}),new f({ratio:S,color:new q([d.r,d.g,d.b,S])})];return K(c,T).forEach((B,N)=>{const G=g+E*N;v.push(new f({ratio:G,color:B}))}),t&&(he(v,C),V=new X({fadeRatio:C})),{renderer:new Y({authoringInfo:V,radius:n,colorStops:v,field:r,minDensity:L[0],maxDensity:L[1]}),statistics:a,defaultValuesUsed:R,scheme:O(o),basemapId:i,basemapTheme:m}}function he(a,e){const r=10*(1-e)+1,s=a.length-3,n=a[2].color.a;a.forEach((t,u)=>{if(u<=2)return;const{color:p}=t,o=(u-3)/s;p.a=e===0?1:Math.min(Math.max(o*r+o+n,n),1)})}async function ye(a){const e=await ue(a);return de(e.statistics??await ce({layer:e.layer,field:e.field,radius:e.radius,view:e.view,signal:e.signal}),e)}const fe=new A({baseURL:"/data"}),we=()=>fe.request({method:"GET",url:"/point1.json"}).then(a=>a[0]),Ne=ae({__name:"index",setup(a){const e=D(),r=D([]),s=()=>{we().then(o=>{r.value=o.centerPoints.map((i,m)=>new ie({geometry:new oe({longitude:i.centerPoint[0],latitude:i.centerPoint[1]}),attributes:{probabilityDensity:i.probabilityDensity,ranking:i.ranking,ObjectID:m}}))})};s();const n=o=>{const{result:i}=o;i&&console.log(i)},t=async o=>{const i=o.layer,m=o.view;await i.when(),m.goTo(r.value);const c=await ye({layer:i,view:m,field:"probabilityDensity"});console.log(c),e.value=c.renderer},u=()=>{s()},p=()=>{r.value=[]};return(o,i)=>{const m=te("ElButton");return re(),ne(w(U),null,{before:h(()=>[se("p",null,[y(m,{onClick:i[0]||(i[0]=c=>u())},{default:h(()=>[I("getTestData")]),_:1}),y(m,{onClick:p},{default:h(()=>[I("清空")]),_:1})])]),default:h(()=>[y(w(W),{type:"img_w",spatialReference:{wkid:3857}}),y(w(J),null,{default:h(({spatialReference:c})=>[y(w(P),{spatialReference:c,renderer:e.value,source:r.value,fields:[{name:"ObjectID",type:"oid"},{name:"probabilityDensity",type:"double"},{name:"ranking",type:"double"}],"geometry-type":"point","object-id-field":"ObjectID",cursor:"pointer",onClick:n,onChange:t},null,8,["spatialReference","renderer","source"])]),_:1})]),_:1})}}});export{Ne as default};
