import{V as O}from"./chunk-ym-9RfGp.js";import{V as R}from"./chunk-X5Ydg4nF.js";import{u as S}from"./chunk-OMr8FG4E.js";import{gm as z,gs as I,z as $,l4 as A,gq as j,gp as b,l6 as H,gC as q,gv as B,gw as F,gz as E,gA as p,gx as i}from"./chunk-ERvgPDZ8.js";import{c as N}from"./chunk-3E9jM2aR.js";import{c as P}from"./chunk-TReN2ucZ.js";import{V as U}from"./chunk-_vuFmEyb.js";import"./chunk-rnOeZc8c.js";import"./chunk-56s4-S01.js";import"./chunk-i9_hWivA.js";import"./chunk-fL--GQs3.js";import"./chunk-0iOjwU90.js";import"./chunk-yl6pYqlf.js";import"./chunk-1OXEPNEW.js";import"./chunk-KdgvZLtn.js";import"./chunk-cDR98evz.js";import"./chunk-NnOQbRD1.js";function D(){const e=z("vaWmtsLayer");if(!e)throw new Error("The component which use useWmtsLayer() must be in a WmtsLayer component");return e}const X={modelValue:{type:Object,default:()=>({})}},G={click:e=>e},J=I({name:"VaWmtsLayerOnClick",emits:G,props:X,setup(e,{emit:a}){const o=S(),t=D(),r=o[N],u=P(r),n=new u("click",async d=>{const{event:M}=d,l=t.activeLayer;await t.when();const f=M.mapPoint,y=l.id,m=l.tileMatrixSet.tileInfo,L=m.origin,k=o.zoom,s=m.lods.find(W=>W.level===k+1);if(!s)return;const[v,w]=m.size,g=(f.x-L.x)/(s.resolution*v),h=(L.y-f.y)/(s.resolution*w);var _=Math.floor(g),V=Math.floor(h);const x=Math.round((g-_)*v),C=Math.round((h-V)*w);let T;y&&(T=await $(t.url,{query:{SERVICE:"WMTS",LAYER:y,REQUEST:"GetFeatureInfo",VERSION:"1.0.0",INFOFORMAT:"application/json",TILECOL:_,TILEROW:V,TILEMATRIX:s.levelValue,TILEMATRIXSET:l.tileMatrixSet.id,I:x,J:C}}).catch(()=>{})),a("click",{...d,requestResponse:T})});return n.add(),A(()=>{n.remove()}),j(()=>{n.remove()}),b(()=>{n.add()}),{}}});function K(e,a,o,t,r,u){return q(e.$slots,"default")}const c=H(J,[["render",K]]);c.install=e=>{e.component(c.name,c)};const Q="http://192.168.110.10:36800/zzserver/gwc/service/wmts",yt=I({__name:"basic",setup(e){const a=t=>{const r=t.view;console.log("wmtsLayerLoad",t.layer),t.layer.when().then(()=>{t.layer.activeLayer?.fullExtent&&r.goTo(t.layer.activeLayer.fullExtent)})},o=t=>{console.log("layerClick",t)};return(t,r)=>(B(),F(i(O),{defaultOptions:{zoom:2}},{default:E(()=>[p(i(R),{type:"vec_w",anno:!1,"spatial-reference":{wkid:3857}}),p(i(U),{url:Q,title:"testLayer","service-mode":"KVP",onLoad:a},{default:E(()=>[p(i(c),{onClick:o})]),_:1})]),_:1}))}});export{yt as default};
