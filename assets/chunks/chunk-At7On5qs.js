import{hw as w,hx as O,hy as P,hz as q,s as H,a5 as j,hA as E,hB as U,aO as V,hC as z}from"./chunk-gZYsZ36N.js";import{t as C,e as W,d as D,l as I}from"./chunk-04eTVwpd.js";import"./chunk-t4TbIqUg.js";const T="picture-fill",G="picture-marker",J="simple-fill",K="simple-line",N="simple-marker",Q="text",X="Aa",Y=C.size,L=C.maxSize,_=C.maxOutlineSize,F=C.lineWidth,A=225,$=document.createElement("canvas");function R(a,e){const n=$.getContext("2d"),t=[];e&&(e.weight&&t.push(e.weight),e.size&&t.push(e.size+"px"),e.family&&t.push(e.family)),n.font=t.join(" ");const{width:h,actualBoundingBoxLeft:s,actualBoundingBoxRight:p,actualBoundingBoxAscent:c,actualBoundingBoxDescent:r}=n.measureText(a);return{width:Math.ceil(Math.max(h,s+p)),height:Math.ceil(c+r),x:Math.floor(s),y:Math.floor((c-r)/2)}}function x(a){const e=a?.size;return{width:e!=null&&typeof e=="object"&&"width"in e?w(e.width):null,height:e!=null&&typeof e=="object"&&"height"in e?w(e.height):null}}async function ee(a,e){const n=e.fill,t=a.color;if(n?.type==="pattern"&&t&&a.type!==T){const h=await U(n.src,t.toCss(!0));n.src=h,e.fill=n}}async function ae(a,e,n,t){if(!("font"in a)||!a.font||e.shape.type!=="text")return;try{await V(a.font)}catch{}const{width:h,height:s}=x(t);if(!/[\uE600-\uE6FF]/.test(e.shape.text)){const{width:p,height:c,x:r,y:d}=R(e.shape.text,{weight:e.font?.weight,size:e.font?.size,family:e.font?.family});n[0]=h??p,n[1]=s??c,e.shape.x=r,e.shape.y=d;const f=t?.rotation!=null?t.rotation:"angle"in a?a.angle:null;if(f){const l=f*(Math.PI/180),i=Math.abs(Math.sin(l)),b=Math.abs(Math.cos(l));n[1]=n[0]*i+n[1]*b}}}function te(a,e,n,t,h){if(a.haloColor!=null&&a.haloSize!=null){h.masking??=n.map(()=>[]);const s=w(a.haloSize);t[0]+=s,t[1]+=s,n.unshift([{...e,fill:null,stroke:{color:a.haloColor,width:2*s,join:"round",cap:"round"}}]),h.masking.unshift([{shape:{type:"rect",x:0,y:0,width:t[0]+2*z,height:t[1]+2*z},fill:[255,255,255],stroke:null},{...e,fill:[0,0,0,0],stroke:null}])}a.backgroundColor==null&&a.borderLineColor==null||(t[0]+=2*z,t[1]+=2*z,n.unshift([{shape:{type:"rect",x:0,y:0,width:t[0],height:t[1]},fill:a.backgroundColor,stroke:{color:a.borderLineColor,width:w(a.borderLineSize)}}]),h.masking?.unshift([]))}function Z(a,e){return a>e?"dark":"light"}function ne(a,e){const n=typeof e?.size=="number"?e?.size:null,t=n!=null?w(n):null,h=e?.maxSize!=null?w(e.maxSize):null,s=e?.rotation!=null?e.rotation:"angle"in a?a.angle:null,p=O(a);let c=P(a);le(a,245)!=="dark"||e?.ignoreWhiteSymbols||(c={width:.75,...c,color:"#bdc3c7"});const r={shape:null,fill:p,stroke:c,offset:[0,0]};c?.width&&(c.width=Math.min(c.width,_));const d=c?.width||0;let f=e?.size!=null&&(e?.scale==null||e?.scale),l=0,i=0,b=!1;switch(a.type){case N:{const u=a.style,{width:m,height:o}=x(e),v=m===o&&m!=null?m:t??Math.min(w(a.size),h||L);switch(l=v,i=v,u){case"circle":r.shape={type:"circle",cx:0,cy:0,r:.5*v},f||(l+=d,i+=d);break;case"cross":r.shape={type:"path",path:[{command:"M",values:[0,.5*i]},{command:"L",values:[l,.5*i]},{command:"M",values:[.5*l,0]},{command:"L",values:[.5*l,i]}]};break;case"diamond":r.shape={type:"path",path:[{command:"M",values:[0,.5*i]},{command:"L",values:[.5*l,0]},{command:"L",values:[l,.5*i]},{command:"L",values:[.5*l,i]},{command:"Z",values:[]}]},f||(l+=d,i+=d);break;case"square":r.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[l,0]},{command:"L",values:[l,i]},{command:"L",values:[0,i]},{command:"Z",values:[]}]},f||(l+=d,i+=d),s&&(b=!0);break;case"triangle":r.shape={type:"path",path:[{command:"M",values:[.5*l,0]},{command:"L",values:[l,i]},{command:"L",values:[0,i]},{command:"Z",values:[]}]},f||(l+=d,i+=d),s&&(b=!0);break;case"x":r.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[l,i]},{command:"M",values:[l,0]},{command:"L",values:[0,i]}]},s&&(b=!0);break;case"path":r.shape={type:"path",path:a.path||""},f||(l+=d,i+=d),s&&(b=!0),f=!0}break}case K:{const{width:u,height:m}=x(e),o=q(c).reduce((B,M)=>B+M,0),v=o&&Math.ceil(F/o),y=m??t??d,g=u??(o*v||F);c&&(c.width=y),l=g,i=y,f=!0,r.shape={type:"path",path:[{command:"M",values:[y/2,i/2]},{command:"L",values:[l-y/2,i/2]}]};break}case T:case J:{const u=typeof e?.symbolConfig=="object"&&!!e?.symbolConfig?.isSquareFill,{width:m,height:o}=x(e);l=!u&&m!==o||m==null?t??Y:m,i=!u&&m!==o||o==null?l:o,f||(l+=d,i+=d),f=!0,r.shape=u?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[l,0]},{command:"L",values:[l,i]},{command:"L",values:[0,i]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:W.fill[0];break}case G:{const u=Math.min(w(a.width),h||L),m=Math.min(w(a.height),h||L),{width:o,height:v}=x(e),y=o===v&&o!=null?o:t??Math.max(u,m),g=u/m;l=g<=1?Math.ceil(y*g):y,i=g<=1?y:Math.ceil(y/g),r.shape={type:"image",x:-Math.round(l/2),y:-Math.round(i/2),width:l,height:i,src:a.url||""},s&&(b=!0);break}case Q:{const u=a,m=e?.overrideText||u.text||X,o=u.font,{width:v,height:y}=x(e),g=y??t??Math.min(w(o.size),h||L),{width:B,height:M}=R(m,{weight:o.weight,size:g,family:o.family}),k=/[\uE600-\uE6FF]/.test(m);l=v??(k?g:B),i=k?g:M;let S=.5*(k?g:M);k&&(S+=5),r.shape={type:"text",text:m,x:u.xoffset||0,y:u.yoffset||S,align:"middle",alignBaseline:u.verticalAlignment,decoration:o&&o.decoration,rotated:u.rotated,kerning:u.kerning},r.font=o&&{size:g,style:o.style,decoration:o.decoration,weight:o.weight,family:o.family};break}}return{shapeDescriptor:r,size:[l,i],renderOptions:{node:e?.node,scale:f,opacity:e?.opacity,rotation:s,useRotationSize:b,effectView:e?.effectView,ariaLabel:e?.ariaLabel}}}async function he(a,e){const{shapeDescriptor:n,size:t,renderOptions:h}=ne(a,e);if(!n.shape)throw new H("symbolPreview: renderPreviewHTML2D","symbol not supported.");await ee(a,n),await ae(a,n,t,e);const s=[[n]];if(typeof e?.symbolConfig=="object"&&e?.symbolConfig?.applyColorModulation){const p=.6*t[0];s.unshift([{...n,offset:[-p,0],fill:D(n.fill,-.3)}]),s.push([{...n,offset:[p,0],fill:D(n.fill,.3)}]),t[0]+=2*p,h.scale=!1}return a.type==="text"&&te(a,n,s,t,h),I(s,t,h)}function le(a,e=A){const n=O(a),t=P(a),h=!n||"type"in n?null:new j(n),s=t?.color?new j(t?.color):null,p=h?Z(E(h),e):null,c=s?Z(E(s),e):null;return c?p?p===c?p:e>=A?"light":"dark":c:p}export{le as getContrastingBackgroundTheme,ne as getRenderSymbolParameters,he as previewSymbol2D};
