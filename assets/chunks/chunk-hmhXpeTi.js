import{$ as r,a0 as i,d4 as P,a2 as j,e0 as x,e3 as V,s as E,dg as F,P as L}from"./chunk-ERvgPDZ8.js";const _=T=>{let e=class extends T{constructor(){super(...arguments),this._rasterFieldPrefix="Raster.",this.layer=null,this.view=null,this.tileInfo=null}get fullExtent(){return this._getfullExtent()}_getfullExtent(){return x(this.layer.rasterInfo,this.view.spatialReference)}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){return V(this.layer.fullExtent,this.view.spatialReference,!0)}supportsSpatialReference(l){return!!x(this.layer.rasterInfo,l)}async fetchPopupFeatures(l,b){const{layer:t}=this;if(!l)throw new E("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:t});const{popupEnabled:d}=t,y=F(t,b);if(!d||y==null)throw new E("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:d,popupTemplate:y});const c=[],{value:s,magdirValue:h,processedValue:R}=await t.identify(l,{timeExtent:this.timeExtent});let o="";if(s&&s.length){o=t.type==="imagery-tile"&&t.hasStandardTime()&&s[0]!=null?s.map(f=>t.getStandardTimeValue(f)).join(", "):s.join(", ");const n={ObjectId:0},m="Raster.ServicePixelValue";n[m]=R?.join(", ")??o,n[m+".Raw"]=o;const g=t.rasterInfo.attributeTable;if(g!=null){const{fields:f,features:I}=g,v=f.find(({name:a})=>a.toLowerCase()==="value"),p=v?I.find(a=>String(a.attributes[v.name])===o):null;if(p)for(const a in p.attributes)p.attributes.hasOwnProperty(a)&&(n[this._rasterFieldPrefix+a]=p.attributes[a])}const w=t.rasterInfo.dataType;w!=="vector-magdir"&&w!=="vector-uv"||(n["Raster.Magnitude"]=h?.[0],n["Raster.Direction"]=h?.[1]);const u=new L(this.fullExtent.clone(),null,n);u.layer=t,u.sourceLayer=u.layer,c.push(u)}return c}};return r([i()],e.prototype,"layer",void 0),r([i(P)],e.prototype,"timeExtent",void 0),r([i()],e.prototype,"view",void 0),r([i()],e.prototype,"fullExtent",null),r([i()],e.prototype,"tileInfo",void 0),r([i({readOnly:!0})],e.prototype,"hasTilingEffects",null),r([i()],e.prototype,"datumTransformation",null),e=r([j("esri.views.layers.ImageryTileLayerView")],e),e};export{_ as p};
