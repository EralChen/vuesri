import{V as U}from"./chunk-Oy0olT0V.js";import{V as W}from"./chunk-_2aKFkeE.js";import{V as z}from"./chunk-X5Ydg4nF.js";import{R as J}from"./chunk-KpbMssn-.js";import{V as M}from"./chunk-E_sfZOyp.js";import{s as b,qm as m,qn as O,qo as j,qp as k,qq as $,qr as H,qs as Q,qt as K,qu as X,qv as w,a5 as T,qw as Y,qx as Z,qy as ee,qz as B,qA as ae,qB as te,gs as re,gE as F,gF as se,gv as ne,gw as ie,gz as f,gH as oe,gA as y,gB as _,gx as h,P as le,bv as ce}from"./chunk-ERvgPDZ8.js";import"./chunk-QJB8kuK7.js";import"./chunk-yl6pYqlf.js";import"./chunk-3E9jM2aR.js";import"./chunk-OMr8FG4E.js";import"./chunk-SpuRo9zE.js";import"./chunk-KdgvZLtn.js";import"./chunk-TReN2ucZ.js";import"./chunk-rnOeZc8c.js";import"./chunk-56s4-S01.js";import"./chunk-i9_hWivA.js";import"./chunk-fL--GQs3.js";import"./chunk-0iOjwU90.js";import"./chunk-1OXEPNEW.js";import"./chunk-cDR98evz.js";const me=K;async function ue(a){if(!a?.layer||!a.view)throw new b("heatmap-statistics:missing-parameters","'layer' and 'view' parameters are required");const e=[m.CSVLayer,m.FeatureLayer,m.OGCFeatureLayer,m.GeoJSONLayer,m.WFSLayer],{layer:r,...n}=a,s=O(r,e);if(!s)throw new b("heatmap-statistics:invalid-parameters","'layer' must be one of these types: "+j(e).join(", "));const t={layerAdapter:s,...n};t.radius=t.radius==null?t.blurRadius==null?18:k(t.blurRadius):t.radius;const l=t.signal!=null?{signal:t.signal}:null;await s.load(l);const p=t.field,o=p?s.getField(p):null,i=await $({field:p}),c=H(s,i,"heatmap-statistics:invalid-parameters");if(c)throw c;if(o){const u=Q(s,o,"heatmap-statistics:invalid-parameters",me);if(u)throw u}return t}async function pe(a){const{layerAdapter:e,...r}=await ue(a);return e.heatmapStatistics(r)}const I=.01;async function de(a){if(!a?.layer||!a.view)throw new b("heatmap-renderer:missing-parameters","'layer' and 'view' parameters are required");const e={...a,layer:a.layer,view:a.view};e.radius??=e.blurRadius==null?18:k(e.blurRadius),e.minRatio??=.01,e.maxRatio??=1,e.fadeRatio??=.2,e.fadeToTransparent??=!0;const r=[m.CSVLayer,m.FeatureLayer,m.OGCFeatureLayer,m.GeoJSONLayer,m.StreamLayer,m.WFSLayer],n=O(e.layer,r);if(!n)throw new b("heatmap-renderer:invalid-parameters","'layer' must be one of these types: "+j(r).join(", "));e.layer=n;const s=e.signal!=null?{signal:e.signal}:null;await n.load(s);const t=await $({field:e.field}),l=X(n,t,"heatmap-renderer:invalid-parameters");if(l)throw l;return e}async function fe(a){let e=a.scheme,r=null,n=null;const s=await ae(a.basemap,a.view);if(r=s.basemapId!=null?s.basemapId:null,n=s.basemapTheme!=null?s.basemapTheme:null,e)return{scheme:B(e),basemapId:r,basemapTheme:n};const t=te({basemapTheme:n});return t&&(e=t.primaryScheme,r=t.basemapId,n=t.basemapTheme),{scheme:e,basemapId:r,basemapTheme:n}}async function ye(a,e){const{fieldOffset:r}=a,{field:n,basemap:s,radius:t,fadeToTransparent:l,heatmapScheme:p,view:o}=e,{scheme:i,basemapId:c,basemapTheme:u}=await fe({basemap:s,scheme:p,view:o}),g=i.colors,R=g.length,V=!a.count,C=V?[0,.04]:[a.min,a.max];let x;const L=e.fadeRatio??0,E=e.maxRatio??0,v=e.minRatio??0,N=(E-v)/(R-1),d=g[0],S=l?v:I,q=[new w({ratio:0,color:new T([d.r,d.g,d.b,0])}),new w({ratio:I,color:new T([d.r,d.g,d.b,0])}),new w({ratio:S,color:new T([d.r,d.g,d.b,S])})];Y(g,R).forEach((G,P)=>{const A=v+N*P;q.push(new w({ratio:A,color:G}))}),l&&(we(q,L),x=new Z({fadeRatio:L}));const D=new ee({authoringInfo:x,radius:t,colorStops:q,field:n,minDensity:C[0],maxDensity:C[1]});return r!=null&&(D.fieldOffset=r),{renderer:D,statistics:a,defaultValuesUsed:V,scheme:B(i),basemapId:c,basemapTheme:u}}function we(a,e){const r=10*(1-e)+1,n=a.length-3,s=a[2].color.a;a.forEach((t,l)=>{if(l<=2)return;const{color:p}=t,o=(l-3)/n;p.a=e===0?1:Math.min(Math.max(o*r+o+s,s),1)})}async function he(a){const e=await de(a);return ye(e.statistics??await pe({layer:e.layer,field:e.field,fieldOffset:e.fieldOffset,radius:e.radius,view:e.view,signal:e.signal}),e)}const be=new J({baseURL:"/data"}),ge=()=>be.request({method:"GET",url:"/point1.json"}).then(a=>a[0]),Ge=re({__name:"index",setup(a){const e=F(),r=F([]),n=()=>{ge().then(o=>{r.value=o.centerPoints.map((i,c)=>new le({geometry:new ce({longitude:i.centerPoint[0],latitude:i.centerPoint[1]}),attributes:{probabilityDensity:i.probabilityDensity,ranking:i.ranking,ObjectID:c}}))})};n();const s=o=>{const{result:i}=o;i&&console.log(i)},t=async o=>{const i=o.layer,c=o.view;await i.when(),c.goTo(r.value);const u=await he({layer:i,view:c,field:"probabilityDensity"});console.log(u),e.value=u.renderer},l=()=>{n()},p=()=>{r.value=[]};return(o,i)=>{const c=se("ElButton");return ne(),ie(h(W),null,{before:f(()=>[oe("p",null,[y(c,{onClick:i[0]||(i[0]=u=>l())},{default:f(()=>[_("getTestData")]),_:1}),y(c,{onClick:p},{default:f(()=>[_("清空")]),_:1})])]),default:f(()=>[y(h(z),{type:"img_w",spatialReference:{wkid:3857}}),y(h(M),null,{default:f(({spatialReference:u})=>[y(h(U),{spatialReference:u,renderer:e.value,source:r.value,fields:[{name:"ObjectID",type:"oid"},{name:"probabilityDensity",type:"double"},{name:"ranking",type:"double"}],"geometry-type":"point","object-id-field":"ObjectID",cursor:"pointer",onClick:s,onChange:t},null,8,["spatialReference","renderer","source"])]),_:1})]),_:1})}}});export{Ge as default};
