import{gh as w,h0 as T,h1 as Z,s as A,a5 as S,h2 as F,h3 as B,aK as H,h4 as x,ev as R}from"./chunk-ERvgPDZ8.js";import{t as L,e as V,d as j,l as W}from"./chunk-KXRkN20g.js";import"./chunk-cDR98evz.js";const q="picture-fill",K="picture-marker",U="simple-fill",G="simple-line",I="simple-marker",J="text",N="Aa",Q=L.size,z=L.maxSize,X=L.maxOutlineSize,Y=L.lineWidth,E=225,_=document.createElement("canvas");function O(a,e){const l=_.getContext("2d"),t=[];return e&&(e.weight&&t.push(e.weight),e.size&&t.push(e.size+"px"),e.family&&t.push(e.family)),l.font=t.join(" "),l.measureText(a).width}const $=7.2/2.54,ee=72/2.54;function ae(a){if(a.length===0)return 0;if(a.length>2){const e=R(1),l=parseFloat(a);switch(a.slice(-2)){case"px":return l;case"pt":return l*e;case"in":return 72*l*e;case"pc":return 12*l*e;case"mm":return l*$*e;case"cm":return l*ee*e}}return parseFloat(a)}function k(a){const e=a?.size;return{width:e!=null&&typeof e=="object"&&"width"in e?w(e.width):null,height:e!=null&&typeof e=="object"&&"height"in e?w(e.height):null}}async function te(a,e){const l=e.fill,t=a.color;if(l?.type==="pattern"&&t&&a.type!==q){const r=await B(l.src,t.toCss(!0));l.src=r,e.fill=l}}async function le(a,e,l,t){if(!("font"in a)||!a.font||e.shape.type!=="text")return;try{await H(a.font)}catch{}const{width:r}=k(t),o=/[\uE600-\uE6FF]/.test(e.shape.text);r!=null||o||(l[0]=O(e.shape.text,{weight:e.font?.weight,size:e.font?.size,family:e.font?.family}))}function ne(a,e,l,t,r){if(a.haloColor!=null&&a.haloSize!=null){r.masking??=l.map(()=>[]);const o=w(a.haloSize);t[0]+=o,t[1]+=o,l.unshift([{...e,fill:null,stroke:{color:a.haloColor,width:2*o,join:"round",cap:"round"}}]),r.masking.unshift([{shape:{type:"rect",x:0,y:0,width:t[0]+2*x,height:t[1]+2*x},fill:[255,255,255],stroke:null},{...e,fill:[0,0,0,0],stroke:null}])}a.backgroundColor==null&&a.borderLineColor==null||(t[0]+=2*x,t[1]+=2*x,l.unshift([{shape:{type:"rect",x:0,y:0,width:t[0],height:t[1]},fill:a.backgroundColor,stroke:{color:a.borderLineColor,width:w(a.borderLineSize)}}]),r.masking?.unshift([]))}function D(a,e){return a>e?"dark":"light"}function ie(a,e){const l=typeof e?.size=="number"?e?.size:null,t=l!=null?w(l):null,r=e?.maxSize!=null?w(e.maxSize):null,o=e?.rotation!=null?e.rotation:"angle"in a?a.angle:null,y=T(a);let m=Z(a);se(a,245)!=="dark"||e?.ignoreWhiteSymbols||(m={width:.75,...m,color:"#bdc3c7"});const u={shape:null,fill:y,stroke:m,offset:[0,0]};m?.width&&(m.width=Math.min(m.width,X));const p=m?.width||0;let g=e?.size!=null&&(e?.scale==null||e?.scale),n=0,i=0,b=!1;switch(a.type){case I:{const c=a.style,{width:h,height:s}=k(e),v=h===s&&h!=null?h:t??Math.min(w(a.size),r||z);switch(n=v,i=v,c){case"circle":u.shape={type:"circle",cx:0,cy:0,r:.5*v},g||(n+=p,i+=p);break;case"cross":u.shape={type:"path",path:[{command:"M",values:[0,.5*i]},{command:"L",values:[n,.5*i]},{command:"M",values:[.5*n,0]},{command:"L",values:[.5*n,i]}]};break;case"diamond":u.shape={type:"path",path:[{command:"M",values:[0,.5*i]},{command:"L",values:[.5*n,0]},{command:"L",values:[n,.5*i]},{command:"L",values:[.5*n,i]},{command:"Z",values:[]}]},g||(n+=p,i+=p);break;case"square":u.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[n,0]},{command:"L",values:[n,i]},{command:"L",values:[0,i]},{command:"Z",values:[]}]},g||(n+=p,i+=p),o&&(b=!0);break;case"triangle":u.shape={type:"path",path:[{command:"M",values:[.5*n,0]},{command:"L",values:[n,i]},{command:"L",values:[0,i]},{command:"Z",values:[]}]},g||(n+=p,i+=p),o&&(b=!0);break;case"x":u.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[n,i]},{command:"M",values:[n,0]},{command:"L",values:[0,i]}]},o&&(b=!0);break;case"path":u.shape={type:"path",path:a.path||""},g||(n+=p,i+=p),o&&(b=!0),g=!0}break}case G:{const{width:c,height:h}=k(e),s=h??t??p,v=c??Y;m&&(m.width=s),n=v,i=s;const f=u?.stroke?.cap||"butt",d=f==="round";g=!0,u.stroke&&(u.stroke.cap=f==="butt"?"square":f),u.shape={type:"path",path:[{command:"M",values:[d?s/2:0,i/2]},{command:"L",values:[d?n-s/2:n,i/2]}]};break}case q:case U:{const c=typeof e?.symbolConfig=="object"&&!!e?.symbolConfig?.isSquareFill,{width:h,height:s}=k(e);n=!c&&h!==s||h==null?t??Q:h,i=!c&&h!==s||s==null?n:s,g||(n+=p,i+=p),g=!0,u.shape=c?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[n,0]},{command:"L",values:[n,i]},{command:"L",values:[0,i]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:V.fill[0];break}case K:{const c=Math.min(w(a.width),r||z),h=Math.min(w(a.height),r||z),{width:s,height:v}=k(e),f=s===v&&s!=null?s:t??Math.max(c,h),d=c/h;n=d<=1?Math.ceil(f*d):f,i=d<=1?f:Math.ceil(f/d),u.shape={type:"image",x:-Math.round(n/2),y:-Math.round(i/2),width:n,height:i,src:a.url||""},o&&(b=!0);break}case J:{const c=a,h=e?.overrideText||c.text||N,s=c.font,{width:v,height:f}=k(e),d=f??t??Math.min(w(s.size),r||z),P=O(h,{weight:s.weight,size:d,family:s.family}),M=/[\uE600-\uE6FF]/.test(h);n=v??(M?d:P),i=d;let C=.25*ae((s?d:0).toString());M&&(C+=5),u.shape={type:"text",text:h,x:c.xoffset||0,y:c.yoffset||C,align:"middle",alignBaseline:c.verticalAlignment,decoration:s&&s.decoration,rotated:c.rotated,kerning:c.kerning},u.font=s&&{size:d,style:s.style,decoration:s.decoration,weight:s.weight,family:s.family};break}}return{shapeDescriptor:u,size:[n,i],renderOptions:{node:e?.node,scale:g,opacity:e?.opacity,rotation:o,useRotationSize:b,effectView:e?.effectView,ariaLabel:e?.ariaLabel}}}async function he(a,e){const{shapeDescriptor:l,size:t,renderOptions:r}=ie(a,e);if(!l.shape)throw new A("symbolPreview: renderPreviewHTML2D","symbol not supported.");await te(a,l),await le(a,l,t,e);const o=[[l]];if(typeof e?.symbolConfig=="object"&&e?.symbolConfig?.applyColorModulation){const y=.6*t[0];o.unshift([{...l,offset:[-y,0],fill:j(l.fill,-.3)}]),o.push([{...l,offset:[y,0],fill:j(l.fill,.3)}]),t[0]+=2*y,r.scale=!1}return a.type==="text"&&ne(a,l,o,t,r),W(o,t,r)}function se(a,e=E){const l=T(a),t=Z(a),r=!l||"type"in l?null:new S(l),o=t?.color?new S(t?.color):null,y=r?D(F(r),e):null,m=o?D(F(o),e):null;return m?y?y===m?y:e>=E?"light":"dark":m:y}export{se as getContrastingBackgroundTheme,ie as getRenderSymbolParameters,he as previewSymbol2D};
