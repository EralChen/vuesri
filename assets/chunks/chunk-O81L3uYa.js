import{rK as Le,w$ as Vi,wX as Ri,az as Xs,CA as fi,CB as mi,CC as yi,y_ as ft,CD as qs,AD as Ks,lY as g,CE as js,CF as Qs,b1 as Ur,a5 as Js,s as Wr,z as je,f9 as nr,i2 as or,fa as ar,i3 as cr,AQ as Qe,aJ as Rt,hw as S,CG as tn,CH as Ge,CI as Yr,CJ as Ai,i1 as en,CK as ge,CL as rn,$ as d,CM as sn,qM as nn,CN as on,CO as ur,nc as an,fH as Li,AC as C,CP as cn,CQ as Gi,CR as un,CS as ln,di as gi,CT as hn,CU as dn,CV as pn,CW as fn,CX as mn,CY as xe,CZ as Ui,to as Wi,C_ as yn,C$ as gn,zf as Yi,A5 as xn,D0 as be,tr as bn,tq as vn,tt as _n,a0 as xi,a2 as wn,a3 as $n,Z as Sn,za as Pn,ak as Tn}from"./chunk-gZYsZ36N.js";import{a as In,i as kn,c as Mn}from"./chunk-LCQ8NG3J.js";import{_ as Nn}from"./chunk-t4TbIqUg.js";import{t as yt}from"./chunk-gJZ7CV2L.js";function bc(r){return r}function vc(r){return r}function En(r,t,e,i,s,n,o){fr=0;const a=(i-e)*n,c=s&&s.length,u=c?(s[0]-e)*n:a;let l,h,p,m,y,b=Hi(t,e,i,0,u,n,!0);if(b&&b.next!==b.prev){if(c&&(b=Fn(t,e,i,s,b,n)),a>80*n){l=p=t[0+e*n],h=m=t[1+e*n];for(let v=n;v<u;v+=n){const w=t[v+e*n],$=t[v+1+e*n];l=Math.min(l,w),h=Math.min(h,$),p=Math.max(p,w),m=Math.max(m,$)}y=Math.max(p-l,m-h),y=y!==0?1/y:0}oe(b,r,n,l,h,y,o,0)}}function Hi(r,t,e,i,s,n,o){let a;if(o===An(r,t,e,i,s,n)>0)for(let c=i;c<s;c+=n)a=bi(c+t*n,r[c+t*n],r[c+1+t*n],a);else for(let c=s-n;c>=i;c-=n)a=bi(c+t*n,r[c+t*n],r[c+1+t*n],a);return a&&St(a,a.next)&&(ae(a),a=a.next),a}function ne(r,t=r){if(!r)return r;let e,i=r;do if(e=!1,i.steiner||!St(i,i.next)&&G(i.prev,i,i.next)!==0)i=i.next;else{if(ae(i),i=t=i.prev,i===i.next)break;e=!0}while(e||i!==t);return t}function oe(r,t,e,i,s,n,o,a){if(!r)return;!a&&n&&(r=Zi(r,i,s,n));let c=r;for(;r.prev!==r.next;){const u=r.prev,l=r.next;if(n?Dn(r,i,s,n):zn(r))t.push(u.index/e+o),t.push(r.index/e+o),t.push(l.index/e+o),ae(r),r=l.next,c=l.next;else if((r=l)===c){a?a===1?oe(r=Gn(r,t,e,o),t,e,i,s,n,o,2):a===2&&Un(r,t,e,i,s,n,o):oe(ne(r),t,e,i,s,n,o,1);break}}}function zn(r){const t=r.prev,e=r,i=r.next;if(G(t,e,i)>=0)return!1;let s=r.next.next;const n=s;let o=0;for(;s!==r.prev&&(o===0||s!==n);){if(o++,Bt(t.x,t.y,e.x,e.y,i.x,i.y,s.x,s.y)&&G(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function Dn(r,t,e,i){const s=r.prev,n=r,o=r.next;if(G(s,n,o)>=0)return!1;const a=s.x<n.x?s.x<o.x?s.x:o.x:n.x<o.x?n.x:o.x,c=s.y<n.y?s.y<o.y?s.y:o.y:n.y<o.y?n.y:o.y,u=s.x>n.x?s.x>o.x?s.x:o.x:n.x>o.x?n.x:o.x,l=s.y>n.y?s.y>o.y?s.y:o.y:n.y>o.y?n.y:o.y,h=dr(a,c,t,e,i),p=dr(u,l,t,e,i);let m=r.prevZ,y=r.nextZ;for(;m&&m.z>=h&&y&&y.z<=p;){if(m!==r.prev&&m!==r.next&&Bt(s.x,s.y,n.x,n.y,o.x,o.y,m.x,m.y)&&G(m.prev,m,m.next)>=0||(m=m.prevZ,y!==r.prev&&y!==r.next&&Bt(s.x,s.y,n.x,n.y,o.x,o.y,y.x,y.y)&&G(y.prev,y,y.next)>=0))return!1;y=y.nextZ}for(;m&&m.z>=h;){if(m!==r.prev&&m!==r.next&&Bt(s.x,s.y,n.x,n.y,o.x,o.y,m.x,m.y)&&G(m.prev,m,m.next)>=0)return!1;m=m.prevZ}for(;y&&y.z<=p;){if(y!==r.prev&&y!==r.next&&Bt(s.x,s.y,n.x,n.y,o.x,o.y,y.x,y.y)&&G(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function bi(r,t,e,i){const s=Ue.create(r,t,e);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function ae(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Cn(r){let t=r,e=r;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==r);return e}function Fn(r,t,e,i,s,n){const o=new Array;for(let a=0,c=i.length;a<c;a++){const u=Hi(r,t,e,i[a]*n,a<c-1?i[a+1]*n:e*n,n,!1);u===u.next&&(u.steiner=!0),o.push(Cn(u))}o.sort(Ln);for(const a of o)s=Bn(a,s);return s}function Bn(r,t){const e=On(r,t);if(!e)return t;const i=qi(e,r);return ne(i,i.next),ne(e,e.next)}function On(r,t){let e=t;const i=r.x,s=r.y;let n,o=-1/0;do{if(s<=e.y&&s>=e.next.y&&e.next.y!==e.y){const p=e.x+(s-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(p<=i&&p>o){if(o=p,p===i){if(s===e.y)return e;if(s===e.next.y)return e.next}n=e.x<e.next.x?e:e.next}}e=e.next}while(e!==t);if(!n)return null;if(i===o)return n.prev;const a=n,c=n.x,u=n.y;let l,h=1/0;for(e=n.next;e!==a;)i>=e.x&&e.x>=c&&i!==e.x&&Bt(s<u?i:o,s,c,u,s<u?o:i,s,e.x,e.y)&&(l=Math.abs(s-e.y)/(i-e.x),(l<h||l===h&&e.x>n.x)&&ce(e,r)&&(n=e,h=l)),e=e.next;return n}function Zi(r,t,e,i){let s;for(;s!==r;s=s.next){if(s=s||r,s.z===null&&(s.z=dr(s.x,s.y,t,e,i)),s.prev.next!==s||s.next.prev!==s)return s.prev.next=s,s.next.prev=s,Zi(r,t,e,i);s.prevZ=s.prev,s.nextZ=s.next}return r.prevZ.nextZ=null,r.prevZ=null,Vn(r)}function Vn(r){let t,e=1;for(;;){let i,s=r;r=null,t=null;let n=0;for(;s;){n++,i=s;let o=0;for(;o<e&&i;o++)i=i.nextZ;let a=e;for(;o>0||a>0&&i;){let c;o===0?(c=i,i=i.nextZ,a--):a!==0&&i?s.z<=i.z?(c=s,s=s.nextZ,o--):(c=i,i=i.nextZ,a--):(c=s,s=s.nextZ,o--),t?t.nextZ=c:r=c,c.prevZ=t,t=c}s=i}if(t.nextZ=null,e*=2,n<2)return r}}function G(r,t,e){return(t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y)}function Xi(r,t,e,i){return!!(St(r,t)&&St(e,i)||St(r,i)&&St(e,t))||G(r,t,e)>0!=G(r,t,i)>0&&G(e,i,r)>0!=G(e,i,t)>0}function Rn(r,t){let e=r;do{if(e.index!==r.index&&e.next.index!==r.index&&e.index!==t.index&&e.next.index!==t.index&&Xi(e,e.next,r,t))return!0;e=e.next}while(e!==r);return!1}function An(r,t,e,i,s,n){let o=0;for(let a=i,c=s-n;a<s;a+=n)o+=(r[c+t*n]-r[a+t*n])*(r[a+1+t*n]+r[c+1+t*n]),c=a;return o}function Bt(r,t,e,i,s,n,o,a){return(s-o)*(t-a)-(r-o)*(n-a)>=0&&(r-o)*(i-a)-(e-o)*(t-a)>=0&&(e-o)*(n-a)-(s-o)*(i-a)>=0}function ce(r,t){return G(r.prev,r,r.next)<0?G(r,t,r.next)>=0&&G(r,r.prev,t)>=0:G(r,t,r.prev)<0||G(r,r.next,t)<0}function dr(r,t,e,i,s){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-e)*s)|r<<8))|r<<4))|r<<2))|r<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*s)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function St(r,t){return r.x===t.x&&r.y===t.y}function Ln(r,t){return r.x-t.x}function Gn(r,t,e,i){let s=r;do{const n=s.prev,o=s.next.next;!St(n,o)&&Xi(n,s,s.next,o)&&ce(n,o)&&ce(o,n)&&(t.push(n.index/e+i),t.push(s.index/e+i),t.push(o.index/e+i),ae(s),ae(s.next),s=r=o),s=s.next}while(s!==r);return s}function Un(r,t,e,i,s,n,o){let a=r;do{let c=a.next.next;for(;c!==a.prev;){if(a.index!==c.index&&Wn(a,c)){let u=qi(a,c);return a=ne(a,a.next),u=ne(u,u.next),oe(a,t,e,i,s,n,o,0),void oe(u,t,e,i,s,n,o,0)}c=c.next}a=a.next}while(a!==r)}function Wn(r,t){return r.next.index!==t.index&&r.prev.index!==t.index&&!Rn(r,t)&&ce(r,t)&&ce(t,r)&&Yn(r,t)}function Yn(r,t){let e=r,i=!1;const s=(r.x+t.x)/2,n=(r.y+t.y)/2;do e.y>n!=e.next.y>n&&e.next.y!==e.y&&s<(e.next.x-e.x)*(n-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==r);return i}function qi(r,t){const e=Ue.create(r.index,r.x,r.y),i=Ue.create(t.index,t.x,t.y),s=r.next,n=t.prev;return r.next=t,t.prev=r,e.next=s,s.prev=e,i.next=e,e.prev=i,n.next=i,i.prev=n,i}let Ue=class Ki{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}static create(t,e,i){const s=fr<pr.length?pr[fr++]:new Ki;return s.index=t,s.x=e,s.y=i,s.prev=null,s.next=null,s.z=null,s.prevZ=null,s.nextZ=null,s.steiner=!1,s}};const pr=[],Hn=8096;let fr=0;for(let r=0;r<Hn;r++)pr.push(new Ue);const Zn=1e-5,_t=new Vi(0,0,0,1,0),mr=new Vi(0,0,0,1,0);function vi(r,t,e){let i=0;for(let s=1;s<e;s++){const n=r[2*(t+s-1)],o=r[2*(t+s-1)+1];i+=(r[2*(t+s)]-n)*(r[2*(t+s)+1]+o)}return i}function Xn(r,t,e,i,s){let n=0;const o=2;for(let a=e;a<i;a+=3){const c=(r[a]-s)*o,u=(r[a+1]-s)*o,l=(r[a+2]-s)*o;n+=Math.abs((t[c]-t[l])*(t[u+1]-t[c+1])-(t[c]-t[u])*(t[l+1]-t[c+1]))}return n}function qn(r,t){const{coords:e,lengths:i,hasIndeterminateRingOrder:s}=t,n=0,o=r;if(s)return!1;let a=0;for(let c=0;c<i.length;){let u=c,l=i[c],h=vi(e,a,l);const p=[];for(;++u<i.length;){const v=i[u],w=vi(e,a+l,v);if(!(w>0))break;h+=w,p.push(a+l),l+=v}const m=o.length;En(o,e,a,a+l,p,2,n);const y=Xn(o,e,m,o.length,n),b=Math.abs(h);if(Math.abs((y-b)/Math.max(1e-7,b))>Zn)return o.length=0,!1;c=u,a+=l}return!0}function Kn(r){const{coords:t,lengths:e}=r,{buffer:i}=In(t,e);return i}function jn(r,t,e){let i=0;for(let s=0;s<r.lengths.length;s++){const n=r.lengths[s];for(let o=0;o<n;o++){const a=r.coords[2*(o+i)],c=r.coords[2*(o+i)+1];if(a<t||a>e||c<t||c>e)return!0}i+=n}return!1}function ji(r,t){if(r==null)return null;if(!jn(r,-128,Le+128))return r;_t.setPixelMargin(t),_t.reset(Ri.Polygon);let e=0;for(let o=0;o<r.lengths.length;o++){const a=r.lengths[o];let c=r.coords[2*(0+e)],u=r.coords[2*(0+e)+1];_t.moveTo(c,u);for(let l=1;l<a;l++)c=r.coords[2*(l+e)],u=r.coords[2*(l+e)+1],_t.lineTo(c,u);_t.close(),e+=a}const i=_t.result(!1);if(!i)return null;const s=[],n=[];for(const o of i){let a=0;for(const c of o)n.push(c.x),n.push(c.y),a++;s.push(a)}return new Xs(s,n)}function Qn(r,t){mr.setPixelMargin(t);const e=mr,i=-t,s=Le+t;let n=[],o=!1;if(!r.nextPath())return null;let a=!0;for(;a;){r.seekPathStart();const c=[];if(!r.pathSize)return null;e.reset(Ri.LineString),r.nextPoint();let u=r.x,l=r.y;if(o)e.moveTo(u,l);else{if(u<i||u>s||l<i||l>s){o=!0;continue}c.push({x:u,y:l})}let h=!1;for(;r.nextPoint();)if(u=r.x,l=r.y,o)e.lineTo(u,l);else{if(u<i||u>s||l<i||l>s){h=!0;break}c.push({x:u,y:l})}if(h)o=!0;else{if(o){const p=e.resultWithStarts();if(p)for(const m of p)n.push(m)}else n.push({line:c,start:0});a=r.nextPath(),o=!1}}return n=n.filter(c=>c.line.length>1),n.length===0?null:n}_t.setExtent(Le),mr.setExtent(Le);const Jn=96/72;let to=class{static executeEffects(t,e,i,s){const n=Jn,o=fi(t);let a=new yi(e);for(const c of t){const u=mi(c);u&&(a=u.execute(a,c,n,i,s,o))}return a}static applyEffects(t,e,i){if(!t)return e;const s=fi(t);let n,o=new yi(ft.fromJSONCIM(e));for(const u of t){const l=mi(u);l&&(o=l.execute(o,u,1,null,i,s))}const a=[];let c=null;for(;n=o.next();)a.push(...qs(n)),c=n.geometryType;return a.length===0||c===null?null:c==="esriGeometryPolygon"?{rings:a}:{paths:a}}},Qi=null;function Hr(){return Qi}async function eo(){Qi=await Nn(()=>import("./chunk-txhloPJY.js").then(r=>r.g),__vite__mapDeps([0,1,2,3,4]))}function Ji(r){switch(r){case g.BYTE:case g.UNSIGNED_BYTE:return 1;case g.SHORT:case g.UNSIGNED_SHORT:return 2;case g.FLOAT:case g.INT:case g.UNSIGNED_INT:return 4}}function ro(r){const t=[],e=[],i=[];for(const s of r){const n=Ji(s.type)*s.count;switch(n%2||n%4||4){case 4:t.push(s);continue;case 2:e.push(s);continue;case 1:i.push(s);continue;default:throw new Error("Found unexpected dataType byte count")}}return t.push(...e),t.push(...i),t}let io=class ts{static fromVertexSpec({attributes:t},e){let i,s,n;const o=[];for(const m in t){const y=t[m];e?.[m]!==!1&&(y.pack==="position"?i={...y,name:m,offset:0}:y.pack==="id"?s={...y,name:m,offset:4}:m==="bitset"?n={...y,name:m,offset:7}:o.push({...y,name:m}))}const a=ro(o),c=[];let u=8,l=1;for(const m of a)c.push({...m,offset:u}),u+=Ji(m.type)*m.count,m.packAlternating&&(l=Math.max(m.packAlternating.count,l));const h=Uint32Array.BYTES_PER_ELEMENT,p=u%h;return new ts(i,s,n,c,u+(p?h-p:0),l)}constructor(t,e,i,s,n,o){this.position=t,this.id=e,this.bitset=i,this.standardAttributes=s,this.stride=n,this.packVertexCount=o,s.push(i),this._attributes=[t,e,i,...s]}get attributeLayout(){if(!this._attributeLayout){const t=Ks(this._attributes),e=this._attributes.map(i=>({name:i.name,count:i.count,offset:i.offset,type:i.type,packPrecisionFactor:i.packPrecisionFactor,normalized:i.normalized??!1}));this._attributeLayout={attributes:e,hash:t,stride:this.stride}}return this._attributeLayout}},so=class es{static fromVertexSpec(t,e){const i=io.fromVertexSpec(t,e);return new es(i)}constructor(t){this._spec=t,this._packed=new Uint8Array(this._spec.stride*this._spec.packVertexCount),this._packedU32View=new Uint32Array(this._packed.buffer),this._dataView=new DataView(this._packed.buffer)}get attributeLayout(){return this._spec.attributeLayout}get stride(){return this._spec.stride}writeVertex(t,e,i,s,n,o){for(let a=0;a<this._spec.packVertexCount;a++){const c=a*this._spec.stride;this._packPosition(i,s,c),this._packId(e,c);const u=this._spec.bitset;if(o){if(u.packTessellation){const l=u.packTessellation(o,n);this._pack(l,u,c)}for(const l of this._spec.standardAttributes)if(l.packTessellation!=null){const h=l.packTessellation(o,n);this._pack(h,l,c)}else if(l.packAlternating?.packTessellation){const h=l.packAlternating.packTessellation(o,n);for(let p=0;p<this._spec.packVertexCount;p++){const m=h[p];this._pack(m,l,p*this._spec.stride)}}}}t.vertexWriteRegion(this._packedU32View)}pack(t,e){for(const i of this._spec.standardAttributes)if(i.pack&&typeof i.pack!="string"){const s=i.pack(t,e);for(let n=0;n<this._spec.packVertexCount;n++)this._pack(s,i,n*this._spec.stride)}else if(i.packAlternating?.pack){const s=i.packAlternating.pack(t,e);for(let n=0;n<this._spec.packVertexCount;n++){const o=s[n];this._pack(o,i,n*this._spec.stride)}}}_packPosition(t,e,i){const{offset:s}=this._spec.position,n=this._spec.position.packPrecisionFactor??1,o=Qs(t*n,e*n);this._dataView.setUint32(i+s,o,!0)}_packId(t,e){const i=t*(this._spec.id.packPrecisionFactor??1),s=4278190080&this._dataView.getUint32(e+this._spec.id.offset,!0);this._dataView.setUint32(e+this._spec.id.offset,i|s,!0)}_pack(t,e,i){js(this._dataView,t,e,i)}};function no(r){if(!r)return!1;for(const t of r)switch(t.effect.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1}let Gt=class{constructor(t,e,i,s){this._instanceId=t,this._evaluator=e,this._viewParams=i,this._optionalAttributes=s,this._evaluator.evaluator=n=>this.vertexSpec.createComputedParams(n)}get _vertexPack(){if(!this._cachedVertexPack){const t=so.fromVertexSpec(this.vertexSpec,this._optionalAttributes);this._evaluator.hasDynamicProperties||t.pack(this._evaluator.evaluatedMeshParams,this._viewParams),this._cachedVertexPack=t}return this._cachedVertexPack}get evaluatedMeshParams(){return this._evaluator.evaluatedMeshParams}get hasEffects(){return!!this.evaluatedMeshParams.effects}get instanceId(){return this._instanceId}get attributeLayout(){return this._vertexPack.attributeLayout}setReferences(t){this._references=t}getBoundsInfo(){return null}getTileInfo(){return this._viewParams.tileInfo}async loadDependencies(){no(this._evaluator.inputMeshParams.params.effects?.effectInfos)&&await eo()}enqueueRequest(t,e,i){this._evaluator.hasDynamicProperties&&this._evaluator.enqueueRequest(t,e,i)}write(t,e,i,s,n){this.ensurePacked(e,i,s);const o=this.evaluatedMeshParams.effects;if(!o||o.length===0)return void this._write(t,i,void 0,n);const a=i.readGeometryForDisplay()?.clone();if(!a)return;const c=ft.fromOptimizedCIM(a,i.geometryType),u=Hr();c.invertY();const l=t.id||"",h=to.executeEffects(o,c,l,u);let p;for(;p=h.next();)p.invertY(),this._write(t,i,p,n)}ensurePacked(t,e,i){if(!this._evaluator.hasDynamicProperties)return;const s=this._evaluator.evaluateMeshParams(t,e,i);this._vertexPack.pack(s,this._viewParams)}_writeVertex(t,e,i,s,n){const o=this.evaluatedMeshParams;this._vertexPack.writeVertex(t,e,i,s,o,n)}};const oo=100,ao=Ur("featurelayer-fast-triangulation-enabled");let rs=class extends Gt{async loadDependencies(){await Promise.all([super.loadDependencies(),kn()])}_write(t,e,i){const s=i?.asOptimized()??e.readGeometryForDisplay(),n=this._clip(s);n&&(t.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(t,e,n),t.recordEnd())}_clip(t){if(!t)return null;const e=this.hasEffects;return ji(t,e?256:8)}_writeGeometry(t,e,i){const s=i.maxLength>oo,n=[],o=this.createTesselationParams(e);if(!s&&ao&&qn(n,i))return void(n.length&&this._writeVertices(t,e,i.coords,o,n));const a=Kn(i);this._writeVertices(t,e,a,o)}_writeVertices(t,e,i,s,n){const o=e.getDisplayId(),a=t.vertexCount(),c=this.hasEffects;let u=0;if(n)for(const l of n){const h=i[2*l],p=i[2*l+1];c&&t.recordBounds(h,p,0,0),this._writeVertex(t,o,h,p,s),u++}else for(let l=0;l<i.length;l+=2){const h=Math.round(i[l]),p=Math.round(i[l+1]);c&&t.recordBounds(h,p,0,0),this._writeVertex(t,o,h,p,s),u++}t.indexEnsureSize(u);for(let l=0;l<u;l++)t.indexWrite(l+a)}};const co={createComputedParams:r=>r,attributes:{id:{type:g.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:g.UNSIGNED_BYTE,count:1},pos:{type:g.SHORT,count:2,pack:"position",packPrecisionFactor:10},inverseArea:{type:g.FLOAT,count:1,packTessellation:({inverseArea:r})=>r}}};let uo=class extends rs{constructor(){super(...arguments),this.vertexSpec=co}createTesselationParams(t){return{inverseArea:1/t.readGeometryArea()}}};const lo=()=>je.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.meshWriterUtils"),ho=0,po=100;function Ut(r,t){return[!!r?.minScale&&t.scaleToZoom(r.minScale)||ho,!!r?.maxScale&&t.scaleToZoom(r.maxScale)||po]}function Zt(r){return 1<<r}function de(r){let t=0;for(const[e,i]of r)i&&(t|=1<<e);return t}function A(r){let t;if(!r)return[0,0,0,0];if(typeof r=="string"){const o=Js.fromString(r);if(!o)return lo().errorOnce(new Wr("mapview:mesh-processing","Unable to parse string into color",{color:r})),[0,0,0,0];t=o.toArray()}else t=r;const[e,i,s,n]=t;return[e*(n/255),i*(n/255),s*(n/255),n]}function fo(r){switch(r){case"butt":case nr.Butt:return or.BUTT;case"round":case nr.Round:return or.ROUND;case"square":case nr.Square:return or.SQUARE}}function mo(r){switch(r){case"bevel":case ar.Bevel:return cr.BEVEL;case"miter":case ar.Miter:return cr.MITER;case"round":case ar.Round:return cr.ROUND}}function lr(r,t){return Math.round(Math.min(Math.sqrt(r*t),255))}function ve(r,t){return Math.round(r*t)/t}function _i(r,t){return Math.ceil(r*t)/t}const is={createComputedParams:r=>r,attributes:{id:{type:g.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:g.UNSIGNED_BYTE,count:1},pos:{type:g.SHORT,count:2,pack:"position",packPrecisionFactor:10},zoomRange:{type:g.SHORT,count:2,packPrecisionFactor:Qe,pack:({scaleInfo:r},{tileInfo:t})=>Ut(r,t)},color:{type:g.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:r})=>A(r)}}};let Zr=class extends rs{constructor(){super(...arguments),this.vertexSpec=is}createTesselationParams(t){return null}};const Je={createComputedParams:r=>r,attributes:{...is.attributes,tlbr:{count:4,type:g.UNSIGNED_SHORT,pack:({sprite:r})=>{const{rect:t,width:e,height:i}=r,s=t.x+Rt,n=t.y+Rt;return[s,n,s+e,n+i]}},inverseRasterizationScale:{count:1,type:g.BYTE,packPrecisionFactor:16,pack:({sprite:r})=>1/r.rasterizationScale}}};let ss=class extends Zr{constructor(){super(...arguments),this.vertexSpec=Je}_write(t,e,i){const s=i?.asOptimized()??e.readGeometryForDisplay(),n=this._clip(s);if(!n)return;const o=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,o),this._writeGeometry(t,e,n),t.recordEnd()}};var wi;(function(r){r[r.Geographic=0]="Geographic",r[r.Arithmatic=1]="Arithmatic"})(wi||(wi={}));const Ic=3.14159265359/180,yo=3.14159265359/128,kc=1,go=1.1,xo=1,Mc=24,Nc=8,bo=1e-5,$i=.05,vo=1e-30,Xr=4,qr=0,ns=2,os=5,as=6,_o=2,wo=3,$o=0,So=3,Po=16777216;function Kr(r){const{sprite:t,aspectRatio:e,scaleProportionally:i}=r,s=S(r.height),n=s>0?s:t.height;let o=s*e;return o<=0?o=t.width:i&&(o*=t.width/t.height),{width:o,height:n}}function cs(r){const{applyRandomOffset:t,sampleAlphaOnly:e}=r,{width:i,height:s}=Kr(r);return de([[ns,t],[Xr,e],[as,i<Ge],[os,s<Ge]])}function us(r){const{width:t}=Kr(r);return Math.round(t<Ge?t*Yr:t)}function ls(r){const{height:t}=Kr(r);return Math.round(t<Ge?t*Yr:t)}const hs={createComputedParams:r=>r,attributes:{...Je.attributes,bitset:{count:1,type:g.UNSIGNED_BYTE,pack:cs},width:{count:1,type:g.UNSIGNED_SHORT,pack:us},height:{count:1,type:g.UNSIGNED_SHORT,pack:ls},offset:{count:2,type:g.SHORT,pack:({offsetX:r,offsetY:t})=>[S(r),-S(t)]},scale:{count:2,type:g.UNSIGNED_BYTE,packPrecisionFactor:16,pack:({scaleX:r,scaleY:t})=>[r,t]},angle:{count:1,type:g.UNSIGNED_BYTE,pack:({angle:r})=>tn(r)}}};let To=class extends ss{constructor(){super(...arguments),this.vertexSpec=hs}},Io=class{constructor(){this.extrusionOffsetX=0,this.extrusionOffsetY=0,this.normalX=0,this.normalY=0,this.directionX=0,this.directionY=0,this.distance=0}};const tr={createComputedParams:r=>r,attributes:{id:{type:g.UNSIGNED_BYTE,count:3,pack:"id"},pos:{type:g.SHORT,count:2,pack:"position",packPrecisionFactor:10},bitset:{type:g.UNSIGNED_BYTE,count:1},zoomRange:{type:g.SHORT,count:2,packPrecisionFactor:Qe,pack:({scaleInfo:r},{tileInfo:t})=>Ut(r,t)},color:{type:g.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:r})=>A(r)},offset:{type:g.BYTE,count:2,packPrecisionFactor:16,packTessellation:({extrusionOffsetX:r,extrusionOffsetY:t})=>[ve(r,16),ve(t,16)]},normal:{type:g.BYTE,count:2,packPrecisionFactor:16,packTessellation:({normalX:r,normalY:t})=>[ve(r,16),ve(t,16)]},halfWidth:{type:g.UNSIGNED_SHORT,count:1,packPrecisionFactor:16,pack:({width:r})=>_i(S(.5*r),16)},referenceHalfWidth:{type:g.UNSIGNED_SHORT,count:1,packPrecisionFactor:16,pack:({referenceWidth:r})=>_i(S(.5*r),16)}}};let ko=class{constructor(){this.id=0,this.bitset=0,this.indexCount=0,this.vertexCount=0,this.vertexFrom=0,this.vertexBounds=0}};const Si=65535;let jr=class extends Gt{constructor(t,e,i,s){super(t,e,i,s),this.vertexSpec=tr,this._currentWrite=new ko,this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0,wrapDistance:Si,textured:!1},this._tessParams=new Io,this._initializeTessellator()}writeLineVertices(t,e,i){const s=this._getLines(e);s!=null&&this._writeVertices(t,i,s)}_initializeTessellator(){this._lineTessellator=new Mn(this._writeTesselatedVertex.bind(this),this._writeTriangle.bind(this),!0)}_write(t,e,i){const s=i??ft.fromFeatureSetReaderCIM(e);s&&this._writeGeometry(t,e,s)}_writeGeometry(t,e,i,s){t.recordStart(this.instanceId,this.attributeLayout,s),this.writeLineVertices(t,i,e),t.recordEnd()}_getLines(t){return Qn(t,Ai(this.evaluatedMeshParams))}_writeVertices(t,e,i){const{_currentWrite:s,_tessellationOptions:n,evaluatedMeshParams:o}=this,{width:a,capType:c,joinType:u,miterLimit:l,hasSizeVV:h}=o,p=S(.5*a);n.halfWidth=p,n.capType=fo(c),n.joinType=mo(u),n.miterLimit=l;const m=!h;s.out=t,s.id=e.getDisplayId(),s.vertexCount=0,s.indexCount=0,s.vertexFrom=t.vertexCount(),s.vertexBounds=m&&p<en?0:1;for(const{line:y,start:b}of i)n.initialDistance=b%Si,this._lineTessellator.tessellate(y,n,m)}_writeTesselatedVertex(t,e,i,s,n,o,a,c,u,l,h){const{out:p,id:m,vertexBounds:y}=this._currentWrite;return this.hasEffects&&p.recordBounds(t,e,y,y),this._tessParams.extrusionOffsetX=a,this._tessParams.extrusionOffsetY=c,this._tessParams.normalX=u,this._tessParams.normalY=l,this._tessParams.directionX=n,this._tessParams.directionY=o,this._tessParams.distance=h,this._writeVertex(p,m,t,e,this._tessParams),this._currentWrite.vertexFrom+this._currentWrite.vertexCount++}_writeTriangle(t,e,i){const{out:s}=this._currentWrite;s.indexEnsureSize(3),s.indexWrite(t),s.indexWrite(e),s.indexWrite(i),this._currentWrite.indexCount+=3}};const ds={createComputedParams:r=>r,attributes:{...tr.attributes,bitset:{type:g.UNSIGNED_BYTE,count:1,pack:r=>0},color:{type:g.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:r})=>A(r)}}},Qr={createComputedParams:r=>r,attributes:{...tr.attributes,bitset:{type:g.UNSIGNED_BYTE,count:1,pack:r=>de([[qr,!0]])},color:{type:g.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:r})=>A(r)}}};let Jr=class extends jr{constructor(){super(...arguments),this.vertexSpec=Qr}},ti=class extends Zr{constructor(t,e,i,s){super(t,e,i,s),this.vertexSpec=ds,this._lineMeshWriter=this._createOutlineWriter(t,e,i,s)}_createOutlineWriter(t,e,i,s){return new Jr(t,e,i,s)}_write(t,e,i){const s=i?.asOptimized()??e.readGeometryForDisplay(),n=this._clip(s);n&&(t.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(t,e,n),this._lineMeshWriter.writeLineVertices(t,ft.fromOptimizedCIM(n,"esriGeometryPolyline"),e),t.recordEnd())}_clip(t){return t?ji(t,Ai(this.evaluatedMeshParams)):null}ensurePacked(t,e,i){super.ensurePacked(t,e,i),this._lineMeshWriter.ensurePacked(t,e,i)}enqueueRequest(t,e,i){super.enqueueRequest(t,e,i),this._lineMeshWriter.enqueueRequest(t,e,i)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}};const ps=()=>je.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let fs=class{constructor(){this._includedModules=new Map}include(t,e){if(this._includedModules.has(t)){const i=this._includedModules.get(t);if(i!==e){ps().error("Trying to include shader module multiple times with different sets of options.");const s=new Set;for(const n of Object.keys(i))i[n]!==t[n]&&s.add(n);for(const n of Object.keys(t))i[n]!==t[n]&&s.add(n);s.forEach(n=>console.error(`  ${n}: current ${i[n]} new ${t[n]}`))}}else this._includedModules.set(t,e),t(this.builder,e)}},Mo=class extends fs{constructor(){super(...arguments),this.vertex=new Pi,this.fragment=new Pi,this.attributes=new zo,this.varyings=new Do,this.extensions=new yr,this.constants=new ms}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(t,e=!0){const i=this.extensions.generateSource(t),s=this.attributes.generateSource(t),n=this.varyings.generateSource(t),o=t==="vertex"?this.vertex:this.fragment,a=o.uniforms.generateSource(),c=o.code.generateSource(),u=t==="vertex"?Fo:Co(e),l=this.constants.generateSource().concat(o.constants.generateSource());return`${e?"#version 300 es":""}
${i.join(`
`)}
${u}
${l.join(`
`)}
${a.join(`
`)}
${s.join(`
`)}
${n.join(`
`)}
${c.join(`
`)}`}generateBindPass(t){const e=new Map;this.vertex.uniforms.entries.forEach(n=>{const o=n.bind[ge.Pass];o&&e.set(n.name,o)}),this.fragment.uniforms.entries.forEach(n=>{const o=n.bind[ge.Pass];o&&e.set(n.name,o)});const i=Array.from(e.values()),s=i.length;return(n,o)=>{for(let a=0;a<s;++a)i[a](t,n,o)}}generateBindDraw(t){const e=new Map;this.vertex.uniforms.entries.forEach(n=>{const o=n.bind[ge.Draw];o&&e.set(n.name,o)}),this.fragment.uniforms.entries.forEach(n=>{const o=n.bind[ge.Draw];o&&e.set(n.name,o)});const i=Array.from(e.values()),s=i.length;return(n,o,a)=>{for(let c=0;c<s;++c)i[c](t,n,o,a)}}},No=class{constructor(){this._entries=new Map}add(...t){for(const e of t)this._add(e)}get(t){return this._entries.get(t)}_add(t){if(t!=null){if(this._entries.has(t.name)&&!this._entries.get(t.name).equals(t))throw new Wr(`Duplicate uniform name ${t.name} for different uniform type`);this._entries.set(t.name,t)}else ps().error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(t=>t.arraySize!=null?`uniform ${t.type} ${t.name}[${t.arraySize}];`:`uniform ${t.type} ${t.name};`)}get entries(){return Array.from(this._entries.values())}},Eo=class{constructor(){this._entries=new Array}add(t){this._entries.push(t)}generateSource(){return this._entries}},Pi=class extends fs{constructor(){super(...arguments),this.uniforms=new No,this.code=new Eo,this.constants=new ms}get builder(){return this}},zo=class{constructor(){this._entries=new Array}add(t,e){this._entries.push([t,e])}generateSource(t){return t==="fragment"?[]:this._entries.map(e=>`in ${e[1]} ${e[0]};`)}},Do=class{constructor(){this._entries=new Map}add(t,e){this._entries.has(t)&&rn(this._entries.get(t)===e),this._entries.set(t,e)}generateSource(t){const e=new Array;return this._entries.forEach((i,s)=>e.push(t==="vertex"?`out ${i} ${s};`:`in ${i} ${s};`)),e}},yr=class gr{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){const e=t==="vertex"?gr.ALLOWLIST_VERTEX:gr.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(i=>e.includes(i)).map(i=>`#extension ${i} : enable`)}};yr.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],yr.ALLOWLIST_VERTEX=[];let ms=class z{constructor(){this._entries=new Set}add(t,e,i){let s="ERROR_CONSTRUCTOR_STRING";switch(e){case"float":s=z._numberToFloatStr(i);break;case"int":s=z._numberToIntStr(i);break;case"bool":s=i.toString();break;case"vec2":s=`vec2(${z._numberToFloatStr(i[0])},                            ${z._numberToFloatStr(i[1])})`;break;case"vec3":s=`vec3(${z._numberToFloatStr(i[0])},                            ${z._numberToFloatStr(i[1])},                            ${z._numberToFloatStr(i[2])})`;break;case"vec4":s=`vec4(${z._numberToFloatStr(i[0])},                            ${z._numberToFloatStr(i[1])},                            ${z._numberToFloatStr(i[2])},                            ${z._numberToFloatStr(i[3])})`;break;case"ivec2":s=`ivec2(${z._numberToIntStr(i[0])},                             ${z._numberToIntStr(i[1])})`;break;case"ivec3":s=`ivec3(${z._numberToIntStr(i[0])},                             ${z._numberToIntStr(i[1])},                             ${z._numberToIntStr(i[2])})`;break;case"ivec4":s=`ivec4(${z._numberToIntStr(i[0])},                             ${z._numberToIntStr(i[1])},                             ${z._numberToIntStr(i[2])},                             ${z._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${e}(${Array.prototype.map.call(i,n=>z._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${e} ${t} = ${s};`),this}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}};function Co(r=!0){return`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif
${r?"out vec4 fragColor;":""}
`}const Fo=`precision highp float;
precision highp sampler2D;`;function Bo(r){return r.split(" ").map((t,e)=>e>0?t.charAt(0).toUpperCase()+t.slice(1):t).join("")}function Oo(r,t){const e=[];for(e.push(t);e.length;){const i=e.pop();if(typeof i=="object"&&!r.has(i.uid)){r.add(i.uid);for(const s of i.children)e.push(s)}}}let kt=class xr{constructor(){this.uid=xr.NodeCount++,this._debugName=null,this._isMutable=!1,this.isImplicit=!1}get isMutable(){return this._isMutable}setMutable(){return this._isMutable=!0,this}setDebugName(t){return t=Bo(t),this._debugName=t,this.isImplicit&&this.children[0]instanceof xr&&this.children[0].setDebugName(t),this}get debugInfo(){return{name:this._debugName??""}}cloneInto(t){t._debugName=this._debugName,t._isMutable=this._isMutable,t.isImplicit=this.isImplicit,t.uid=this.uid}};function x(r){return typeof r=="object"?r.clone():r}kt.NodeCount=0;let B=class extends kt{constructor(){super(...arguments),this.shaderType="primitive-node"}},Vo=class ys extends kt{constructor(t){super(),this.child=t,this.shaderType="scope-node"}get children(){return[this.child]}clone(){const t=new ys(x(this.child));return this.cloneInto(t),t}},Ro=class gs extends kt{constructor(t,e,i){super(),this.property=t,this.target=e,this.returnType=i,this.shaderType="property-access-node"}get children(){const t=[this.target];return typeof this.property!="string"&&t.push(this.property),t}clone(){const t=new gs(this.property,x(this.target),this.returnType);return this.cloneInto(t),t}},Ao=class xs extends kt{constructor(t,e,i){super(),this.condition=t,this.ifTrue=e,this.ifFalse=i,this.shaderType="condition-node"}get children(){return[this.condition,this.ifTrue,this.ifFalse]}clone(){const t=x(this.ifTrue),e=this.ifFalse?x(this.ifFalse):null,i=new xs(this.condition,t,e);return this.cloneInto(i),i}},Lo=class bs extends kt{constructor(t,e,i,s){super(),this.captureList=t,this.returnType=e,this.generator=s,this.shaderType="block-node",i&&(this.subgraph=new Vo(i))}get children(){return Object.keys(this.captureList).map(t=>this.captureList[t]).concat(this.subgraph??[])}clone(){const t={};for(const i in this.captureList)t[i]=x(this.captureList[i]);const e=new bs(t,this.returnType,this.subgraph?x(this.subgraph.child):this.subgraph,this.generator);return this.cloneInto(e),e}},Pt=class vs extends kt{constructor(t,e,i,s,n,o=!1){super(),this.token=t,this._children=e,this.isInfix=i,this.isPropertyAccess=s,this.returnType=n,this.isTernary=o,this.shaderType="function-node"}get children(){return this._children}clone(){const t=new vs(this.token,this._children.map(x),this.isInfix,this.isPropertyAccess,this.returnType,this.isTernary);return this.cloneInto(t),t}};var te,br,vr,_r,wr,$r,Sr,Pr,Tr,Ir,kr,Mr,Nr,Er;function Go(r){const t=[["float","vec2","vec3","vec4"],["int","ivec2","ivec3","ivec4"],["uint","uvec2","uvec3","uvec4"],["bool","bvec2","bvec3","bvec4"]];for(const e of t)if(e.includes(r))return e.map(i=>Ho[i]);throw new Error("Unable to find type family")}function _s(r){return new Proxy(r,{get(t,e){if(e==="constructor")return new Proxy(t.constructor,{construct:(i,s,n)=>_s(new i(...s))});if(e in t)return t[e];if(typeof e=="string"){const i=Go(r.type);return Z(r,e,i[e.length-1])}}})}function q(r){return new Proxy(r,{construct:(t,e,i)=>_s(new t(...e))})}function Uo(r){return new Proxy(r,{get(t,e){if(e in t)return t[e];if(typeof e=="string"){const i=parseInt(e,10);if(!isNaN(i))return Z(r,`[${i}]`,r.elementType.constructor)}}})}function Wo(r){return new Proxy(r,{construct:(t,e,i)=>Uo(new t(...e))})}let zr=class extends Error{},rt=te=class extends B{constructor(r,t){super(),this.elementType=r,this.size=t,this.children=[],this.type="array"}clone(){const r=new te(this.elementType,this.size);return super.cloneInto(r),r}get(r){if(typeof r=="number"){const t=new xt(r);return t.isImplicit=!0,Z(this,t,this.elementType.constructor)}return Z(this,r,this.elementType.constructor)}last(){return this.get(this.size-1)}first(){return this.get(0)}findIndex(r,t,e){return qo(this,r,t,e)}glslFindIndex(r,t,e){return Ko(this,r,t,e)}static ofType(r,t){const e={construct:(i,s)=>new te(new r,t)};return new Proxy(te,e)}};rt.type="array",rt=te=d([Wo],rt);let ct=class ws extends B{constructor(){super(...arguments),this.type="sampler2D",this.children=[]}clone(){const t=new ws;return t.children=this.children.map(x),super.cloneInto(t),t}};ct.type="sampler2D";let f=class Ct extends B{constructor(t){super(),this.type="float",this.children=[t]}clone(){const t=new Ct(x(this.children[0]));return super.cloneInto(t),t}multiply(t){return vt(this,typeof t=="number"?O(t,Ct):t)}divide(t){return fe(this,typeof t=="number"?O(t,Ct):t)}add(t){return Wt(this,typeof t=="number"?O(t,Ct):t)}subtract(t){return me(this,typeof t=="number"?O(t,Ct):t)}};f.type="float";let T=br=class extends B{constructor(r,t){super(),this.type="vec2",this.children=[r,t].filter(e=>e!=null)}clone(){const r=new br(x(this.children[0]),x(this.children[1]));return super.cloneInto(r),r}get 0(){return Z(this,"[0]",f)}get 1(){return Z(this,"[1]",f)}get 2(){throw new zr}get 3(){throw new zr}multiply(r){return vt(this,typeof r=="number"?O(r,f):r)}divide(r){return fe(this,typeof r=="number"?O(r,f):r)}add(r){return Wt(this,typeof r=="number"?O(r,f):r)}subtract(r){return me(this,typeof r=="number"?O(r,f):r)}};T.type="vec2",T=br=d([q],T);let V=vr=class extends B{constructor(r,t,e){super(),this.type="vec3",this.children=[r,t,e].filter(i=>i!=null)}get 0(){return Z(this,"[0]",f)}get 1(){return Z(this,"[1]",f)}get 2(){return Z(this,"[2]",f)}get 3(){throw new zr}clone(){const r=new vr(x(this.children[0]),x(this.children[1]),x(this.children[2]));return super.cloneInto(r),r}multiply(r){return vt(this,typeof r=="number"?O(r,f):r)}divide(r){return fe(this,typeof r=="number"?O(r,f):r)}add(r){return Wt(this,typeof r=="number"?O(r,f):r)}subtract(r){return me(this,typeof r=="number"?O(r,f):r)}};V.type="vec3",V=vr=d([q],V);let k=_r=class extends B{constructor(r,t,e,i){super(),this.type="vec4",this.children=[r,t,e,i].filter(s=>s!=null)}clone(){const r=new _r(x(this.children[0]),x(this.children[1]),x(this.children[2]),x(this.children[3]));return super.cloneInto(r),r}get 0(){return Z(this,"[0]",f)}get 1(){return Z(this,"[1]",f)}get 2(){return Z(this,"[2]",f)}get 3(){return Z(this,"[3]",f)}multiply(r){return vt(this,typeof r=="number"?O(r,f):r)}divide(r){return fe(this,typeof r=="number"?O(r,f):r)}add(r){return Wt(this,typeof r=="number"?O(r,f):r)}subtract(r){return me(this,typeof r=="number"?O(r,f):r)}};k.type="vec4",k=_r=d([q],k);let Me=wr=class extends B{constructor(r){super(),this.type="uint",this.children=[r]}clone(){const r=new wr(x(this.children[0]));return super.cloneInto(r),r}};Me.type="uint",Me=wr=d([q],Me);let Ne=$r=class extends B{constructor(r,t){super(),this.type="uvec2",this.children=[r,t].filter(e=>e!=null)}clone(){const r=new $r(x(this.children[0]),x(this.children[1]));return super.cloneInto(r),r}};Ne.type="uvec2",Ne=$r=d([q],Ne);let Ee=Sr=class extends B{constructor(r,t,e){super(),this.type="uvec3",this.children=[r,t,e].filter(i=>i!=null)}clone(){const r=new Sr(x(this.children[0]),x(this.children[1]),x(this.children[2]));return super.cloneInto(r),r}};Ee.type="uvec3",Ee=Sr=d([q],Ee);let ze=Pr=class extends B{constructor(r,t,e,i){super(),this.type="uvec4",this.children=[r,t,e,i].filter(s=>s!=null)}clone(){const r=new Pr(x(this.children[0]),x(this.children[1]),x(this.children[2]),x(this.children[3]));return super.cloneInto(r),r}};ze.type="uvec4",ze=Pr=d([q],ze);class H extends B{constructor(t){super(),this.type="bool",this.children=[t]}and(t){return Cr(this,t)}or(t){return Ps(this,t)}clone(){const t=new H(x(this.children[0]));return super.cloneInto(t),t}}H.type="bool";let De=Tr=class extends B{constructor(r,t){super(),this.type="bvec2",this.children=[r,t].filter(e=>e!=null)}all(){return ii(this)}any(){return si(this)}clone(){const r=new Tr(x(this.children[0]),x(this.children[1]));return super.cloneInto(r),r}};De.type="bvec2",De=Tr=d([q],De);let Ce=Ir=class extends B{constructor(r,t,e){super(),this.type="bvec3",this.children=[r,t,e].filter(i=>i!=null)}all(){return ii(this)}any(){return si(this)}clone(){const r=new Ir(x(this.children[0]),x(this.children[1]),x(this.children[2]));return super.cloneInto(r),r}};function O(r,t){return typeof r=="number"?new t(r):r}Ce.type="bvec3",Ce=Ir=d([q],Ce);let Fe=kr=class extends B{constructor(r,t,e,i){super(),this.type="bvec4",this.children=[r,t,e,i].filter(s=>s!=null)}all(){return ii(this)}any(){return si(this)}clone(){const r=new kr(x(this.children[0]),x(this.children[1]),x(this.children[2]),x(this.children[3]));return super.cloneInto(r),r}};Fe.type="bvec4",Fe=kr=d([q],Fe);let xt=class Ft extends B{constructor(t){super(),this.type="int",this.children=[t]}multiply(t){return vt(this,O(t,Ft))}add(t){return Wt(this,O(t,Ft))}subtract(t){return me(this,O(t,Ft))}divide(t){return fe(this,O(t,Ft))}clone(){const t=new Ft(x(this.children[0]));return super.cloneInto(t),t}};xt.type="int";let Be=Mr=class extends B{constructor(r,t){super(),this.type="ivec2",this.children=[r,t].filter(e=>e!=null)}clone(){const r=new Mr(x(this.children[0]),x(this.children[1]));return super.cloneInto(r),r}};Be.type="ivec2",Be=Mr=d([q],Be);let Oe=Nr=class extends B{constructor(r,t,e){super(),this.type="ivec3",this.children=[r,t,e].filter(i=>i!=null)}clone(){const r=new Nr(x(this.children[0]),x(this.children[1]),x(this.children[2]));return super.cloneInto(r),r}};Oe.type="ivec3",Oe=Nr=d([q],Oe);let Ve=Er=class extends B{constructor(r,t,e,i){super(),this.type="ivec4",this.children=[r,t,e,i].filter(s=>s!=null)}clone(){const r=new Er(x(this.children[0]),x(this.children[1]),x(this.children[2]),x(this.children[3]));return super.cloneInto(r),r}};Ve.type="ivec4",Ve=Er=d([q],Ve);let Yo=class $s extends B{constructor(t,e,i,s){super(),this.type="mat2",this.children=[t,e,i,s]}clone(){const t=new $s(x(this.children[0]),x(this.children[1]),x(this.children[2]),x(this.children[3]));return super.cloneInto(t),t}};Yo.type="mat2";class Y extends B{static identity(){return new Y(1,0,0,0,1,0,0,0,1)}static fromRotation(t){const e=ai(t),i=Ts(t);return new Y(i,e,0,We(e),i,0,0,0,1)}constructor(t,e,i,s,n,o,a,c,u){super(),this.type="mat3",this.children=[t,e,i,s,n,o,a,c,u]}add(t){return Wt(this,t)}multiply(t){return vt(this,t)}clone(){const t=new Y(x(this.children[0]),x(this.children[1]),x(this.children[2]),x(this.children[3]),x(this.children[4]),x(this.children[5]),x(this.children[6]),x(this.children[7]),x(this.children[8]));return super.cloneInto(t),t}}Y.type="mat3";class re extends B{static identity(){return new re(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}constructor(t,e,i,s,n,o,a,c,u,l,h,p,m,y,b,v){super(),this.type="mat4",this.children=[t,e,i,s,n,o,a,c,u,l,h,p,m,y,b,v]}static fromColumns(t,e,i,s){return new re(t.x,t.y,t.z,t.w,e.x,e.y,e.z,e.w,i.x,i.y,i.z,i.w,s.x,s.y,s.z,s.w)}multiply(t){return vt(this,t)}clone(){const t=new re(x(this.children[0]),x(this.children[1]),x(this.children[2]),x(this.children[3]),x(this.children[4]),x(this.children[5]),x(this.children[6]),x(this.children[7]),x(this.children[8]),x(this.children[9]),x(this.children[10]),x(this.children[11]),x(this.children[12]),x(this.children[13]),x(this.children[14]),x(this.children[15]));return super.cloneInto(t),t}}re.type="mat4";const Ho={float:f,vec2:T,vec3:V,vec4:k,int:xt,ivec2:Be,ivec3:Oe,ivec4:Ve,uint:Me,uvec2:Ne,uvec3:Ee,uvec4:ze,bool:H,bvec2:De,bvec3:Ce,bvec4:Fe},Et=(...r)=>new xt(...r),D=(...r)=>new f(...r),Dr=(...r)=>new T(...r),Zo=(...r)=>new V(...r),Xo=(...r)=>new k(...r),Ti=(...r)=>new Y(...r);function Z(r,t,e){const i=new e(new Ro(t,r,e));return i.isImplicit=!0,i}function K(r,t,e,i=null){if(i){const n=new i,o=new i(new Pt(r,[t,e],!0,!1,n));return o.isImplicit=!0,o}if(t.type==="float"||t.type==="int"){const n=new e.constructor(new Pt(r,[t,e],!0,!1,e.constructor));return n.isImplicit=!0,n}if((t.type==="mat2"||t.type==="mat3"||t.type==="mat4")&&e.type!=="float"){const n=new e.constructor(new Pt(r,[t,e],!0,!1,e.constructor));return n.isImplicit=!0,n}const s=new t.constructor(new Pt(r,[t,e],!0,!1,t.constructor));return s.isImplicit=!0,s}function J(r,t,e=t.constructor){const i=new e(new Pt(r,[t],!1,!1,e));return i.isImplicit=!0,i}function Mt(r,t,e,i=t.constructor){const s=new i(new Pt(r,[t,e],!1,!1,i));return s.isImplicit=!0,s}function ei(r,t,e,i,s=t.constructor){const n=new s(new Pt(r,[t,e,i],!1,!1,s));return n.isImplicit=!0,n}function We(r){return vt(r,D(-1))}function Ss(r,t,e,i){return new t(new Lo(r,t,e,i))}function qo(r,t,e=0,i=r.size){const s=new xt(e).setMutable().setDebugName("FindIndexIterator"),n=t(r.get(s)).setDebugName("FindIndexPredicate");return Ss({iter:s},xt,n,({out:a,iter:c,subgraph:u})=>`
${a} = -1;

for (; ${c} < ${i}; ${c}++) {

${u.body}

  if (${u.varName}) {
    ${a} = ${c};
    break;
  }

}
`).setDebugName("FindIndexBlock")}function Ko(r,t,e=0,i=r.size){return Ss({array:r},xt,null,({out:n,array:o})=>`
${n} = -1;
for (int i = ${e}; i < ${i}; i++) {
  bool condition;
  ${t({array:o,i:"i",out:"condition"})}
  if (condition) {
    ${n} = i;
    break;
  }
}
`).setDebugName("GlslFindIndexBlock")}function R(r,t,e){const i=typeof t=="function"?t():t,s=typeof e=="function"?e():e,n=new i.constructor(new Ao(r,i,s));return n.isImplicit=!0,n}function pe(...r){const t=r.map(([a,c])=>typeof c=="function"?[a,c()]:[a,c]),e=t[0][1].constructor,i=t.findIndex(a=>a[0]===!0);if(i===-1)throw new Error("A cond must have a fallthrough case with `true`/; ");const s=t.slice(0,i),n=t[i][1],o=new e(s.reduceRight((a,c)=>R(c[0],c[1],a),n));return o.isImplicit=!0,o}function vt(r,t){return K("*",r,t)}function fe(r,t){return K("/",r,t)}function Wt(r,t){return K("+",r,t)}function me(r,t){return K("-",r,t)}function Hc(r,t){return K(">>",r,t)}function Zc(r,t){return K("&",r,t)}function ri(r,t){return K("==",r,t,H)}function jo(r,t){return K("<",r,t,H)}function er(r,t){return K("<=",r,t,H)}function X(r,t){return K(">",r,t,H)}function rr(r,t){return K(">=",r,t,H)}function Ps(...r){return r.length<=1?r[0]:r.slice(1).reduce((t,e)=>Qo(t,e),r[0])}function Qo(r,t){return K("||",r,t,H)}function Cr(...r){return r.length<=1?r[0]:r.slice(1).reduce((t,e)=>Jo(t,e),r[0])}function Jo(r,t){return K("&&",r,t,H)}function ta(r){return J("abs",r)}function ii(r){return J("all",r,H)}function si(r){return J("any",r,H)}function ea(r){return J("ceil",r)}function ni(r,t,e){return ei("clamp",r,t,e,r.constructor)}function Ts(r){return J("cos",r)}function Is(r,t){return Mt("distance",r,t,f)}function oi(r,t){return Mt("dot",r,t,f)}function ra(r){return J("floor",r)}function ks(r){return J("fract",r)}function Ms(r){return J("length",r,f)}function Vt(r,t){return Mt("max",r,t)}function Fr(r,t){return Mt("min",r,t)}function Nt(r,t,e){return ei("mix",r,t,e)}function Yt(r,t){return Mt("mod",r,t)}function ia(r){return J("normalize",r)}function sa(r){return r.type==="bool"?J("!",r):J("not",r)}function ai(r){return J("sin",r)}function Xc(r,t,e){return ei("smoothstep",r,t,e)}function gt(r,t){return Mt("step",r,t,t.constructor)}function ut(r,t){return Mt("texture2D",r,t,k)}const Xt=5;function L(r,t,e){const i=t.split(`
`);for(const s of i)if(s.trim().length){{let n="";e!=null&&(n+=`/*id:${e??"000"}*/   `),r.body+=n.padEnd(14)}r.body+=" ".repeat(r.indent)+s+`
`}}let Ii=class{write(t){for(const e of t.rootOutputNodes())t.shouldPruneOutputNode(e)||(e.variableName=this._write(t,e.node));return t}_createVarName(t,e){let i="";return typeof e!="boolean"&&typeof e!="number"&&e.debugInfo.name&&(i=`${e.debugInfo.name}_`),`${i}v${t.varCount++}`}_write(t,e,i=!1){if(typeof e=="number"||typeof e=="boolean")return e.toString();let s=t.getEmit(e);if(s)return s;switch(e.shaderType){case"scope-node":s=this._writeScopeNode(t,e);break;case"primitive-node":s=this._writePrimitveNode(t,e,i);break;case"function-node":s=this._writeFunctionNode(t,e);break;case"property-access-node":s=this._writePropertyAccessNode(t,e);break;case"text-node":s=e.text;break;case"block-node":s=this._writeBlockNode(t,e);break;case"condition-node":s=this._writeConditionNode(t,e)}return t.setEmit(e,s),s}_writeScopeNode(t,e){const i=new e.child.constructor;i.setDebugName(e.debugInfo.name);const s=this._write(t,i,!0);return L(t,`{ /*ScopeStart: ${e.uid} ${e.debugInfo.name}*/`),t.indent+=2,L(t,`${s} = ${this._write(t,e.child)};`),t.indent-=2,L(t,`} /*ScopeEnd: ${e.uid} ${e.debugInfo.name}*/`),s}_writeConditionNode(t,e){const i=new e.ifTrue.constructor,s=this._write(t,i,!0);L(t,`if (${this._write(t,e.condition)}) {`),t.indent+=2;const n=t.createSubgraphContext(),o=this._write(n,e.ifTrue);if(t.body+=n.body,o&&L(t,`${s} = ${o};`),t.indent-=2,L(t,"}"),e.ifFalse){L(t,"else {"),t.indent+=2;const a=t.createSubgraphContext(),c=this._write(a,e.ifFalse);t.body+=a.body,c&&L(t,`${s} = ${c};`),t.indent-=2,L(t,"}")}return s}_writeBlockNode(t,e){const{captureList:i,generator:s,returnType:n}=e,o={};for(const l in i){if(!i[l])continue;const h=this._write(t,i[l]);o[l]=h}const a=new n,c=this._write(t,a,!0);if(o.out=c,e.subgraph){const l=t.createSubgraphContext(),h=this._write(l,e.subgraph.child),p=l.body;o.subgraph={varName:h,body:p}}const u=s(o);return L(t,`{
`),t.indent+=2,L(t,u),t.indent-=2,L(t,`}
`),c}_writePropertyAccessNode(t,e){const i=this._write(t,e.target);return typeof e.property=="string"&&e.property.includes("[")?`${i}${e.property}`:typeof e.property!="string"?`${i}[${this._write(t,e.property)}]`:`${i}.${e.property}`}_writeFunctionNode(t,e){const i=e.returnType.type;if(e.isInfix){const[o,a]=e.children.map(u=>this._write(t,u)),c=this._createVarName(t,e);return L(t,`${i.padEnd(Xt)} ${c} = ${o} ${e.token} ${a};`,e.uid),c}const s=e.children.map(o=>this._write(t,o)).join(", "),n=this._createVarName(t,e);return L(t,`${i.padEnd(Xt)} ${n} = ${e.token}(${s});`,e.uid),n}_writePrimitveNode(t,e,i=!1){const s=t.getInput(e);if(s)return s.isUsed=!0,s.variableName;const n=e.children.length===1&&e.children[0]?.type===e.type;if(e.isImplicit||n)return this._write(t,e.children[0]);const o=this._createVarName(t,e);if(i)return L(t,`${e.type.padEnd(Xt)} ${o};`,e.uid),o;const a=!e.debugInfo.name&&!e.isMutable;if(a&&e.type==="float"&&typeof e.children[0]=="number")return Number.isInteger(e.children[0])?e.children[0].toFixed(1):e.children[0].toString();if(a&&e.type==="int"&&typeof e.children[0]=="number"&&Number.isInteger(e.children[0]))return e.children[0].toString();const c=e.children.map(u=>this._write(t,u)).join(", ");return e.type==="array"?(L(t,`${e.type.padEnd(Xt)} ${o} = [${c}];`,e.uid),o):a?`${e.type}(${c})`:(L(t,`${e.type.padEnd(Xt)} ${o} = ${e.type}(${c});`,e.uid),o)}},zt=class Ns{constructor(t,e,i){this.variableName=t,this.variableInputType=e,this.node=i,this.type="shader-input",this.isUsed=!1}clone(){return new Ns(this.variableName,this.variableInputType,x(this.node))}},qt=class Es{constructor(t,e,i){this.outVariableName=t,this.outVariableType=e,this.node=i,this.type="shader-output"}clone(){const t=new Es(this.outVariableName,this.outVariableType,x(this.node));return t.variableName=this.variableName,t}},ki=class Re{static createVertex(t,e,i,s,n,o){const a=[];for(const u in t){const l=t[u],h=i.get(u);h?a.push(new zt(h,"builtin",l)):a.push(new zt("a_"+u,"attribute",l))}for(const u of s){const l=u.uniformHydrated;a.push(new zt(u.uniformName,"uniform",l))}const c=[];for(const u in e){const l=e[u];u==="glPosition"?c.push(new qt("gl_Position","builtin",l)):u==="glPointSize"?c.push(new qt("gl_PointSize","builtin",l)):c.push(new qt("v_"+u,"varying",l))}return new Re(a,c,n,o)}static createFragment(t,e,i,s,n,o){const a=[],c=Array.from(n.rootOutputNodes());for(const l in t){const h=t[l],p=i.get(l);if(p){a.push(new zt(p,"builtin",h));continue}const m=c.find(y=>y.node===h);m&&a.push(new zt(m.outVariableName,m.outVariableType,h))}for(const l of s){const h=l.uniformHydrated;a.push(new zt(l.uniformName,"uniform",h))}const u=[];for(const l in e){const h=e[l],p=i.get(l);if(l==="discard")u.push(new qt(null,"discard",h));else{if(!p)throw new Error(`Member ${l} in shader fragment output shoule be tagged as builtin`);u.push(new qt(p,"builtin",h))}}return new Re(a,u,o)}constructor(t,e,i,s){this.type="shader-graph-context",this.indent=0,this.body="",this.varCount=0,this._inputShaderTypesByNodeUid=new Map,this._nodeEmitMap=new Map;for(const n of t)this._inputShaderTypesByNodeUid.set(n.node.uid,n);this._outputShaderTypes=e,this._transformFeedbackBindings=i,this._transformFeedbackNames=new Set(i.map(n=>"v_"+n.propertyKey)),this._usedInFragmentShader=s}shouldPruneOutputNode(t){return!!this._usedInFragmentShader&&t.outVariableType!=="builtin"&&!this._transformFeedbackNames.has(t.outVariableName)&&!this._usedInFragmentShader.has(t.node.uid)}setEmit(t,e){this._nodeEmitMap.set(t.uid,e)}getEmit(t){return this._nodeEmitMap.get(t.uid)}inputs(){return this._inputShaderTypesByNodeUid.values()}getInput(t){return this._inputShaderTypesByNodeUid.get(t.uid)}*rootOutputNodes(){for(const t of this._outputShaderTypes)yield t}*nodes(){const t=[];for(const e of this._outputShaderTypes.values())t.push(e.node);for(;t.length;){const e=t.pop();typeof e!="number"&&typeof e!="boolean"&&t.push(...e.children.filter(Boolean)),yield e}}*nodesOfTypeOrFunction(){for(const t of this.nodes())typeof t!="number"&&typeof t!="boolean"&&(yield t)}createSubgraphContext(){const t=this.clone();return t.body="",t.indent=this.indent+2,t._nodeEmitMap=new Map(this._nodeEmitMap),t}clone(){const t=new Re([],this._outputShaderTypes,this._transformFeedbackBindings,this._usedInFragmentShader);return t._inputShaderTypesByNodeUid=this._inputShaderTypesByNodeUid,t.indent=this.indent,t.body=this.body,t.varCount=this.varCount,t._nodeEmitMap=this._nodeEmitMap,t}insertVertexShader(t){t.vertex.code.add(""),this._insertInputs(t,"vertex"),t.vertex.code.add(""),t.vertex.code.add("// OUTPUTS: "),t.vertex.code.add("// --------------------------------------------------------- ");for(const e of this.rootOutputNodes()){const i=e.outVariableType==="builtin";this.shouldPruneOutputNode(e)||(i?t.vertex.code.add(`// ${e.outVariableType.padEnd(7)} ${e.node.type.padEnd(9)} ${e.outVariableName};`):t.vertex.code.add(`${e.outVariableType.padEnd(10)} ${e.node.type.padEnd(9)} ${e.outVariableName};`))}t.vertex.code.add(""),t.vertex.code.add("void main() {"),t.vertex.code.add("  "+this.body.split(`
`).join(`
  `));for(const e of this.rootOutputNodes())this.shouldPruneOutputNode(e)||t.vertex.code.add(`  ${e.outVariableName} = ${e.variableName};`);t.vertex.code.add("}")}insertFragmentShader(t){this._insertInputs(t,"fragment"),t.fragment.code.add(""),t.fragment.code.add("void main() {"),t.fragment.code.add("  "+this.body.split(`
`).join(`
  `));for(const e of this.rootOutputNodes())e.outVariableType==="discard"?(t.fragment.code.add("  // TODO: Should ensure codegen for discard appears first in fragment shader"),t.fragment.code.add(`  if (${e.variableName}) {`),t.fragment.code.add("    discard;"),t.fragment.code.add("  }"),t.fragment.code.add("  ")):t.fragment.code.add(`  ${e.outVariableName} = ${e.variableName};`);t.fragment.code.add("}")}_insertInputs(t,e){t[e].code.add("// INPUTS: "),t[e].code.add("// --------------------------------------------------------- ");for(const i of this.inputs())i.isUsed&&i.variableInputType!=="builtin"&&(i.node.type==="array"?t[e].code.add(`${i.variableInputType.padEnd(10)} ${i.node.elementType.type.padEnd(9)} ${i.variableName}[${i.node.size}];`):t[e].code.add(`${i.variableInputType.padEnd(10)} ${i.node.type.padEnd(9)} ${i.variableName};`))}};const na=()=>je.getLogger("esri.views.2d.engine.webgl.shaderGraph.typed.TypedShaderProgram");function Kt(r,t,e){const i=t.length;if(i!==e){const s=new Wr("Invalid Uniform",`Invalid length, expected ${e} but got ${i}`,{uniformName:r,values:t});na().errorOnce(s)}}let Mi=class{constructor(t,e,i,s,n,o){this._program=null,this._vao=null,this._temporaryTextures=[],this.vertexShader=t,this.fragmentShader=e,this._locations=i,this._locationInfo=s,this._uniformBindings=n,this._transformFeedbackBindings=o}destroy(){this._program&&this._program.dispose(),this.cleanupTemporaryTextures()}get locations(){return this._locations}get locationInfo(){return this._locationInfo}setUniforms(t){this._uniforms=t}cleanupTemporaryTextures(){for(const t of this._temporaryTextures)t.dispose();this._temporaryTextures=[]}bind(t){const e=this._uniforms;if(!this._program){const s=new Map;for(const[o,a]of this._locations)s.set(o,a);const n=[];for(const o of this._transformFeedbackBindings??[]){const{index:a,propertyKey:c}=o;n[a]=`v_${c}`}this._program=new sn(t,this.vertexShader,this.fragmentShader,s,new Map,n)}const i=this._program;t.useProgram(i);for(const s of this._uniformBindings){const{shaderModulePath:n,uniformName:o,uniformType:a,uniformArrayLength:c}=s,u=nn(n,e);if(u==null){if(a==="sampler2D")continue;throw new Error(`Failed to find uniform value for ${n}`)}switch(a==="array"?s.uniformArrayElementType:a){case"sampler2D":{const{unit:l,texture:h}=u;if(i.setUniform1i(o,l),"type"in h)t.bindTexture(h,l);else{const p=on(t,h.descriptor,h.data);t.bindTexture(p,l)}break}case"int":if(!c){i.setUniform1i(o,u);break}Kt(s.uniformName,u,c),i.setUniform1iv(o,u);break;case"float":if(!c){i.setUniform1f(o,u);break}Kt(s.uniformName,u,c),i.setUniform1fv(o,u);break;case"vec2":if(!c){i.setUniform2f(o,u[0],u[1]);break}Kt(s.uniformName,u,c),i.setUniform2fv(o,u.flat());break;case"vec3":if(!c){i.setUniform3f(o,u[0],u[1],u[2]);break}Kt(s.uniformName,u,c),i.setUniform3fv(o,u.flat());break;case"vec4":if(!c){i.setUniform4f(o,u[0],u[1],u[2],u[3]);break}Kt(s.uniformName,u,c),i.setUniform4fv(o,u.flat());break;case"mat3":i.setUniformMatrix3fv(o,u.flat());break;case"mat4":i.setUniformMatrix4fv(o,u.flat());break;default:throw new Error(`Unable to set uniform for type ${a}`)}}}};function jt(r){return new r}function Ht(r,t,e){const i=r.constructor[t]??[];r.constructor.hasOwnProperty(t)||Object.defineProperty(r.constructor,t,{value:i.slice()}),r.constructor[t].push(e)}function P(r,t){return(e,i)=>{Ht(e,"locations",{typeCtor:t,propertyKey:i,parameterIndex:null,index:r})}}const oa=r=>(t,e)=>{Ht(t,"builtins",{builtin:r,propertyKey:e})},F=r=>(t,e,i)=>{Ht(t,"inputs",{inputCtor:r,propertyKey:e,parameterIndex:i})},_=r=>(t,e)=>{Ht(t,"uniforms",{typeCtor:r,propertyKey:e})},U=r=>(t,e)=>{Ht(t,"options",{typeCtor:r,propertyKey:e})},Ni=(r,t)=>{Ht(r,"defines",{propertyKey:t})},Br=(r,t)=>(e,i)=>{e.constructor.builtins.push({builtin:r,propertyKey:i,typeCtor:t})};let Or=class{};Or.builtins=[],d([Br("gl_VertexID",xt)],Or.prototype,"glVertexID",void 0);let aa=class{},ie=class{};ie.builtins=[],d([Br("gl_FragCoord",k)],ie.prototype,"glFragCoord",void 0),d([Br("gl_PointCoord",T)],ie.prototype,"glPointCoord",void 0);let zs=class{};d([oa("gl_FragColor")],zs.prototype,"glFragColor",void 0);let j=class{constructor(){this.type="uniform-group"}get _uniforms(){return this.constructor.uniforms??[]}},ca=class{constructor(){this.logShader=!1,this.computeAttributes={}}get vertexInput(){const t=ur(this._shaderModuleClass.inputs,e=>e.propertyKey==="vertex"&&e.parameterIndex===0);if(!t)throw new Error("Unable to find vertex input parameter");return t}get computeInput(){return ur(this._shaderModuleClass.inputs,t=>t.propertyKey==="vertex"&&t.parameterIndex===1)}get fragmentInput(){const t=ur(this._shaderModuleClass.inputs,e=>e.propertyKey==="fragment");if(!t)throw new Error("Unable to find fragment input parameter");return t}get transformFeedbackBindings(){return this.fragmentInput.inputCtor.transformFeedbackBindings??[]}get locations(){return[...this.vertexInput.inputCtor.locations,...this.computeInput?.inputCtor.locations??[]]}get locationsMap(){const t=new Map,e=new Set;for(const i of this.locations)e.has(i.index)?je.getLogger("esri.views.2d.engine.webgl.shaderGraph.GraphShaderModule").warnOnce("mapview-rendering",`Unable to assigned attribute ${i.propertyKey} to ${i.index}. Index already in use`,{locationsMap:t}):(t.set(i.propertyKey,i.index),e.add(i.index));return t}get locationInfo(){if(!this._locationInfo){const t=this.locationsMap,e=Array.from(t.entries()).map(([s,n])=>`${s}.${n}`).join("."),i=an(e);this._locationInfo={hash:i,locations:t}}return this._locationInfo}get renamedLocationsMap(){const t=new Map;for(const e of this.locations)t.set("a_"+e.propertyKey,e.index);return t}get optionPropertyKeys(){if(!this._optionPropertyKeys){const t=new Set;for(const e of this._options)t.add(e.propertyKey);this._optionPropertyKeys=t}return this._optionPropertyKeys}get _shaderModuleClass(){return this.constructor}get _defines(){return this._shaderModuleClass.defines??[]}get _options(){return this._shaderModuleClass.options??[]}get _uniforms(){return this._shaderModuleClass.uniforms??[]}getProgram(t,e,i,s){try{const{vertex:n,fragment:o,uniformBindings:a}=this._generateShaders(t,e,i,s);return new Mi(n,o,this.renamedLocationsMap,this.locationInfo,a,this.transformFeedbackBindings)}catch(n){return console.error("Failed to create program",{error:n}),new Mi("","",this.renamedLocationsMap,this.locationInfo,[],this.transformFeedbackBindings)}}getDebugUniformClassInfo(t){const e=this._options.find(s=>s.propertyKey===t);if(e)return{type:"option",className:e.typeCtor};const i=this._uniforms.find(s=>s.propertyKey===t);if(!i)throw new Error(`Unable to find uniform class type for property: ${t}`);return{type:"required",className:i.typeCtor}}getShaderKey(t,e,i,s){const n=Object.keys(i).map(c=>`${c}.${i[c]}`).join("."),o=Object.keys(s).map(c=>`${c}.${s[c]}`).join("."),a=Object.keys(e).filter(c=>this.optionPropertyKeys.has(c)&&e[c]).join(".");return`${this.constructor.name}.${t.hash}.${n}.${o}.${a}`}_generateShaders(t,e,i,s){const n=[];this._setDefines(i),this._setOptionalUniforms(n,e),this._setRequiredUniforms(n);const o=this._hydrateVertexInput(s),a=this._injectPackPrecisionFactor(o,t),c=this._hydrateComputeInput(),u=c&&this._injectPackPrecisionFactor(c,t),l=this.vertex(a,u),h=this._hydrateFragmentInput(l),p=this.fragment(h),m=new Set;for(const I in p){const E=p[I];Oo(m,E)}const y=this._getVertexInputBuiltins(),b=ki.createVertex({...o,...c},l,y,n,this.transformFeedbackBindings,m);new Ii().write(b);const v=this._getFragmentInputBuiltins(p);v.set("glPointCoord","gl_PointCoord");const w=ki.createFragment(h,p,v,n,b,this.transformFeedbackBindings);new Ii().write(w);const $=this._createShaderBuilder(b,w),M=$.generate("vertex",!1),N=$.generate("fragment",!1);return this.logShader&&(console.log(M),console.log(N)),{vertex:M,fragment:N,uniformBindings:n}}_setDefines(t){for(const e in t)this[e]=t[e]}_setOptionalUniforms(t,e){for(const i of this._options)e[i.propertyKey]?this[i.propertyKey]=this._hydrateUniformGroup(t,i):this[i.propertyKey]=null}_setRequiredUniforms(t){for(const e of this._uniforms)this[e.propertyKey]=this._hydrateUniformGroup(t,e)}_hydrateUniformGroup(t,e){const i=new e.typeCtor;for(const s of i._uniforms??[]){const n=jt(s.typeCtor),o=`u_${e.propertyKey}_${s.propertyKey}`,a=n.type,c=[e.propertyKey,s.propertyKey].join(".");if("type"in s.typeCtor&&s.typeCtor.type==="array"){const u=n;t.push({shaderModulePath:c,uniformName:o,uniformType:a,uniformArrayLength:u.size,uniformArrayElementType:u.elementType.type,uniformHydrated:n})}else t.push({shaderModulePath:c,uniformName:o,uniformType:a,uniformHydrated:n});i[s.propertyKey]=n}return i}_hydrateVertexInput(t){const e=this.vertexInput.inputCtor,i=e.locations.reduce((s,n)=>t[n.propertyKey]===!1?s:{...s,[n.propertyKey]:jt(n.typeCtor)},{});for(const{propertyKey:s,typeCtor:n}of e.builtins){const o=jt(n);i[s]=o}return i}_hydrateComputeInput(){return this.computeInput==null?null:this.computeInput.inputCtor.locations.reduce((t,e)=>({...t,[e.propertyKey]:jt(e.typeCtor)}),{})}_injectPackPrecisionFactor(t,e){const i={};for(const s in t){const n=t[s],o=e.attributes.find(a=>a.name===s);if(o?.packPrecisionFactor){if(n.type!=="float"&&n.type!=="vec2"&&n.type!=="vec3"&&n.type!=="vec4")throw new Error(`InternalError: packPrecisionFactor requires GenType, but found ${n.type}`);i[s]=n.divide(new f(o.packPrecisionFactor))}else i[s]=n}return i}_hydrateFragmentInput(t){const e={};for(const i in t)e[i]=t[i];for(const{propertyKey:i,typeCtor:s}of ie.builtins){const n=jt(s);e[i]=n}return e}_getVertexInputBuiltins(){const t=this.vertexInput.inputCtor,e=new Map;for(const{builtin:i,propertyKey:s}of t.builtins)e.set(s,i);return e}_getFragmentInputBuiltins(t){const e=t.constructor,i=new Map;for(const s of e.builtins??[])i.set(s.propertyKey,s.builtin);return i}_createShaderBuilder(t,e){const i=new Mo;return this._insertDebugInfo(i),t.insertVertexShader(i),e.insertFragmentShader(i),i}_insertDebugInfo(t){t.vertex.code.add("// DEFINES: "),t.vertex.code.add("// --------------------------------------------------------- ");for(const e of this._defines)this[e.propertyKey]?t.vertex.code.add(`//   ${e.propertyKey}: true`):t.vertex.code.add(`//   ${e.propertyKey}: false`);t.vertex.code.add(""),t.vertex.code.add("// OPTIONS: "),t.vertex.code.add("// --------------------------------------------------------- ");for(const e of this._options)this[e.propertyKey]?t.vertex.code.add(`//   ${e.propertyKey}: true`):t.vertex.code.add(`//   ${e.propertyKey}: false`)}};function Ei(r){const t=D(12.9898),e=D(78.233),i=D(43758.5453),s=oi(r,Dr(t,e)),n=Yt(s,D(3.14));return ks(ai(n).multiply(i))}function It(r){return ri(r,D(vo))}function ua(r,t){return r.x.multiply(t.y).subtract(t.x.multiply(r.y))}function la(r){return r.multiply(2).subtract(1)}function it(r,t){const e=D(2**t);return Yt(ra(r.divide(e)),D(2))}function iu(r,t){return X(it(r,t),D(.5))}function hr(r,t){return it(r,t+Li.length)}function ha(r,t){return it(r,t)}function da(r){const t=it(r.z,7),e=D(1).subtract(t),i=r.xyz.subtract(Zo(0,0,D(128)));return e.multiply(r).add(t.multiply(i))}function pa(r){const t=Xo(.99609375,.0038909912109375,1519918441772461e-20,59371814131736755e-24);return oi(r,t)}function su(r){return Vt(Vt(Vt(r.x,r.y),r.z),r.w)}let ot=class extends j{getVisualVariableData(t){if(!this._vvData){const e=this.getAttributeDataCoords(t);this._vvData=ut(this.visualVariableData,e).setDebugName("storage2")}return this._vvData}getAttributeDataCoords(t){if(!this._uv){const e=da(t),i=this.size,s=Et(e.x),n=Et(e.y).multiply(Et(256)),o=Et(e.z).multiply(Et(256)).multiply(Et(256)),a=D(s.add(n).add(o)),c=Yt(a,i),u=a.subtract(c).divide(i);this._uv=new T(c,u).add(.5).divide(i)}return this._uv}getFilterData(t){const e=this.getAttributeDataCoords(t);return ut(this.filterFlags,e).setDebugName("storage0")}getAnimationData(t){const e=this.getAttributeDataCoords(t);return ut(this.animation,e).setDebugName("storage1")}getVVData(t){return this.getVisualVariableData(t)}getDataDrivenData0(t){const e=this.getAttributeDataCoords(t);return ut(this.dataDriven0,e).setDebugName("storage30")}getDataDrivenData1(t){const e=this.getAttributeDataCoords(t);return ut(this.dataDriven1,e).setDebugName("storage31")}getDataDrivenData2(t){const e=this.getAttributeDataCoords(t);return ut(this.dataDriven2,e).setDebugName("storage32")}getGPGPUData(t){const e=this.getAttributeDataCoords(t);return ut(this.gpgpu,e).setDebugName("storage4")}getFilterFlags(t){return Ur("webgl-ignores-sampler-precision")?ea(this.getFilterData(t).x.multiply(D(255))):this.getFilterData(t).x.multiply(D(255))}getAnimationValue(t){return this.getAnimationData(t).x}getSizeValue(t){return this.getVisualVariableData(t).x}getColorValue(t){return this.getVisualVariableData(t).y}getOpacityValue(t){return this.getVisualVariableData(t).z}getRotationValue(t){return this.getVisualVariableData(t).w}};d([_(ct)],ot.prototype,"filterFlags",void 0),d([_(ct)],ot.prototype,"animation",void 0),d([_(ct)],ot.prototype,"gpgpu",void 0),d([_(ct)],ot.prototype,"visualVariableData",void 0),d([_(ct)],ot.prototype,"dataDriven0",void 0),d([_(ct)],ot.prototype,"dataDriven1",void 0),d([_(ct)],ot.prototype,"dataDriven2",void 0),d([_(f)],ot.prototype,"size",void 0);let Vr=class extends j{};d([_(f)],Vr.prototype,"activeReasons",void 0),d([_(f)],Vr.prototype,"highlightAll",void 0);let ee=class extends j{};d([_(T)],ee.prototype,"position",void 0),d([_(f)],ee.prototype,"distance",void 0),d([_(f)],ee.prototype,"smallSymbolDistance",void 0),d([_(f)],ee.prototype,"smallSymbolSizeThreshold",void 0);let W=class extends j{};d([_(Y)],W.prototype,"displayViewScreenMat3",void 0),d([_(Y)],W.prototype,"displayViewMat3",void 0),d([_(Y)],W.prototype,"displayMat3",void 0),d([_(Y)],W.prototype,"viewMat3",void 0),d([_(Y)],W.prototype,"tileMat3",void 0),d([_(f)],W.prototype,"displayZoomFactor",void 0),d([_(f)],W.prototype,"requiredZoomFactor",void 0),d([_(T)],W.prototype,"tileOffset",void 0),d([_(f)],W.prototype,"currentScale",void 0),d([_(f)],W.prototype,"currentZoom",void 0),d([_(f)],W.prototype,"metersPerSRUnit",void 0),d([_(f)],W.prototype,"rotation",void 0),d([_(f)],W.prototype,"pixelRatio",void 0);let Tt=class extends Or{};d([P(0,V)],Tt.prototype,"id",void 0),d([P(1,f)],Tt.prototype,"bitset",void 0),d([P(2,T)],Tt.prototype,"pos",void 0);let pt=class extends aa{};d([P(14,T)],pt.prototype,"nextPos1",void 0),d([P(15,T)],pt.prototype,"nextPos2",void 0);let ir=class extends ie{},ht=class extends ca{clip(t,e){let i=new f(0);const s=this.storage.getFilterFlags(t);if(i=i.add(D(2).multiply(D(1).subtract(hr(s,0)))),this.inside?i=i.add(D(2).multiply(D(1).subtract(hr(s,1)))):this.outside?i=i.add(D(2).multiply(hr(s,1))):this.highlight&&(i=i.add(D(2).multiply(D(1).subtract(this._checkHighlight(s))))),e!=null){const n=new f(1).subtract(gt(e.x,this.view.currentZoom)),o=gt(e.y,this.view.currentZoom);i=i.add(new f(2).multiply(n.add(o)))}return i}getFragmentOutput(t,e,i=new f(1/255)){const s=new zs;return s.glFragColor=this._maybeWriteHittest(e)??this._maybeHighlight(t,i)??t,s}_maybeHighlight(t,e){return this.highlight?new k(t.rgb,gt(e,t.a)):null}_checkHighlight(t){let e=this._checkHighlightBit(t,0);for(let i=1;i<Li.length;i++)e=e.add(this._checkHighlightBit(t,i));return gt(new f(.1),e.add(this.highlight.highlightAll))}_checkHighlightBit(t,e){return ha(t,e).multiply(it(this.highlight.activeReasons,e))}maybeRunHittest(t,e,i){if(this.hittestRequest==null)return null;const s=this.hittest(t,e,i);let n=R(X(s,this.hittestRequest.distance),new f(2),new f(0));const o=this.storage.getAttributeDataCoords(t.id),a=la(o);n=n.add(this.clip(t.id,t.zoomRange));const c=new k(new f(1/255),0,0,0);return{glPointSize:new f(1),glPosition:new k(a,n,1),color:c}}_maybeWriteHittest(t){return this.hittestRequest!=null?t.color:null}};d([Ni],ht.prototype,"inside",void 0),d([Ni],ht.prototype,"outside",void 0),d([U(Vr)],ht.prototype,"highlight",void 0),d([_(ot)],ht.prototype,"storage",void 0),d([_(W)],ht.prototype,"view",void 0),d([U(ee)],ht.prototype,"hittestRequest",void 0);function fa(r,t){return oi(r,ia(t))}function se(r,t,e){const i=e.subtract(t),s=fa(r.subtract(t),i),n=ni(s.divide(Ms(i)),new f(0),new f(1));return Is(r,t.add(n.multiply(e.subtract(t))))}function ma(r){const t=ta(r);return gt(t.x.add(t.y).add(t.z),new f(1.05))}function ya(r,t,e,i){const s=new Y(e.x.multiply(i.y).subtract(i.x.multiply(e.y)),i.x.multiply(t.y).subtract(t.x.multiply(i.y)),t.x.multiply(e.y).subtract(e.x.multiply(t.y)),e.y.subtract(i.y),i.y.subtract(t.y),t.y.subtract(e.y),i.x.subtract(e.x),t.x.subtract(i.x),e.x.subtract(t.x)),n=t.x.multiply(e.y.subtract(i.y)),o=e.x.multiply(i.y.subtract(t.y)),a=i.x.multiply(t.y.subtract(e.y)),c=n.add(o).add(a);return new f(1).divide(c).multiply(s.multiply(new V(1,r)))}function ga(r,t,e,i){return ri(ma(ya(r,t,e,i)),new f(1))}function xa(r,t,e,i){const s=e.subtract(t),n=i.subtract(t),o=ua(s,n),a=Cr(jo(o,new f($i)),X(o,new f(-$i)));return pe([Cr(sa(a),ga(r.xy,t,e,i)),new f(-1)],[!0,()=>{const c=se(r,t,e),u=se(r,e,i),l=se(r,i,t);return Fr(Fr(c,u),l)}])}function Ds(r){return r.distance.add(1)}function ci(r,t,e){const{viewMat3:i,tileMat3:s}=r.view,n=i.multiply(s),o=n.multiply(new V(t.pos,1)),a=n.multiply(new V(e.nextPos1,1)),c=n.multiply(new V(e.nextPos2,1));return xa(r.hittestRequest.position,o.xy,a.xy,c.xy)}function pu(r,t,e){return Is(r,e).subtract(t)}let ue=class extends j{getColor(t,e,i){return pe([Ps(It(t),i),e],[er(t,this.values.first()),this.colors.first()],[rr(t,this.values.last()),this.colors.last()],[!0,()=>{const s=this.values.findIndex(u=>X(u,t)),n=this.values.get(s),o=s.subtract(1),a=this.values.get(o),c=t.subtract(a).divide(n.subtract(a));return Nt(this.colors.get(o),this.colors.get(s),c)}])}};d([_(rt.ofType(k,8))],ue.prototype,"colors",void 0),d([_(rt.ofType(f,8))],ue.prototype,"values",void 0);let le=class extends j{getOpacity(t){return pe([It(t),new f(1)],[er(t,this.opacityValues.first()),this.opacities.first()],[rr(t,this.opacityValues.last()),this.opacities.last()],[!0,()=>{const e=this.opacityValues.findIndex(a=>X(a,t)),i=this.opacityValues.get(e),s=e.subtract(1),n=this.opacityValues.get(s),o=t.subtract(n).divide(i.subtract(n));return Nt(this.opacities.get(s),this.opacities.get(e),o)}])}};d([_(rt.ofType(f,8))],le.prototype,"opacities",void 0),d([_(rt.ofType(f,8))],le.prototype,"opacityValues",void 0);function Cs(r){return r.visualVariableSizeMinMaxValue!=null||r.visualVariableSizeScaleStops!=null||r.visualVariableSizeStops!=null||r.visualVariableSizeUnitValue!=null}function ba(r,t,e){if(Cs(r)){const i=r.storage.getSizeValue(t);return r.visualVariableSizeMinMaxValue?.getSize(i,e)??r.visualVariableSizeScaleStops?.getSizeForViewScale(r.view.currentScale)??r.visualVariableSizeStops?.getSize(i,e)??r.visualVariableSizeUnitValue?.getSize(i,e)}return e}function ui(r,t,e,i=new H(!1)){if(r.visualVariableColor==null)return e;const s=r.storage.getColorValue(t);return r.visualVariableColor.getColor(s,e,i)}function li(r,t){if(r.visualVariableOpacity==null)return new f(1);const e=r.storage.getOpacityValue(t);return r.visualVariableOpacity.getOpacity(e)}function yu(r,t){if(r.visualVariableRotation==null)return Y.identity();const e=r.storage.getRotationValue(t);return r.visualVariableRotation.getVVRotationMat3(e)}let he=class extends Tt{};d([P(3,k)],he.prototype,"color",void 0),d([P(4,T)],he.prototype,"zoomRange",void 0);let Ot=class extends ht{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(t,e){const i=li(this,t.id),s=ui(this,t.id,t.color).multiply(i),n=this.view.displayViewScreenMat3.multiply(new V(t.pos.xy,1)),o=this.clip(t.id,t.zoomRange);return{glPosition:new k(n.xy,o,1),color:s,...this.maybeRunHittest(t,e,null)}}fragment(t){return this.getFragmentOutput(t.color,t,new f(0))}hittest(t,e){return ci(this,t,e)}};d([U(ue)],Ot.prototype,"visualVariableColor",void 0),d([U(le)],Ot.prototype,"visualVariableOpacity",void 0),d([C(0,F(he)),C(1,F(pt))],Ot.prototype,"vertex",null),d([C(0,F(ir))],Ot.prototype,"fragment",null);let At=class extends j{getPatternOffsetAtTileOrigin(t,e=new f(0),i=new f(1)){const s=new T(Po).divide(t);let n=t.multiply(ks(this.maxIntsToLocalOrigin.multiply(s))).add(this.tileOffsetFromLocalOrigin).subtract(new f(.5).multiply(t));return n=new T(n.x.multiply(i).subtract(n.y.multiply(e)),n.x.multiply(e).add(n.y.multiply(i))),Yt(n,t)}};d([_(T)],At.prototype,"tileOffsetFromLocalOrigin",void 0),d([_(T)],At.prototype,"maxIntsToLocalOrigin",void 0);let Lt=class extends j{};d([_(T)],Lt.prototype,"size",void 0),d([_(ct)],Lt.prototype,"texture",void 0);let wt=class extends he{};d([P(5,k)],wt.prototype,"tlbr",void 0),d([P(6,f)],wt.prototype,"width",void 0),d([P(7,f)],wt.prototype,"height",void 0),d([P(8,T)],wt.prototype,"offset",void 0),d([P(9,T)],wt.prototype,"scale",void 0),d([P(10,f)],wt.prototype,"angle",void 0);class va extends ir{}function _a(r,t,e,i,s){const n=ri(it(s,ns),D(1)),o=pa(new k(r,0));return R(n,Ti(i.divide(t.x),e.divide(t.y),0,We(e.divide(t.x)),i.divide(t.y),0,Ei(Dr(o,0)),Ei(Dr(0,o)),1),Ti(i.divide(t.x),e.divide(t.y),0,We(e.divide(t.x)),i.divide(t.y),0,0,0,1))}function Fs(r,t){const e=Nt(new T(1),new T(1/Yr),new T(it(t.bitset,as),it(t.bitset,os))),i=r.view.requiredZoomFactor,s=new T(t.width,t.height).multiply(e),n=s.multiply(t.scale).multiply(i),o=t.angle.multiply(yo),a=ai(o),c=Ts(o),u=_a(t.id,n,a,c,t.bitset),l=r.localTileOffset.getPatternOffsetAtTileOrigin(s,a,c),h=i.multiply(t.scale).multiply(t.offset.subtract(l)).divide(n),p=new V(t.pos,1),m=u.multiply(p).xy.subtract(h),y=t.tlbr.divide(r.mosaicInfo.size.xyxy);let b=it(t.bitset,Xr);return r.visualVariableColor!=null&&(b=R(It(r.storage.getColorValue(t.id)),new f(0),b)),{tileTextureCoord:m,tlbr:y,sampleAlphaOnly:b}}function Bs(r,t){const e=Yt(t.tileTextureCoord,new f(1)),i=Nt(t.tlbr.xy,t.tlbr.zw,e);let s=ut(r.mosaicInfo.texture,i);return s=R(X(t.sampleAlphaOnly,new f(.5)),s.aaaa,s),t.color.multiply(s)}let _e=class extends Ot{vertex(t,e){return{...super.vertex(t,e),...Fs(this,t)}}fragment(t){const e=Bs(this,t);return this.getFragmentOutput(e,t,new f(0))}};d([_(Lt)],_e.prototype,"mosaicInfo",void 0),d([_(At)],_e.prototype,"localTileOffset",void 0),d([C(0,F(wt)),C(1,F(pt))],_e.prototype,"vertex",null),d([C(0,F(va))],_e.prototype,"fragment",null);let hi=class extends j{getSize(t,e){const i=this.minMaxValueAndSize.xy,s=this.minMaxValueAndSize.zw;return R(It(t),e,()=>{const n=t.subtract(i.x).divide(i.y.subtract(i.x)),o=ni(n,new f(0),new f(1));return s.x.add(o.multiply(s.y.subtract(s.x)))})}};d([_(k)],hi.prototype,"minMaxValueAndSize",void 0);let Ye=class extends j{getSizeForViewScale(t){return pe([er(t,this.values.first()),this.sizes.first()],[rr(t,this.values.last()),this.sizes.last()],[!0,()=>{const e=this.values.findIndex(a=>X(a,t)),i=this.values.get(e),s=e.subtract(1),n=this.values.get(s),o=t.subtract(n).divide(i.subtract(n));return Nt(this.sizes.get(s),this.sizes.get(e),o)}])}};d([_(rt.ofType(f,8))],Ye.prototype,"sizes",void 0),d([_(rt.ofType(f,8))],Ye.prototype,"values",void 0);let He=class extends j{getSize(t,e){const i=pe([It(t),e],[er(t,this.values.first()),this.sizes.first()],[rr(t,this.values.last()),this.sizes.last()],[!0,()=>{const s=this.values.findIndex(u=>X(u,t)),n=this.values.get(s),o=s.subtract(1),a=this.values.get(o),c=t.subtract(a).divide(n.subtract(a));return Nt(this.sizes.get(o),this.sizes.get(s),c)}]);return R(It(i),e,i)}};d([_(rt.ofType(f,8))],He.prototype,"sizes",void 0),d([_(rt.ofType(f,8))],He.prototype,"values",void 0);let di=class extends j{getSize(t,e){return R(It(t),e,t.multiply(this.unitValueToPixelsRatio))}};d([_(f)],di.prototype,"unitValueToPixelsRatio",void 0);class $t extends Tt{}d([P(3,k)],$t.prototype,"color",void 0),d([P(4,T)],$t.prototype,"offset",void 0),d([P(5,T)],$t.prototype,"normal",void 0),d([P(6,f)],$t.prototype,"halfWidth",void 0),d([P(7,f)],$t.prototype,"referenceHalfWidth",void 0),d([P(8,T)],$t.prototype,"zoomRange",void 0);let Os=class extends ir{},Ze=class extends j{};function Vs(r){return Vt(new f(go).multiply(gt(r,new f(xo))),new f(1))}function wa(r,t){const{halfWidth:e,normal:i}=r,s=Vs(e),n=Ms(i).multiply(e);return ni(s.multiply(e.subtract(n)).divide(t.add(s).subtract(new f(1))),new f(0),new f(1))}function $a(r,t){const{id:e,halfWidth:i,referenceHalfWidth:s}=t;if(Cs(r)){const n=new f(2).multiply(s),o=ba(r,e,n);return new f(.5).multiply(i.divide(Vt(s,new f(bo)))).multiply(o)}return i}function Rs(r,t){const{id:e,offset:i,pos:s,normal:n,zoomRange:o}=t,{displayViewScreenMat3:a,displayViewMat3:c}=r.view,u=ui(r,e,t.color),l=li(r,e),h=$a(r,t),p=new f(.5).multiply(r.antialiasingControls.antialiasing),m=Vt(h.add(p),new f(.45)).add(new f(.1).multiply(p)),y=Vs(m).multiply(m).multiply(i),b=c.multiply(new V(y,new f(0))),v=a.multiply(new V(s,new f(1))).add(b),w=new f(2).multiply(gt(h,new f(0))).add(r.clip(e,o)),$=new k(v.xy,w,1);return{color:u,opacity:l,halfWidth:m,normal:n,scaledOffset:y,scaledHalfWidth:h,glPosition:new k($.xy,w,1)}}function sr(r,t){const{opacity:e,color:i}=r,s=wa(r,t);return e.multiply(i).multiply(s)}d([_(f)],Ze.prototype,"antialiasing",void 0),d([_(f)],Ze.prototype,"blur",void 0);let nt=class extends ht{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(t,e){const i=Rs(this,t);return{...i,...this.maybeRunHittest(t,e,i.halfWidth)}}fragment(t){const e=sr(t,this.antialiasingControls.blur);return this.getFragmentOutput(e,t)}hittest(t,e,i){const{viewMat3:s,tileMat3:n}=this.view,o=s.multiply(n),a=o.multiply(new V(t.pos,1)),c=o.multiply(new V(e.nextPos1,1)),u=o.multiply(new V(e.nextPos2,1)),{distance:l,smallSymbolDistance:h,smallSymbolSizeThreshold:p}=this.hittestRequest,m=gt(i,p.multiply(.5)).multiply(l.subtract(h)),y=this.hittestRequest.position;return Fr(se(y,a.xy,c.xy),se(y,a.xy,u.xy)).subtract(i).add(m)}};d([_(Ze)],nt.prototype,"antialiasingControls",void 0),d([U(ue)],nt.prototype,"visualVariableColor",void 0),d([U(le)],nt.prototype,"visualVariableOpacity",void 0),d([U(hi)],nt.prototype,"visualVariableSizeMinMaxValue",void 0),d([U(Ye)],nt.prototype,"visualVariableSizeScaleStops",void 0),d([U(He)],nt.prototype,"visualVariableSizeStops",void 0),d([U(di)],nt.prototype,"visualVariableSizeUnitValue",void 0),d([C(0,F($t)),C(1,F(pt))],nt.prototype,"vertex",null),d([C(0,F(Os))],nt.prototype,"fragment",null);class mt extends Tt{}d([P(3,T)],mt.prototype,"offset",void 0),d([P(4,k)],mt.prototype,"color",void 0),d([P(5,T)],mt.prototype,"normal",void 0),d([P(6,f)],mt.prototype,"halfWidth",void 0),d([P(7,f)],mt.prototype,"referenceHalfWidth",void 0),d([P(8,T)],mt.prototype,"zoomRange",void 0);let As=class extends Os{};function pi(r,t,e){const{id:i,bitset:s}=t,n=it(s,qr),o=X(n,new f(.5)),a=Rs(r,t),c=R(o,a.halfWidth,new f(0)),u=li(r,i),l=ui(r,i,t.color),h=R(o,t.color,l.multiply(u)),p=r.view.displayViewScreenMat3.multiply(new V(t.pos.xy,1)),m=r.clip(t.id),y=new k(p.xy,m,1),b=R(o,a.glPosition,y),v=e&&r.maybeRunHittest(t,e,o);return{isOutline:n,color:h,opacity:new f(1),halfWidth:c,normal:a.normal,glPosition:b,...v}}let lt=class extends ht{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}};d([_(Ze)],lt.prototype,"antialiasingControls",void 0),d([U(ue)],lt.prototype,"visualVariableColor",void 0),d([U(le)],lt.prototype,"visualVariableOpacity",void 0),d([U(hi)],lt.prototype,"visualVariableSizeMinMaxValue",void 0),d([U(Ye)],lt.prototype,"visualVariableSizeScaleStops",void 0),d([U(He)],lt.prototype,"visualVariableSizeStops",void 0),d([U(di)],lt.prototype,"visualVariableSizeUnitValue",void 0);class Rr extends lt{vertex(t,e){return pi(this,t,e)}fragment(t){const{color:e,isOutline:i}=t,s=X(i,new f(.5)),n=sr(t,this.antialiasingControls.blur),o=R(s,n,e),a=R(s,new f(1/255),new f(0));return this.getFragmentOutput(o,t,a)}hittest(t,e,i){return R(i,Ds(this.hittestRequest),ci(this,t,e))}}d([C(0,F(mt)),C(1,F(pt))],Rr.prototype,"vertex",null),d([C(0,F(As))],Rr.prototype,"fragment",null);let Ar=class extends he{};d([P(5,k)],Ar.prototype,"tlbr",void 0),d([P(6,f)],Ar.prototype,"inverseRasterizationScale",void 0);let Sa=class extends ir{};function Pa(r){const t=new f(1),e=new f(0);return new Y(t.divide(r.x),e.divide(r.y),0,We(e.divide(r.x)),t.divide(r.y),0,0,0,1)}function Ls(r,t){const e=t.tlbr.xy,i=t.tlbr.zw,s=i.x.subtract(e.x),n=e.y.subtract(i.y),o=new T(s,n).multiply(t.inverseRasterizationScale),a=o.multiply(r.view.requiredZoomFactor),c=Pa(a),u=r.localTileOffset.getPatternOffsetAtTileOrigin(o).divide(a),l=new V(t.pos,1);return{tileTextureCoord:c.multiply(l).xy.subtract(u),tlbr:t.tlbr.divide(r.mosaicInfo.size.xyxy)}}function Gs(r,t){const e=Yt(r.tileTextureCoord,new f(1)),i=Nt(r.tlbr.xy,r.tlbr.zw,e),s=ut(t.texture,i);return r.color.multiply(s)}let we=class extends Ot{vertex(t,e){return{...super.vertex(t,e),...Ls(this,t)}}fragment(t){const e=Gs(t,this.mosaicInfo);return this.getFragmentOutput(e,t,new f(0))}};d([_(Lt)],we.prototype,"mosaicInfo",void 0),d([_(At)],we.prototype,"localTileOffset",void 0),d([C(0,F(Ar)),C(1,F(pt))],we.prototype,"vertex",null),d([C(0,F(Sa))],we.prototype,"fragment",null);let Lr=class extends mt{};d([P(9,k)],Lr.prototype,"tlbr",void 0),d([P(10,f)],Lr.prototype,"inverseRasterizationScale",void 0);let Us=class extends As{},$e=class extends Rr{vertex(t,e){return{...pi(this,t,e),...Ls(this,t)}}fragment(t){const{isOutline:e}=t,i=X(e,new f(.5)),s=sr(t,this.antialiasingControls.blur),n=Gs(t,this.mosaicInfo),o=R(i,s,n),a=R(i,new f(1/255),new f(0));return this.getFragmentOutput(o,t,a)}};d([_(Lt)],$e.prototype,"mosaicInfo",void 0),d([_(At)],$e.prototype,"localTileOffset",void 0),d([C(0,F(Lr)),C(1,F(pt))],$e.prototype,"vertex",null),d([C(0,F(Us))],$e.prototype,"fragment",null);const dt=16,Qt=1/dt,Gr=128;class at extends Tt{}d([P(3,k)],at.prototype,"color",void 0),d([P(4,k)],at.prototype,"tlbr",void 0),d([P(5,f)],at.prototype,"angle",void 0),d([P(6,f)],at.prototype,"aux1",void 0),d([P(7,f)],at.prototype,"aux2",void 0),d([P(8,T)],at.prototype,"aux3",void 0),d([P(9,T)],at.prototype,"aux4",void 0),d([P(10,T)],at.prototype,"zoomRange",void 0);let Ta=class extends Us{};class Se extends lt{vertex(t,e){const{aux1:i,aux2:s,aux3:n,aux4:o}=t,a={...t,width:i,height:s,offset:n,scale:o.multiply(Qt)},c={...t,halfWidth:i.multiply(Qt),referenceHalfWidth:s.multiply(Qt),offset:n.multiply(Qt),normal:o.subtract(Gr).multiply(Qt)},u=pi(this,c),l=Fs(this,a),h=X(u.isOutline,new f(.5));return{...u,...l,...this.maybeRunHittest(t,e,h)}}fragment(t){const{isOutline:e}=t,i=X(e,new f(.5)),s=sr(t,this.antialiasingControls.blur),n=Bs(this,t),o=R(i,s,n),a=R(i,new f(1/255),new f(0));return this.getFragmentOutput(o,t,a)}hittest(t,e,i){return R(i,Ds(this.hittestRequest),ci(this,t,e))}}d([_(Lt)],Se.prototype,"mosaicInfo",void 0),d([_(At)],Se.prototype,"localTileOffset",void 0),d([C(0,F(at)),C(1,F(pt))],Se.prototype,"vertex",null),d([C(0,F(Ta))],Se.prototype,"fragment",null);const et=hs.attributes,Ia=Qr.attributes,ka={createComputedParams:r=>r,attributes:{id:et.id,pos:et.pos,zoomRange:et.zoomRange,tlbr:et.tlbr,angle:et.angle,color:et.color,bitset:{type:g.UNSIGNED_BYTE,count:1,pack:r=>cs(r)},aux1:{count:1,type:g.UNSIGNED_SHORT,pack:r=>us(r)},aux2:{count:1,type:g.UNSIGNED_SHORT,pack:r=>ls(r)},aux3:{count:2,type:g.SHORT,pack:({offsetX:r,offsetY:t})=>[S(r),S(t)]},aux4:{count:2,type:g.UNSIGNED_BYTE,pack:({scaleX:r,scaleY:t})=>[r*dt,t*dt]}}},Ma={createComputedParams:r=>r,attributes:{id:et.id,pos:et.pos,zoomRange:et.zoomRange,tlbr:et.tlbr,angle:et.angle,color:Ia.color,bitset:{type:g.UNSIGNED_BYTE,count:1,pack:r=>de([[qr,!0]])},aux1:{count:1,type:g.UNSIGNED_SHORT,pack:r=>S(.5*r.width)*dt},aux2:{count:1,type:g.UNSIGNED_SHORT,pack:r=>S(.5*r.referenceWidth)*dt},aux3:{count:2,type:g.SHORT,packTessellation:({extrusionOffsetX:r,extrusionOffsetY:t})=>[r*dt,t*dt]},aux4:{count:2,type:g.UNSIGNED_BYTE,packTessellation:({normalX:r,normalY:t})=>[r*dt+Gr,t*dt+Gr]}}};let Na=class extends Jr{constructor(){super(...arguments),this.vertexSpec=Ma}};class Ea extends ti{constructor(){super(...arguments),this.vertexSpec=ka}_createOutlineWriter(t,e,i,s){return new Na(t,e,i,s)}_write(t,e,i){const s=i?.asOptimized()??e.readGeometryForDisplay(),n=this._clip(s);if(!n)return;const o=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,o),this._writeGeometry(t,e,n),this._lineMeshWriter.writeLineVertices(t,ft.fromOptimizedCIM(n,"esriGeometryPolyline"),e),t.recordEnd()}ensurePacked(t,e,i){super.ensurePacked(t,e,i),this._lineMeshWriter.ensurePacked(t,e,i)}enqueueRequest(t,e,i){super.enqueueRequest(t,e,i),this._lineMeshWriter.enqueueRequest(t,e,i)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}const za={createComputedParams:r=>r,attributes:{...Je.attributes,...ds.attributes}},Da={createComputedParams:r=>r,attributes:{...Je.attributes,...Qr.attributes}};let Ca=class extends Jr{constructor(){super(...arguments),this.vertexSpec=Da}},Fa=class extends ti{constructor(){super(...arguments),this.vertexSpec=za}_createOutlineWriter(t,e,i,s){return new Ca(t,e,i,s)}_write(t,e,i){const s=i?.asOptimized()??e.readGeometryForDisplay(),n=this._clip(s);if(!n)return;const o=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,o),this._writeGeometry(t,e,n),this._lineMeshWriter.writeLineVertices(t,ft.fromOptimizedCIM(n,"esriGeometryPolyline"),e),t.recordEnd()}ensurePacked(t,e,i){super.ensurePacked(t,e,i),this._lineMeshWriter.ensurePacked(t,e,i)}enqueueRequest(t,e,i){super.enqueueRequest(t,e,i),this._lineMeshWriter.enqueueRequest(t,e,i)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}};const Ba={createComputedParams:r=>r,attributes:{pos:{type:g.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:g.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:g.UNSIGNED_BYTE,count:1},offset:{type:g.BYTE,count:2,packAlternating:{count:4,pack:()=>[[-1,-1],[1,-1],[-1,1],[1,1]]}}}};let Oa=class extends Gt{constructor(){super(...arguments),this.vertexSpec=Ba}_write(t,e){t.recordStart(this.instanceId,this.attributeLayout);const i=e.getDisplayId();if(e.geometryType==="esriGeometryPoint"){const s=e.readXForDisplay(),n=e.readYForDisplay();this._writeQuad(t,i,s,n)}else e.geometryType==="esriGeometryMultipoint"&&e.readGeometryForDisplay()?.forEachVertex((n,o)=>{n>=0&&n<=512&&o>=0&&o<=512&&this._writeQuad(t,i,n,o)});t.recordEnd()}_writeQuad(t,e,i,s){const n=t.vertexCount();this._writeVertex(t,e,i,s),t.indexWrite(n+0),t.indexWrite(n+1),t.indexWrite(n+2),t.indexWrite(n+1),t.indexWrite(n+3),t.indexWrite(n+2)}};const Va=8388607,Ra=8388608,Pe=r=>r&Va;function Uu(r,t){return((t?Ra:0)|r)>>>0}function zi(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r}function Ws(r,t){return Math.sqrt(r*r+t*t)}function Di(r){const t=Ws(r[0],r[1]);r[0]/=t,r[1]/=t}function Aa(r,t){return Ws(r[0]-t[0],r[1]-t[1])}function La(r,t){return r[t+1]}function Ys(r){return r.length-1}function Ga(r){let t=0;for(let e=0;e<Ys(r);e++)t+=Ua(r,e);return t}function Ua(r,t,e=1){let[i,s]=La(r,t);return[i,s]=[Math.round(i),Math.round(s)],Math.sqrt(i*i+s*s)*e}class Xe{constructor(t,e,i,s,n){this._segments=t,this._index=e,this._distance=i,this._xStart=s,this._yStart=n,this._done=!1}static create(t){return new Xe(t,0,0,t[0][0],t[0][1])}clone(){return new Xe(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(t){return this._index===t._index||t._index===this._index-1&&(this._distance===0||t._distance===1)||t._index===this._index+1&&(this._distance===1||t._distance===0)}leq(t){return this._index<t._index||this._index===t._index&&this._distance<=t._distance}geq(t){return this._index>t._index||this._index===t._index&&this._distance>=t._distance}get _segment(){return this._segments[this._index+1]}get angle(){const t=this.dy,e=(0*t+-1*-this.dx)/(1*this.length);let i=Math.acos(e);return t>0&&(i=2*Math.PI-i),i}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const{dx:t,dy:e}=this;return Math.sqrt(t*t+e*e)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return this._index-1>=0}hasNext(){return this._index+1<Ys(this._segments)}next(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}prev(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}_seekBackwards(t,e){const i=this.backwardLength;if(t<=i)return this._distance=(i-t)/this.length,this;let s=this.backwardLength;for(;this.prev();){if(s+this.length>t)return this._seekBackwards(t-s);s+=this.length}return this._distance=0,e?this:null}seek(t,e=!1){if(t<0)return this._seekBackwards(Math.abs(t),e);if(t<=this.remainingLength)return this._distance=(this.backwardLength+t)/this.length,this;let i=this.remainingLength;for(;this.next();){if(i+this.length>t)return this.seek(t-i,e);i+=this.length}return this._distance=1,e?this:null}}function Wa(r,t,e,i=!0){const s=Ga(r),n=Xe.create(r),o=s/2;if(!i)return n.seek(o),void(Math.abs(n.x)<yt&&Math.abs(n.y)<yt&&e(n.clone(),0,o+0*t,s));const a=Math.max((s-t)/2,0),c=Math.floor(a/t),u=o-c*t;n.seek(u);for(let l=-c;l<=c;l++)Math.abs(n.x)<yt&&Math.abs(n.y)<yt&&e(n.clone(),l,o+l*t,s),n.seek(t)}function Ya(r,t){const e=t;for(let i=0;i<r.length;i++){let s=r[i];Ha(s,e);const n=[];n.push(s[0]);for(let o=1;o<s.length;o++){const[a,c]=s[o-1],[u,l]=s[o],h=u-a,p=l-c;n.push([h,p])}r[i]=n,s=n}return r}function Ha(r,t){if(t<=0)return;const i=r.length;if(i<3)return;const s=[];let n=0;s.push(0);for(let h=1;h<i;h++)n+=Aa(r[h],r[h-1]),s.push(n);t=Math.min(t,.2*n);const o=[];o.push(r[0][0]),o.push(r[0][1]);const a=r[i-1][0],c=r[i-1][1],u=zi([0,0],r[0],r[1]);Di(u),r[0][0]+=t*u[0],r[0][1]+=t*u[1],zi(u,r[i-1],r[i-2]),Di(u),r[i-1][0]+=t*u[0],r[i-1][1]+=t*u[1];for(let h=1;h<i;h++)s[h]+=t;s[i-1]+=t;const l=.5*t;for(let h=1;h<i-1;h++){let p=0,m=0,y=0;for(let b=h-1;b>=0&&!(s[b+1]<s[h]-l);b--){const v=l+s[b+1]-s[h],w=s[b+1]-s[b],$=s[h]-s[b]<l?1:v/w;if(Math.abs($)<1e-6)break;const M=$*$,N=$*v-.5*M*w,I=$*w/t,E=r[b+1],Q=r[b][0]-E[0],st=r[b][1]-E[1];p+=I/N*(E[0]*$*v+.5*M*(v*Q-w*E[0])-M*$*w*Q/3),m+=I/N*(E[1]*$*v+.5*M*(v*st-w*E[1])-M*$*w*st/3),y+=I}for(let b=h+1;b<i&&!(s[b-1]>s[h]+l);b++){const v=l-s[b-1]+s[h],w=s[b]-s[b-1],$=s[b]-s[h]<l?1:v/w;if(Math.abs($)<1e-6)break;const M=$*$,N=$*v-.5*M*w,I=$*w/t,E=r[b-1],Q=r[b][0]-E[0],st=r[b][1]-E[1];p+=I/N*(E[0]*$*v+.5*M*(v*Q-w*E[0])-M*$*w*Q/3),m+=I/N*(E[1]*$*v+.5*M*(v*st-w*E[1])-M*$*w*st/3),y+=I}o.push(p/y),o.push(m/y)}o.push(a),o.push(c);for(let h=0,p=0;h<i;h++)r[h][0]=o[p++],r[h][1]=o[p++]}class Hs{static getPlacement(t,e,i,s,n,o){const a=cn(i);return a?(e===-1&&t.invertY(),a.execute(t,i,s,n,o)):null}}const Ci=96;let Za=class{constructor(t){const{offsetX:e,offsetY:i,postAngle:s,fontSize:n,scaleFactor:o,transforms:a}=t;if(this.offsetX=e,this.offsetY=i,this.postAngle=s,this.fontSize=Math.min(n,Ci),this.transforms=a,a&&a.infos.length>1){const c=Gi(n,s,!1,e,i,a);this.fontSize=Math.min(c.size,Ci),this.postAngle=c.rotation,this.offsetX=c.offsetX,this.offsetY=c.offsetY}o&&(this.fontSize*=o,this.offsetX*=o,this.offsetY*=o)}};const Ae=28,bt=[4,4],Te=[16,4],Xa={topLeft:Te,topRight:Te,bottomLeft:Te,bottomRight:Te},qe=[4,2],tt=[4,6],Fi={topLeft:qe,topRight:qe,bottomLeft:tt,bottomRight:tt},Bi={topLeft:qe,topRight:tt,bottomLeft:qe,bottomRight:tt},qa={topLeft:tt,topRight:tt,bottomLeft:bt,bottomRight:bt},Ka={topLeft:bt,topRight:bt,bottomLeft:tt,bottomRight:tt},ja={topLeft:tt,topRight:bt,bottomLeft:tt,bottomRight:bt},Qa={topLeft:bt,topRight:tt,bottomLeft:bt,bottomRight:tt},Ja={createComputedParams:r=>r,attributes:{pos:{type:g.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:g.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:g.UNSIGNED_BYTE,count:1,packTessellation:({isBackground:r,mapAligned:t})=>de([[$o,r],[So,!!t]])},zoomRange:{type:g.UNSIGNED_SHORT,count:2,packPrecisionFactor:Qe,packTessellation:({minZoom:r,maxZoom:t})=>[r||0,t||Ae]},offset:{type:g.SHORT,count:2,packPrecisionFactor:8,packAlternating:{count:4,packTessellation:({offsets:r})=>{const{bottomLeft:t,bottomRight:e,topLeft:i,topRight:s}=r;return[i,s,t,e]}}},textureUV:{type:g.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,packTessellation:({texcoords:r})=>{const{bottomLeft:t,bottomRight:e,topLeft:i,topRight:s}=r;return[i,s,t,e]}}},color:{type:g.UNSIGNED_BYTE,count:4,normalized:!0,packTessellation:({color:r})=>r},fontSize:{type:g.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,packTessellation:({fontSize:r})=>S(r)},referenceSize:{type:g.UNSIGNED_BYTE,count:1,packPrecisionFactor:4,packTessellation:({fontSize:r},{referenceSize:t})=>S(t??r)},haloColor:{type:g.UNSIGNED_BYTE,count:4,normalized:!0,pack:({haloColor:r})=>A(r)},haloFontSize:{type:g.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,pack:({haloFontSize:r})=>S(r)},clipAngle:{type:g.UNSIGNED_BYTE,count:1,packTessellation:({clipAngle:r})=>tc(r||0)},referenceSymbol:{type:g.BYTE,count:4,packPrecisionFactor:1,packTessellation:(r,t)=>{if(!r.referenceBounds)return[0,0,0,0];const e=un(t.horizontalAlignment),i=ln(t.verticalAlignment),{offsetX:s,offsetY:n,size:o}=r.referenceBounds;return[S(s),-S(n),S(o),e+1<<2|i+1]}}}};let Zs=class extends Gt{constructor(){super(...arguments),this.vertexSpec=Ja,this._textMeshParamsPropsInitialized=!1}ensurePacked(t,e,i){super.ensurePacked(t,e,i),this._textMeshParamsPropsInitialized&&!this._evaluator.hasDynamicProperties||(this._textMeshTransformProps=new Za(this.evaluatedMeshParams),this._textMeshParamsPropsInitialized=!0)}_write(t,e,i){const s=this._getShaping();if(!s)return;const n=e.getDisplayId();if(this.evaluatedMeshParams.placement!=null)return this._writePlacedTextMarkers(t,e,s,i);if(i&&i.nextPath())return i.nextPoint(),this._writeGlyphs(t,n,i.x,i.y,s,0);if(e.geometryType==="esriGeometryPolygon"){const c=e.readCentroidForDisplay();if(!c)return;const[u,l]=c.coords;return this._writeGlyphs(t,n,u,l,s,0)}if(e.geometryType==="esriGeometryMultipoint")return void e.readGeometryForDisplay()?.forEachVertex((u,l)=>this._writeGlyphs(t,n,u,l,s,0));const o=e.readXForDisplay(),a=e.readYForDisplay();return this._writeGlyphs(t,n,o,a,s,0)}_writePlacedTextMarkers(t,e,i,s){const n=s??ft.fromFeatureSetReaderCIM(e);if(!n)return;const o=-1,a=Hs.getPlacement(n,o,this.evaluatedMeshParams.placement,S(1),t.id,Hr());if(!a)return;const c=e.getDisplayId();let u=a.next();for(;u!=null;){const l=u.tx,h=-u.ty,p=-u.getAngle();this._writeGlyphs(t,c,l,h,i,p),u=a.next()}}_getShaping(){const t=this._textMeshTransformProps,e=this.evaluatedMeshParams;if(!e.glyphs?.glyphs.length)return null;const i=Math.round(S(t.fontSize)),s=S(t.offsetX),n=S(t.offsetY),o=gi(S(e.lineWidth),32,512),a=hn*gi(e.lineHeightRatio,.25,4);return dn(e.glyphs,{scale:i/pn,angle:t.postAngle,xOffset:s,yOffset:n,horizontalAlignment:e.horizontalAlignment,verticalAlignment:e.verticalAlignment,maxLineWidth:o,lineHeight:a,decoration:e.decoration,borderLineSizePx:S(e.boxBorderLineSize),hasBackground:!!e.boxBackgroundColor,useCIMAngleBehavior:e.useCIMAngleBehavior})}_writeGlyphs(t,e,i,s,n,o,a,c){const u=this.evaluatedMeshParams,l=this._textMeshTransformProps,h=l.fontSize,p=S(l.offsetX),m=S(l.offsetY),[y,b]=Ut(u.scaleInfo,this.getTileInfo());o!==0&&n.setRotation(o);const v=n.bounds,w=i+v.x+p,$=s+v.y-m,M=2*(u.minPixelBuffer?u.minPixelBuffer/h:1),N=Math.max(v.width,v.height)*M;n.textBox&&(t.recordStart(this.instanceId,this.attributeLayout,n.glyphs[0].textureBinding),t.recordBounds(w,$,N,N),this._writeTextBox(t,e,i,s,n.textBox,a,c),t.recordEnd());for(const I of n.glyphs){t.recordStart(this.instanceId,this.attributeLayout,I.textureBinding),t.recordBounds(w,$,N,N);const{texcoords:E,offsets:Q}=I;this._writeQuad(t,e,i,s,{texcoords:E,offsets:Q,fontSize:h,color:A(u.color),isBackground:!1,referenceBounds:a,minZoom:y,maxZoom:b,...c}),t.recordEnd()}o!==0&&n.setRotation(-o)}_writeTextBox(t,e,i,s,n,o,a){const c=this.evaluatedMeshParams,{fontSize:u}=this._textMeshTransformProps,{boxBackgroundColor:l,boxBorderLineColor:h}=c,p={isBackground:!0,fontSize:u,referenceBounds:o,...a};l&&(this._writeQuad(t,e,i,s,{texcoords:Xa,offsets:n.main,color:A(l),...p}),h||(this._writeQuad(t,e,i,s,{texcoords:qa,offsets:n.top,color:A(l),...p}),this._writeQuad(t,e,i,s,{texcoords:Ka,offsets:n.bot,color:A(l),...p}),this._writeQuad(t,e,i,s,{texcoords:ja,offsets:n.left,color:A(l),...p}),this._writeQuad(t,e,i,s,{texcoords:Qa,offsets:n.right,color:A(l),...p}))),h&&(this._writeQuad(t,e,i,s,{texcoords:Fi,offsets:n.top,color:A(h),...p}),this._writeQuad(t,e,i,s,{texcoords:Fi,offsets:n.bot,color:A(h),...p}),this._writeQuad(t,e,i,s,{texcoords:Bi,offsets:n.left,color:A(h),...p}),this._writeQuad(t,e,i,s,{texcoords:Bi,offsets:n.right,color:A(h),...p}))}_writeQuad(t,e,i,s,n){const o=t.vertexCount();this._writeVertex(t,e,i,s,n),t.indexWrite(o+0),t.indexWrite(o+1),t.indexWrite(o+2),t.indexWrite(o+1),t.indexWrite(o+3),t.indexWrite(o+2)}};const tc=r=>Math.round(r*(254/360)),Ie=1,Dt=0,ec=128,rc=gn(r=>{let t=0;if(r===0)return 1/0;for(;!(r%2);)t++,r/=2;return t});class ic extends Zs{constructor(){super(...arguments),this._zoomLevel=0}_write(t,e,i,s){if(this._zoomLevel=s||0,i!=null)throw new Error("InternalError: EffectGeometry not support for LabelMeshWriter");switch(e.geometryType){case"esriGeometryPoint":{const n=e.readXForDisplay(),o=e.readYForDisplay();return this._writePoint(t,n,o,e)}case"esriGeometryEnvelope":case"esriGeometryPolygon":case"esriGeometryMultipoint":{const n=e.readCentroidForDisplay();if(!n)return;const[o,a]=n.coords;return this._writePoint(t,o,a,e)}case"esriGeometryPolyline":{const n=e.readLegacyGeometryForDisplay();this._writeLines(t,e,n)}}}_writePoint(t,e,i,s){const n=this._getShaping();if(!n)return;let o=this._getPointReferenceBounds();o||(o={offsetX:0,offsetY:0,size:0});const a=n.boundsT,c=fn(this.evaluatedMeshParams.horizontalAlignment),u=mn(this.evaluatedMeshParams.verticalAlignment),l=this.evaluatedMeshParams.scaleInfo?.maxScale??0,h=this.evaluatedMeshParams.scaleInfo?.minScale??0,p=Pe(s.getDisplayId());t.metricStart(new xe(p,e,i,c,u,l,h,o)),t.metricBoxWrite(a),this._writeGlyphs(t,s.getDisplayId(),e,i,n,0,o),t.metricEnd()}_getPointReferenceBounds(){if(!this._references)return null;for(const t of this._references){const e=t.getBoundsInfo();if(e)return e}return null}_writeLines(t,e,i){const{repeatLabel:s,scaleInfo:n}=this.evaluatedMeshParams,o=this.evaluatedMeshParams.repeatLabelDistance||128,a=this._getShaping();if(!a)return;this._current={out:t,id:e.getDisplayId(),shaping:a,zoomRange:Ut(n,this.getTileInfo()),referenceBounds:this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0}};const c=Ya(i.paths,a.bounds.width),u=this._placeSubdivGlyphs.bind(this),l=(a.bounds.width+o)/(1<<Ie);for(const h of c)Wa(h,l,u,!!s)}_placeSubdivGlyphs(t,e,i,s){const{allowOverrun:n,labelPosition:o,repeatLabelDistance:a}=this.evaluatedMeshParams,c=this._current.zoomRange[0],u=rc(e),l=this._current.shaping.bounds.width/(1<<Ie),h=Math.sqrt(a||ec)/(1<<Ie),p=Math.min(i,s-i),m=this._current.shaping.isMultiline?Ae:Math.log2(p/(h+l/2)),y=e===0?m:Math.min(u,m),b=Math.max(c,this._zoomLevel+Ie-y),v=this._zoomLevel-b,w=this._current.shaping.bounds.width/2*2**v;this._current.shaping.isMultiline?e===0&&this._placeStraight(t,b):n&&v<0?this._placeStraightAlong(t,c):o==="parallel"?this._placeStraightAlong(t,b):o==="curved"&&this._placeCurved(t,b,w)}_placeStraight(t,e){const{out:i,id:s,shaping:n,referenceBounds:o}=this._current,{x:a,y:c}=t,u=Pe(s),l=this.evaluatedMeshParams.scaleInfo?.maxScale??0,h=this.evaluatedMeshParams.scaleInfo?.minScale??0;i.metricStart(new xe(u,t.x,t.y,0,0,l,h,null)),i.metricBoxWrite(n.boundsT);const p=t.angle*(180/Math.PI)%360,m=(t.angle*(180/Math.PI)+180)%360;this._writeGlyphs(i,s,a,c,n,0,o,{clipAngle:p,mapAligned:!0,isLineLabel:!0,minZoom:e}),this._writeGlyphs(i,s,a,c,n,0,o,{clipAngle:m,mapAligned:!0,isLineLabel:!0,minZoom:e}),i.metricEnd()}_placeCurved(t,e,i){const{out:s,id:n}=this._current,o=t.clone(),a=t.angle*(180/Math.PI)%360,c=(t.angle*(180/Math.PI)+180)%360,u=Pe(n),l=this.evaluatedMeshParams.scaleInfo?.maxScale??0,h=this.evaluatedMeshParams.scaleInfo?.minScale??0;s.metricStart(new xe(u,t.x,t.y,0,0,l,h,null)),this._placeFirst(o,e,1,a),this._placeBack(t,o,e,i,1,a),this._placeForward(t,o,e,i,1,a),this._placeFirst(o,e,0,c),this._placeBack(t,o,e,i,0,c),this._placeForward(t,o,e,i,0,c),s.metricEnd()}_placeStraightAlong(t,e){const{out:i,id:s,shaping:n,zoomRange:o,referenceBounds:a}=this._current,{boxBorderLineColor:c,boxBackgroundColor:u}=this.evaluatedMeshParams,l=t.clone(),h=t.angle*(180/Math.PI)%360,p=(t.angle*(180/Math.PI)+180)%360;if(n.glyphs.length>0&&(c||u)){const v=Math.max(e,o[0],0),w=Math.min(Ae,o[1]),$=Ui(Wi(),-t.angle),[M,N]=n.shapeBackground($),I={minZoom:v,maxZoom:w,clipAngle:h,mapAligned:!0,isLineLabel:!0};i.recordStart(this.instanceId,this.attributeLayout,n.glyphs[0].textureBinding),this._writeTextBox(i,s,t.x,t.y,N,a,I),i.recordEnd(),I.clipAngle=p,i.recordStart(this.instanceId,this.attributeLayout,n.glyphs[0].textureBinding),this._writeTextBox(i,s,t.x,t.y,N,a,I),i.recordEnd()}const m=Pe(s),y=this.evaluatedMeshParams.scaleInfo?.maxScale??0,b=this.evaluatedMeshParams.scaleInfo?.minScale??0;i.metricStart(new xe(m,t.x,t.y,0,0,y,b,null)),this._placeFirst(l,e,1,h,!0),this._placeFirst(l,e,0,p,!0),i.metricEnd()}_placeBack(t,e,i,s,n,o){const a=t.clone();let c=t.backwardLength+Dt;for(;a.prev()&&!(c>=s);)this._placeOnSegment(a,e,c,i,-1,n,o),c+=a.length+Dt}_placeForward(t,e,i,s,n,o){const a=t.clone();let c=t.remainingLength+Dt;for(;a.next()&&!(c>=s);)this._placeOnSegment(a,e,c,i,1,n,o),c+=a.length+Dt}_placeFirst(t,e,i,s,n=!1){const o=t,{out:a,id:c,shaping:u,zoomRange:l,referenceBounds:h}=this._current,p=u.glyphs;for(const m of p){const y=m.x>u.bounds.x?i:1-i,b=y*t.remainingLength+(1-y)*t.backwardLength,v=Math.abs(m.x+m.width/2-u.bounds.x),w=Math.max(0,this._zoomLevel+Math.log2(v/(b+Dt))),$=Math.max(e,n?0:w);m.maxZoom=Math.min(l[1],Ae),m.angle=t.angle+(1-i)*Math.PI,m.minZoom=Math.max(l[0],$),this._writeLineGlyph(a,c,o.x,o.y,u.bounds,m,s,h,!0),i&&this._isVisible(m.minZoom,m.maxZoom)&&a.metricBoxWrite(m.bounds)}}_placeOnSegment(t,e,i,s,n,o,a){const{out:c,id:u,shaping:l,referenceBounds:h}=this._current,p=l.glyphs,m=t.dx/t.length,y=t.dy/t.length,b={x:t.x+i*-n*m,y:t.y+i*-n*y};for(const v of p){const w=v.x>l.bounds.x?o:1-o;if(!(w&&n===1||!w&&n===-1))continue;const $=Math.abs(v.x+v.width/2-l.bounds.x),M=Math.max(0,this._zoomLevel+Math.log2($/i)-.1),N=Math.max(s,this._zoomLevel+Math.log2($/(i+t.length+Dt)));if(M!==0&&(v.angle=t.angle+(1-o)*Math.PI,v.minZoom=N,v.maxZoom=M,this._writeLineGlyph(c,u,b.x,b.y,l.bounds,v,a,h,!0),o&&this._isVisible(v.minZoom,v.maxZoom))){const I=v.bounds,E=t.x-e.x,Q=t.y-e.y,st=new yn(I.center[0]+E,I.center[1]+Q,I.width,I.height);c.metricBoxWrite(st)}}}_writeLineGlyph(t,e,i,s,n,o,a,c,u){const l=i+n.x,h=s+n.y,p=2*(this.evaluatedMeshParams.minPixelBuffer?this.evaluatedMeshParams.minPixelBuffer/this._textMeshTransformProps.fontSize:1),m=Math.max(n.width,n.height)*p;t.recordStart(this.instanceId,this.attributeLayout,o.textureBinding),t.recordBounds(l,h,m,m);const{texcoords:y,offsets:b}=o,v=this._textMeshTransformProps.fontSize;this._writeQuad(t,e,i,s,{texcoords:y,offsets:b,fontSize:v,color:A(this.evaluatedMeshParams.color),isBackground:!1,referenceBounds:c,minZoom:Math.max(this._current.zoomRange[0],o.minZoom),maxZoom:Math.min(this._current.zoomRange[1],o.maxZoom),clipAngle:a,mapAligned:u,isLineLabel:!0}),t.recordEnd()}_isVisible(t,e){const i=this._zoomLevel;return t<=i&&i<=e}}const sc={createComputedParams:r=>r,attributes:{...tr.attributes,bitset:{type:g.UNSIGNED_BYTE,count:1,pack:({shouldSampleAlphaOnly:r,shouldScaleDash:t,isSDF:e})=>de([[Xr,r],[_o,t],[wo,e]])},tlbr:{type:g.UNSIGNED_SHORT,count:4,pack:({sprite:r})=>{const{rect:t,width:e,height:i}=r,s=t.x+Rt,n=t.y+Rt;return[s,n,s+e,n+i]}},accumulatedDistance:{type:g.UNSIGNED_SHORT,count:1,packTessellation:({distance:r})=>r},segmentDirection:{type:g.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:r,directionY:t})=>[r,t]}}};class nc extends jr{constructor(t,e,i,s){super(t,e,i,s),this.vertexSpec=sc,this._tessellationOptions.textured=!0}_write(t,e,i){const s=i??ft.fromFeatureSetReaderCIM(e);if(!s)return;const{sprite:n}=this.evaluatedMeshParams;this._writeGeometry(t,e,s,n?.textureBinding)}}class Ke{static from(t){return"width"in t?this.fromSimpleMeshParams(t):this.fromComplexMeshParams(t)}static fromSimpleMeshParams(t){const e=new Ke(t.sprite,t.color,t.outlineColor,t.minPixelBuffer,t.placement,t.scaleInfo,t.effects),{type:i,width:s,height:n,angle:o,alignment:a,outlineSize:c,referenceSize:u,sprite:l,overrideOutlineColor:h}=t;e.rawWidth=S(s),e.rawHeight=S(n),e.angle=o,e.alignment=a,e.outlineSize=S(c),e.referenceSize=S(u),e.overrideOutlineColor=h,e.offsetX=S(t.offsetX),e.offsetY=S(t.offsetY),i!=="simple"||l.sdf||(e.rawWidth=l.width,e.rawHeight=l.height);const p=2;return e.sizeRatio=l.sdf?p:1,e._computeSize(t,!1),e}static fromComplexMeshParams(t){const e=new Ke(t.sprite,t.color,t.outlineColor,t.minPixelBuffer,t.placement,t.scaleInfo,t.effects);let{alignment:i,transforms:s,size:n,scaleX:o,anchorX:a,anchorY:c,angle:u,colorLocked:l,frameHeight:h,widthRatio:p,offsetX:m,offsetY:y,outlineSize:b,referenceSize:v,scaleFactor:w,sizeRatio:$,isAbsoluteAnchorPoint:M,rotateClockwise:N,scaleSymbolsProportionally:I,sprite:E}=t;if(s&&s.infos.length>0){const ye=Gi(n,u,N,m,y,s);n=ye.size,u=ye.rotation,m=ye.offsetX,y=ye.offsetY,N=!1}w&&(n*=w,m*=w,y*=w);const Q=o*(E.width/E.height);e.alignment=i,e.rawHeight=S(n),e.rawWidth=e.rawHeight*Q,e.referenceSize=S(v),e.sizeRatio=$,e.angle=u,e.rotateClockwise=N,e.anchorX=a,e.anchorY=c,e.offsetX=S(m),e.offsetY=S(y),M&&n&&(E.sdf?e.anchorX=a/(n*p):e.anchorX=a/(n*Q),e.anchorY=c/n);const st=I&&h?n/h:1;return e.outlineSize=b===0||isNaN(b)?0:S(b)*st,e.scaleSymbolsProportionally=I,e.colorLocked=l,e._computeSize(t,!0),e}constructor(t,e,i,s,n,o,a){this.sprite=t,this.color=e,this.outlineColor=i,this.minPixelBuffer=s,this.placement=n,this.scaleInfo=o,this.effects=a,this.rawWidth=0,this.rawHeight=0,this.angle=0,this.outlineSize=0,this.referenceSize=0,this.sizeRatio=1,this.alignment=Yi.SCREEN,this.scaleSymbolsProportionally=!1,this.overrideOutlineColor=!1,this.colorLocked=!1,this.anchorX=0,this.anchorY=0,this.computedWidth=0,this.computedHeight=0,this.texXmin=0,this.texYmin=0,this.texXmax=0,this.texYmax=0,this.offsetX=0,this.offsetY=0,this.rotateClockwise=!0}get boundsInfo(){return{size:Math.max(this.computedHeight,this.computedWidth),offsetX:this.offsetX,offsetY:this.offsetY}}_computeSize(t,e){const{sprite:i,hasSizeVV:s}=t,n=!!i.sdf,{rawWidth:o,rawHeight:a,sizeRatio:c,outlineSize:u}=this,l=o*c,h=a*c;if(n&&!s){const M=e&&o>a?l:o,N=a,I=u+2*1;this.computedWidth=Math.min(M+I,l),this.computedHeight=Math.min(N+I,h)}else this.computedWidth=l,this.computedHeight=h;const p=n?xn/Math.max(l,h):1,m=.5*(l-this.computedWidth)*p,y=.5*(h-this.computedHeight)*p,b=i.rect.x+Rt+m,v=i.rect.y+Rt+y,w=b+i.width-2*m,$=v+i.height-2*y;this.texXmin=Math.floor(b),this.texYmin=Math.floor(v),this.texXmax=Math.ceil(w),this.texYmax=Math.ceil($),this.computedWidth*=(this.texXmax-this.texXmin)/(w-b),this.computedHeight*=(this.texYmax-this.texYmin)/($-v),this.anchorX*=l/this.computedWidth,this.anchorY*=h/this.computedHeight}}const Jt={bitset:{isSDF:0,isMapAligned:1,scaleSymbolsProportionally:2,overrideOutlineColor:3,colorLocked:4}},Oi=3.14159265359/180,oc=128/Math.PI;function ac(r,t){return r%=t,Math.abs(r>=0?r:r+t)}function cc(r){return ac(r*oc,256)}function uc(r,t,e,i,s=!1){const n=Wi(),o=s?1:-1;return r?Ui(n,o*Oi*r):bn(n),(t||e)&&vn(n,n,[t,-e]),i&&_n(n,n,o*Oi*-i),n}const lc={createComputedParams:r=>Ke.from(r),attributes:{pos:{type:g.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:g.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:g.UNSIGNED_BYTE,count:1,pack:({sprite:r,alignment:t,scaleSymbolsProportionally:e,overrideOutlineColor:i,colorLocked:s})=>{let n=0;return r.sdf&&(n|=Zt(Jt.bitset.isSDF)),t===Yi.MAP&&(n|=Zt(Jt.bitset.isMapAligned)),e&&(n|=Zt(Jt.bitset.scaleSymbolsProportionally)),i&&(n|=Zt(Jt.bitset.overrideOutlineColor)),s&&(n|=Zt(Jt.bitset.colorLocked)),n}},zoomRange:{type:g.SHORT,count:2,packPrecisionFactor:Qe,pack:({scaleInfo:r},{tileInfo:t})=>Ut(r,t)},offset:{type:g.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({angle:r,computedWidth:t,computedHeight:e,anchorX:i,anchorY:s,offsetX:n,offsetY:o,rotateClockwise:a})=>{const c=uc(0,n,o,-r,a),u=-(.5+i)*t,l=-(.5-s)*e,h=[u,l],p=[u+t,l],m=[u,l+e],y=[u+t,l+e];return be(h,h,c),be(p,p,c),be(m,m,c),be(y,y,c),[h,p,m,y]}}},textureUV:{type:g.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({texXmax:r,texXmin:t,texYmax:e,texYmin:i})=>[[t,i],[r,i],[t,e],[r,e]]}},color:{type:g.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:r})=>A(r)},outlineColor:{type:g.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:r})=>A(r)},sizing:{type:g.UNSIGNED_BYTE,count:4,pack:({rawWidth:r,rawHeight:t,outlineSize:e,referenceSize:i})=>{const s=Math.max(r,t);return[lr(s,128),lr(e,128),lr(i,128),0]}},placementAngle:{type:g.UNSIGNED_BYTE,count:1,packTessellation:({placementAngle:r})=>cc(r)},sizeRatio:{type:g.UNSIGNED_SHORT,count:1,packPrecisionFactor:64,pack:({sizeRatio:r})=>r}}};class hc extends Gt{constructor(){super(...arguments),this.vertexSpec=lc}getBoundsInfo(){return this.evaluatedMeshParams.boundsInfo}_write(t,e,i){const s=this.evaluatedMeshParams.sprite?.textureBinding,n=e.getDisplayId();t.recordStart(this.instanceId,this.attributeLayout,s);const o=this.evaluatedMeshParams.minPixelBuffer,a=Math.max(this.evaluatedMeshParams.computedWidth,o),c=Math.max(this.evaluatedMeshParams.computedHeight,o),u=this.evaluatedMeshParams.offsetX,l=-this.evaluatedMeshParams.offsetY;if(this.evaluatedMeshParams.placement!=null)this._writePlacedMarkers(t,e,i,a,c);else if(i&&i.nextPath()){i.nextPoint();const h=i.x,p=i.y;t.recordBounds(h+u,p+l,a,c),this._writeQuad(t,n,h,p)}else if(e.geometryType==="esriGeometryPolygon"){const h=e.readCentroidForDisplay();if(!h)return;const[p,m]=h.coords;t.recordBounds(p+u,m+l,a,c),this._writeQuad(t,n,p,m)}else if(e.geometryType==="esriGeometryPoint"){const h=e.readXForDisplay(),p=e.readYForDisplay();t.recordBounds(h+u,p+l,a,c),this._writeQuad(t,n,h,p)}else e.readGeometryForDisplay()?.forEachVertex((p,m)=>{t.recordBounds(p+u,m+l,a,c),Math.abs(p)>yt||Math.abs(m)>yt||this._writeQuad(t,n,p,m)});t.recordEnd()}_writePlacedMarkers(t,e,i,s,n){const o=i??ft.fromFeatureSetReaderCIM(e)?.clone();if(!o)return;const a=-1,c=Hs.getPlacement(o,a,this.evaluatedMeshParams.placement,S(1),t.id,Hr());if(!c)return;const u=e.getDisplayId();let l=c.next();const h=this.evaluatedMeshParams.offsetX,p=-this.evaluatedMeshParams.offsetY;for(;l!=null;){const m=l.tx,y=-l.ty;if(Math.abs(m)>yt||Math.abs(y)>yt){l=c.next();continue}const b=-l.getAngle();t.recordBounds(m+h,y+p,s,n),this._writeQuad(t,u,m,y,b),l=c.next()}}_writeQuad(t,e,i,s,n){const o=t.vertexCount(),a=n==null?null:{placementAngle:n};this._writeVertex(t,e,i,s,a),t.indexWrite(o+0),t.indexWrite(o+1),t.indexWrite(o+2),t.indexWrite(o+1),t.indexWrite(o+3),t.indexWrite(o+2)}}const dc={createComputedParams:r=>r,attributes:{pos:{type:g.SHORT,count:2,packPrecisionFactor:10,pack:"position"},id:{type:g.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:g.UNSIGNED_BYTE,count:1,pack:r=>0},offset:{type:g.SHORT,count:2,packPrecisionFactor:16,packAlternating:{count:4,pack:({size:r})=>{const t=S(r),e=-t/2,i=-t/2;return[[e,i],[e+t,i],[e,i+t],[e+t,i+t]]}}},texCoords:{type:g.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:()=>[[0,1],[1,1],[0,0],[1,0]]}},size:{type:g.UNSIGNED_BYTE,count:2,pack:({size:r})=>[r,r]},referenceSize:{type:g.UNSIGNED_BYTE,count:1,pack:({size:r})=>S(r)},zoomRange:{type:g.UNSIGNED_BYTE,count:2,pack:({scaleInfo:r},{tileInfo:t})=>Ut(r,t)}}};class pc extends Gt{constructor(){super(...arguments),this.vertexSpec=dc}_write(t,e){const i=e.getDisplayId(),s=this.evaluatedMeshParams.minPixelBuffer,n=Math.max(S(this.evaluatedMeshParams.size),s);let o,a;if(e.geometryType==="esriGeometryPoint")o=e.readXForDisplay(),a=e.readYForDisplay();else{const u=e.readCentroidForDisplay();if(!u)return;o=u?.coords[0],a=u?.coords[1]}t.recordStart(this.instanceId,this.attributeLayout),t.recordBounds(o,a,n,n);const c=t.vertexCount();this._writeVertex(t,i,o,a),t.indexWrite(c+0),t.indexWrite(c+1),t.indexWrite(c+2),t.indexWrite(c+1),t.indexWrite(c+3),t.indexWrite(c+2),t.recordEnd()}}const Hu=fc({FillMeshWriter:Zr,DotDensityMeshWriter:uo,ComplexFillMeshWriter:To,PatternFillMeshWriter:ss,OutlineFillMeshWriter:ti,PatternOutlineFillMeshWriter:Fa,ComplexOutlineFillMeshWriter:Ea,MarkerMeshWriter:hc,PieChartMeshWriter:pc,TextMeshWriter:Zs,LineMeshWriter:jr,TexturedLineMeshWriter:nc,HeatmapMeshWriter:Oa,LabelMeshWriter:ic});function fc(r){const t={};for(const e in r){const i={name:e,constructor:r[e]};t[e]=i}return t}let ke=class extends $n{constructor(r){super(r),this.debugName="",this._updatingHandles=new Sn,this._idToUpdatingState=new Pn}get updating(){const r=this._updatingHandles.updating||Array.from(this._idToUpdatingState.values()).some(t=>t);if(Ur("esri-2d-log-updating")){const t=Array.from(this._idToUpdatingState.entries()).map(([e,i])=>`-> ${e}: ${i}`).join(`
`);console.log(`${this.debugName}: Updating: ${r}
-> Handles: ${this._updatingHandles.updating}
${t}`)}return r}addUpdateTracking(r,t){const e=Tn(()=>t.updating,i=>this._idToUpdatingState.set(r,i),{sync:!0});this.addHandles(e)}addPromise(r){return this._updatingHandles.addPromise(r)}};d([xi({constructOnly:!0})],ke.prototype,"debugName",void 0),d([xi({readOnly:!0})],ke.prototype,"updating",null),ke=d([wn("esri.view.2d.layers.support.UpdateTracking2D")],ke);export{aa as $,su as A,Vt as B,T as C,Ds as D,Ot as E,zs as F,V as G,k as H,_e as I,Se as J,Rr as K,we as L,$e as M,ie as N,R as O,j as P,It as Q,pu as R,ct as S,ri as T,rt as U,wi as V,Ic as W,ai as X,Ts as Y,U as Z,_,Hu as a,ta as a0,Fr as a1,ra as a2,it as a3,Mc as a4,ba as a5,yu as a6,Nc as a7,xa as a8,xt as a9,li as aA,ui as aB,yo as aC,jo as aD,kc as aE,Is as aF,ya as aG,We as aH,ma as aI,Jt as aJ,Mi as aK,Hc as aa,Zc as ab,H as ac,$o as ad,So as ae,ue as af,le as ag,hi as ah,Ye as ai,He as aj,di as ak,Lt as al,nt as am,$t as an,ks as ao,Nt as ap,pa as aq,ni as ar,X as as,Rs as at,wa as au,_o as av,wo as aw,Xr as ax,pt as ay,iu as az,Va as b,P as c,ke as d,Or as e,Pe as f,ut as g,f as h,gt as i,ca as j,vo as k,to as l,Ms as m,bc as n,Xc as o,F as p,W as q,vc as r,Uu as s,Y as t,ir as u,Tt as v,ht as w,Ni as x,re as y,oi as z};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/chunks/chunk-txhloPJY.js","assets/chunks/chunk-gZYsZ36N.js","assets/chunks/chunk-t4TbIqUg.js","assets/static/ShadedColorMaterial.LVqRbJ38.css","assets/chunks/chunk-v6EOeNTY.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
