import{V as W}from"./chunk-NHnMZHZ3.js";import{V as A}from"./chunk-5Ay1NrLY.js";import{V as J}from"./chunk-CwbMjArF.js";import{R as M}from"./chunk-KpbMssn-.js";import{V as Q}from"./chunk-KHbqfZUs.js";import{s as b,qg as m,qh as I,qi as O,qj as k,qk as $,ql as z,qm as H,qn as K,qo as X,qp as h,a4 as T,qq as Y,qr as Z,qs as ee,qt as B,qu as ae,qv as te,gp as re,gB as _,gC as se,gs as ne,gt as ie,gw as f,gx as j,gy as y,gE as oe,gu as w,P as le,bu as ce}from"./chunk-AGUgPSYp.js";import"./chunk-VItKHIgA.js";import"./chunk-qwIWYVt5.js";import"./chunk-3E9jM2aR.js";import"./chunk-JOajwqOH.js";import"./chunk-m5CRLALA.js";import"./chunk-R46ESbsY.js";import"./chunk-O5HgnUfA.js";import"./chunk-r9p3aZnY.js";import"./chunk-xESNvpj7.js";import"./chunk-76dCxm4a.js";import"./chunk-_RV9jjR7.js";import"./chunk-ezQvVqJs.js";import"./chunk-BUDQaXaC.js";import"./chunk-oVLQlo07.js";const me=K;async function ue(a){if(!a?.layer||!a.view)throw new b("heatmap-statistics:missing-parameters","'layer' and 'view' parameters are required");const e=[m.CSVLayer,m.FeatureLayer,m.OGCFeatureLayer,m.GeoJSONLayer,m.WFSLayer],{layer:r,...n}=a,s=I(r,e);if(!s)throw new b("heatmap-statistics:invalid-parameters","'layer' must be one of these types: "+O(e).join(", "));const t={layerAdapter:s,...n};t.radius=t.radius==null?t.blurRadius==null?18:k(t.blurRadius):t.radius;const l=t.signal!=null?{signal:t.signal}:null;await s.load(l);const p=t.field,o=p?s.getField(p):null,i=await $({field:p}),c=z(s,i,"heatmap-statistics:invalid-parameters");if(c)throw c;if(o){const u=H(s,o,"heatmap-statistics:invalid-parameters",me);if(u)throw u}return t}async function pe(a){const{layerAdapter:e,...r}=await ue(a);return e.heatmapStatistics(r)}const F=.01;async function de(a){if(!a?.layer||!a.view)throw new b("heatmap-renderer:missing-parameters","'layer' and 'view' parameters are required");const e={...a,layer:a.layer,view:a.view};e.radius??=e.blurRadius==null?18:k(e.blurRadius),e.minRatio??=.01,e.maxRatio??=1,e.fadeRatio??=.2,e.fadeToTransparent??=!0;const r=[m.CSVLayer,m.FeatureLayer,m.OGCFeatureLayer,m.GeoJSONLayer,m.StreamLayer,m.WFSLayer],n=I(e.layer,r);if(!n)throw new b("heatmap-renderer:invalid-parameters","'layer' must be one of these types: "+O(r).join(", "));e.layer=n;const s=e.signal!=null?{signal:e.signal}:null;await n.load(s);const t=await $({field:e.field}),l=X(n,t,"heatmap-renderer:invalid-parameters");if(l)throw l;return e}async function fe(a){let e=a.scheme,r=null,n=null;const s=await ae(a.basemap,a.view);if(r=s.basemapId!=null?s.basemapId:null,n=s.basemapTheme!=null?s.basemapTheme:null,e)return{scheme:B(e),basemapId:r,basemapTheme:n};const t=te({basemapTheme:n});return t&&(e=t.primaryScheme,r=t.basemapId,n=t.basemapTheme),{scheme:e,basemapId:r,basemapTheme:n}}async function ye(a,e){const{fieldOffset:r}=a,{field:n,basemap:s,radius:t,fadeToTransparent:l,heatmapScheme:p,view:o}=e,{scheme:i,basemapId:c,basemapTheme:u}=await fe({basemap:s,scheme:p,view:o}),g=i.colors,R=g.length,C=!a.count,V=C?[0,.04]:[a.min,a.max];let L;const S=e.fadeRatio??0,E=e.maxRatio??0,v=e.minRatio??0,N=(E-v)/(R-1),d=g[0],x=l?v:F,q=[new h({ratio:0,color:new T([d.r,d.g,d.b,0])}),new h({ratio:F,color:new T([d.r,d.g,d.b,0])}),new h({ratio:x,color:new T([d.r,d.g,d.b,x])})];Y(g,R).forEach((G,P)=>{const U=v+N*P;q.push(new h({ratio:U,color:G}))}),l&&(he(q,S),L=new Z({fadeRatio:S}));const D=new ee({authoringInfo:L,radius:t,colorStops:q,field:n,minDensity:V[0],maxDensity:V[1]});return r!=null&&(D.fieldOffset=r),{renderer:D,statistics:a,defaultValuesUsed:C,scheme:B(i),basemapId:c,basemapTheme:u}}function he(a,e){const r=10*(1-e)+1,n=a.length-3,s=a[2].color.a;a.forEach((t,l)=>{if(l<=2)return;const{color:p}=t,o=(l-3)/n;p.a=e===0?1:Math.min(Math.max(o*r+o+s,s),1)})}async function we(a){const e=await de(a);return ye(e.statistics??await pe({layer:e.layer,field:e.field,fieldOffset:e.fieldOffset,radius:e.radius,view:e.view,signal:e.signal}),e)}const be=new M({baseURL:"/data"}),ge=()=>be.request({method:"GET",url:"/point1.json"}).then(a=>a[0]),Ge=re({__name:"index",setup(a){const e=_(),r=_([]),n=()=>{ge().then(o=>{r.value=o.centerPoints.map((i,c)=>new le({geometry:new ce({longitude:i.centerPoint[0],latitude:i.centerPoint[1]}),attributes:{probabilityDensity:i.probabilityDensity,ranking:i.ranking,ObjectID:c}}))})};n();const s=o=>{const{result:i}=o;i&&console.log(i)},t=async o=>{const i=o.layer,c=o.view;await i.when(),c.goTo(r.value);const u=await we({layer:i,view:c,field:"probabilityDensity"});console.log(u),e.value=u.renderer},l=()=>{n()},p=()=>{r.value=[]};return(o,i)=>{const c=se("ElButton");return ne(),ie(w(A),null,{before:f(()=>[oe("p",null,[y(c,{onClick:i[0]||(i[0]=u=>l())},{default:f(()=>[j("getTestData")]),_:1}),y(c,{onClick:p},{default:f(()=>[j("清空")]),_:1})])]),default:f(()=>[y(w(J),{type:"img_w",spatialReference:{wkid:3857}}),y(w(Q),null,{default:f(({spatialReference:u})=>[y(w(W),{spatialReference:u,renderer:e.value,source:r.value,fields:[{name:"ObjectID",type:"oid"},{name:"probabilityDensity",type:"double"},{name:"ranking",type:"double"}],"geometry-type":"point","object-id-field":"ObjectID",cursor:"pointer",onClick:s,onChange:t},null,8,["spatialReference","renderer","source"])]),_:1})]),_:1})}}});export{Ge as default};
